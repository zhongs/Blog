{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","path":"lib/canvas-ribbon/canvas-ribbon.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/bower.json","path":"lib/fastclick/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/README.md","path":"lib/fastclick/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","path":"lib/jquery_lazyload/CONTRIBUTING.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","path":"lib/jquery_lazyload/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","path":"lib/jquery_lazyload/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","path":"lib/jquery_lazyload/jquery.lazyload.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","path":"lib/jquery_lazyload/jquery.scrollstop.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/LICENSE","path":"lib/fastclick/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.js","path":"lib/needsharebutton/needsharebutton.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/font-embedded.css","path":"lib/needsharebutton/font-embedded.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.css","path":"lib/needsharebutton/needsharebutton.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","path":"lib/three/canvas_sphere.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/bower.json","path":"lib/velocity/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","path":"lib/three/canvas_lines.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","path":"lib/fancybox/source/blank.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","path":"lib/fancybox/source/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.js","path":"lib/Han/dist/han.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.min.css","path":"lib/Han/dist/han.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","path":"lib/fancybox/source/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","path":"lib/fancybox/source/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","path":"lib/fancybox/source/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","path":"lib/fancybox/source/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","path":"lib/fancybox/source/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","path":"lib/fancybox/source/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","path":"lib/fastclick/lib/fastclick.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","path":"lib/fastclick/lib/fastclick.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","path":"lib/fancybox/source/jquery.fancybox.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.css","path":"lib/Han/dist/han.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","path":"lib/Han/dist/font/han-space.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","path":"lib/Han/dist/font/han-space.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/han.js","path":"lib/Han/dist/han.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","path":"lib/Han/dist/font/han.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","path":"lib/fancybox/source/helpers/fancybox_buttons.png","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","path":"lib/fancybox/source/helpers/jquery.fancybox-media.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"lib/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.woff2","path":"lib/Han/dist/font/han.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","path":"lib/Han/dist/font/han.otf","modified":1,"renderable":1},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":1,"renderable":1}],"Cache":[{"_id":"themes/next/.bowerrc","hash":"334da94ca6f024d60d012cc26ea655681e724ad8","modified":1553142204718},{"_id":"themes/next/.editorconfig","hash":"211d2c92bfdddb3e81ea946f4ca7a539f150f4da","modified":1553142204718},{"_id":"themes/next/.gitattributes","hash":"8454b9313cb1a97b63fb87e2d29daee497ce6249","modified":1553142204718},{"_id":"themes/next/.gitignore","hash":"b935cc0e5b099ebd343ca1766e02f65138c13dd0","modified":1553142204718},{"_id":"themes/next/.hound.yml","hash":"289dcf5bfe92dbd680d54d6e0668f41c9c9c0c78","modified":1553142204718},{"_id":"themes/next/.javascript_ignore","hash":"cd250ad74ca22bd2c054476456a73d9687f05f87","modified":1553142204718},{"_id":"themes/next/.jshintrc","hash":"b7d23f2ce8d99fa073f22f9960605f318acd7710","modified":1553142204718},{"_id":"themes/next/.travis.yml","hash":"6674fbdfe0d0c03b8a04527ffb8ab66a94253acd","modified":1553142204718},{"_id":"themes/next/LICENSE","hash":"ec44503d7e617144909e54533754f0147845f0c5","modified":1553142204718},{"_id":"themes/next/README.md","hash":"7423256d6e7622434bbfe20c467819687e8e1b27","modified":1553142204718},{"_id":"themes/next/README.cn.md","hash":"59e323ce21535d561507c9ecc984b7c4dcb61514","modified":1553142204718},{"_id":"themes/next/gulpfile.coffee","hash":"412defab3d93d404b7c26aaa0279e2e586e97454","modified":1553142204718},{"_id":"themes/next/.stylintrc","hash":"3b7f9785e9ad0dab764e1c535b40df02f4ff5fd6","modified":1553142204718},{"_id":"themes/next/_config.yml","hash":"81466b002775e9c3a7feac2c3d7ce3cf33993219","modified":1553142204718},{"_id":"themes/next/package.json","hash":"39370e2aadf1f9a7c105edff064c6e47682b3932","modified":1553142204765},{"_id":"themes/next/bower.json","hash":"47471a8f13528dc4052b746db5b4be2375682173","modified":1553142204718},{"_id":"source/categories/index.md","hash":"7ce6bd3f68e47033b17f7ade8b38146a5a43bb23","modified":1553142204672},{"_id":"source/tags/index.md","hash":"e05d53831c6106b115232a42be15013f8cda32fe","modified":1553142204672},{"_id":"source/_posts/javascript设计模式.md","hash":"fa074f03b5227b59cf3ae6f584a024a3eb273a47","modified":1553142204640},{"_id":"source/_posts/Ubuntu系统部署nodejs项目.md","hash":"150994d80f8fae5c681a727bf4f48e6e897564a2","modified":1553142204640},{"_id":"source/_posts/分类侧边栏.md","hash":"f3128a6a996b8336ae89d04d16e8446a89371490","modified":1553142204672},{"_id":"source/_posts/nodejs发短信验证码.md","hash":"d5996cd21e37f2f08cf7c9e8b2889b300195d8f3","modified":1553142204640},{"_id":"source/_posts/nodejs发邮件.md","hash":"35d83b5dffabe38c3a70706085335fbe8e0c138b","modified":1553142204672},{"_id":"source/_posts/实现逐帧动画的几种方式.md","hash":"db02d114f0d2243e27f78d950b69af1613f572f9","modified":1553142204672},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"5adfad3ef1b870063e621bc0838268eb2c7c697a","modified":1553142204718},{"_id":"source/_posts/视频转码播放实践.md","hash":"81ee954049c3d3110aba6986e25d162a345c0cdd","modified":1553142204672},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"b1ec000babd42bb7ffd26f5ad8aac9b5bec79ae5","modified":1553142204718},{"_id":"themes/next/.github/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1553142204718},{"_id":"source/_posts/从单行滚动开始.md","hash":"4da2f9b7acfd4097c5d57d87a64ac6d359392887","modified":1553142204672},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"1228506a940114288d61812bfe60c045a0abeac1","modified":1553142204718},{"_id":"themes/next/languages/de.yml","hash":"fd02d9c2035798d5dc7c1a96b4c3e24b05b31a47","modified":1553142204718},{"_id":"themes/next/languages/en.yml","hash":"2f4b4776ca1a08cc266a19afb0d1350a3926f42c","modified":1553142204718},{"_id":"themes/next/languages/default.yml","hash":"b3bcd8934327448a43d9bfada5dd11b1b8c1402e","modified":1553142204718},{"_id":"themes/next/languages/id.yml","hash":"dccae33e2a5b3c9f11c0e05ec4a7201af1b25745","modified":1553142204734},{"_id":"themes/next/languages/it.yml","hash":"a215d016146b1bd92cef046042081cbe0c7f976f","modified":1553142204734},{"_id":"themes/next/languages/fr-FR.yml","hash":"efeeb55d5c4add54ad59a612fc0630ee1300388c","modified":1553142204718},{"_id":"themes/next/languages/ja.yml","hash":"37f954e47a3bc669620ca559e3edb3b0072a4be5","modified":1553142204734},{"_id":"themes/next/languages/ko.yml","hash":"dc8f3e8c64eb7c4bb2385025b3006b8efec8b31d","modified":1553142204734},{"_id":"themes/next/languages/pt.yml","hash":"2efcd240c66ab1a122f061505ca0fb1e8819877b","modified":1553142204734},{"_id":"themes/next/languages/nl-NL.yml","hash":"213e7a002b82fb265f69dabafbbc382cfd460030","modified":1553142204734},{"_id":"themes/next/languages/ru.yml","hash":"e33ee44e80f82e329900fc41eb0bb6823397a4d6","modified":1553142204734},{"_id":"themes/next/languages/pt-BR.yml","hash":"568d494a1f37726a5375b11452a45c71c3e2852d","modified":1553142204734},{"_id":"themes/next/languages/zh-tw.yml","hash":"432463b481e105073accda16c3e590e54c8e7b74","modified":1553142204734},{"_id":"themes/next/layout/_layout.swig","hash":"7d91c9ca571067a3548d0f3c132b480cd3beb823","modified":1553142204734},{"_id":"themes/next/layout/archive.swig","hash":"9a2c14874a75c7085d2bada5e39201d3fc4fd2b4","modified":1553142204765},{"_id":"themes/next/layout/category.swig","hash":"3cbb3f72429647411f9e85f2544bdf0e3ad2e6b2","modified":1553142204765},{"_id":"themes/next/layout/index.swig","hash":"555a357ecf17128db4e29346c92bb6298e66547a","modified":1553142204765},{"_id":"themes/next/languages/zh-Hans.yml","hash":"66b9b42f143c3cb2f782a94abd4c4cbd5fd7f55f","modified":1553142204734},{"_id":"themes/next/layout/page.swig","hash":"e8fcaa641d46930237675d2ad4b56964d9e262e9","modified":1553142204765},{"_id":"themes/next/scripts/merge-configs.js","hash":"5758f8f3f12d17bc80da65bb808a20b3a8aae186","modified":1553142204765},{"_id":"themes/next/scripts/merge.js","hash":"39b84b937b2a9608b94e5872349a47200e1800ff","modified":1553142204765},{"_id":"themes/next/layout/tag.swig","hash":"34e1c016cbdf94a31f9c5d494854ff46b2a182e9","modified":1553142204765},{"_id":"themes/next/layout/schedule.swig","hash":"87ad6055df01fa2e63e51887d34a2d8f0fbd2f5a","modified":1553142204765},{"_id":"themes/next/languages/zh-hk.yml","hash":"fe0d45807d015082049f05b54714988c244888da","modified":1553142204734},{"_id":"themes/next/layout/post.swig","hash":"7a6ce102ca82c3a80f776e555dddae1a9981e1ed","modified":1553142204765},{"_id":"themes/next/test/.jshintrc","hash":"c9fca43ae0d99718e45a6f5ce736a18ba5fc8fb6","modified":1553142204906},{"_id":"themes/next/package-lock.json","hash":"cc3e9b232005f824a73555ad6568d566b8aae554","modified":1553142204765},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1553142204828},{"_id":"themes/next/test/helpers.js","hash":"f25e7f3265eb5a6e1ccbb5e5012fa9bebf134105","modified":1553142204906},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1553142204734},{"_id":"themes/next/test/intern.js","hash":"db90b1063356727d72be0d77054fdc32fa882a66","modified":1553142204906},{"_id":"themes/next/layout/_custom/header.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1553142204734},{"_id":"themes/next/layout/_partials/footer.swig","hash":"58d292083e3e6aff473f1b5c1f02cc02b4881e46","modified":1553142204734},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"77c61e0baea3544df361b7338c3cd13dc84dde22","modified":1553142204734},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"1634fb887842698e01ff6e632597fe03c75d2d01","modified":1553142204734},{"_id":"themes/next/layout/_partials/head.swig","hash":"f14a39dad1ddd98e6d3ceb25dda092ba80d391b5","modified":1553142204734},{"_id":"themes/next/layout/_partials/search.swig","hash":"b4ebe4a52a3b51efe549dd1cdee846103664f5eb","modified":1553142204734},{"_id":"themes/next/layout/_partials/comments.swig","hash":"de45e77e7d52cf317129b7d21415a3002b95b94e","modified":1553142204734},{"_id":"themes/next/layout/_partials/header.swig","hash":"c54b32263bc8d75918688fb21f795103b3f57f03","modified":1553142204734},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"8c56dd26157cbc580ae41d97ac34b90ab48ced3f","modified":1553142204734},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"f83befdc740beb8dc88805efd7fbb0fef9ed19be","modified":1553142204734},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"c0f5a0955f69ca4ed9ee64a2d5f8aa75064935ad","modified":1553142204750},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"e2e4eae391476da994045ed4c7faf5e05aca2cd7","modified":1553142204734},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"931808ad9b8d8390c0dcf9bdeb0954eeb9185d68","modified":1553142204750},{"_id":"themes/next/layout/_macro/post.swig","hash":"18365c242e07bd4fd622f9cf8abc8f74c24072b6","modified":1553142204734},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"b9f9959225876fb56fb3fba96306d19396e704d4","modified":1553142204734},{"_id":"themes/next/layout/_macro/reward.swig","hash":"357d86ec9586705bfbb2c40a8c7d247a407db21a","modified":1553142204734},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"9be624634703be496a5d2535228bc568a8373af9","modified":1553142204750},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"8301c9600bb3e47f7fb98b0e0332ef3c51bb1688","modified":1553142204750},{"_id":"themes/next/layout/_third-party/duoshuo-hot-articles.swig","hash":"ba75672183d94f1de7c8bd0eeee497a58c70e889","modified":1553142204750},{"_id":"themes/next/layout/_third-party/mathjax.swig","hash":"a0bd3388587fd943baae0d84ca779a707fbcad89","modified":1553142204750},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"9a188938d46931d5f3882a140aa1c48b3a893f0c","modified":1553142204750},{"_id":"themes/next/layout/_third-party/needsharebutton.swig","hash":"fa882641da3bd83d9a58a8a97f9d4c62a9ee7b5c","modified":1553142204750},{"_id":"themes/next/scripts/tags/button.js","hash":"eddbb612c15ac27faf11c59c019ce188f33dec2c","modified":1553142204765},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"99b66949f18398689b904907af23c013be1b978f","modified":1553142204765},{"_id":"themes/next/scripts/tags/exturl.js","hash":"5022c0ba9f1d13192677cf1fd66005c57c3d0f53","modified":1553142204765},{"_id":"themes/next/scripts/tags/full-image.js","hash":"c9f833158c66bd72f627a0559cf96550e867aa72","modified":1553142204765},{"_id":"themes/next/scripts/tags/note.js","hash":"f7eae135f35cdab23728e9d0d88b76e00715faa0","modified":1553142204765},{"_id":"themes/next/scripts/tags/tabs.js","hash":"aa7fc94a5ec27737458d9fe1a75c0db7593352fd","modified":1553142204765},{"_id":"themes/next/scripts/tags/lazy-image.js","hash":"bcba2ff25cd7850ce6da322d8bd85a8dd00b5ceb","modified":1553142204765},{"_id":"themes/next/scripts/tags/label.js","hash":"6f00952d70aadece844ce7fd27adc52816cc7374","modified":1553142204765},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"ac681b0d0d8d39ba3817336c0270c6787c2b6b70","modified":1553142204765},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"554ec568e9d2c71e4a624a8de3cb5929050811d6","modified":1553142204750},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"db15d7e1552aa2d2386a6b8a33b3b3a40bf9e43d","modified":1553142204750},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1553142204828},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1553142204828},{"_id":"themes/next/source/css/main.styl","hash":"a91dbb7ef799f0a171b5e726c801139efe545176","modified":1553142204828},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1553142204828},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1553142204828},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1553142204828},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1553142204828},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1553142204828},{"_id":"themes/next/source/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1553142204828},{"_id":"themes/next/source/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1553142204828},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1553142204828},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1553142204828},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1553142204828},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1553142204828},{"_id":"themes/next/source/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1553142204828},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1553142204828},{"_id":"themes/next/source/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1553142204828},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1553142204828},{"_id":"themes/next/source/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1553142204828},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1553142204750},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1553142204750},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1553142204812},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1553142204812},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1553142204812},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1553142204828},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1553142204828},{"_id":"themes/next/layout/_partials/head/custom-head.swig","hash":"a223919d2e1bf17ca4d6abb2c86f2efca9883dc1","modified":1553142204734},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"b2f0d247b213e4cf8de47af6a304d98070cc7256","modified":1553142204734},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"b25002a83cbd2ca0c4a5df87ad5bff26477c0457","modified":1553142204734},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"a8c7f9ca7c605d039a1f3bf4e4d3183700a3dd62","modified":1553142204734},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"9e3d133ac5bcc6cb51702c83b2611a49811abad1","modified":1553142204734},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"f5e487b0d213ca0bd94aa30bc23b240d65081627","modified":1553142204734},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"d9e2d9282f9be6e04eae105964abb81e512bffed","modified":1553142204734},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"d4fbffd7fa8f2090eb32a871872665d90a885fac","modified":1553142204734},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"0a9cdd6958395fcdffc80ab60f0c6301b63664a5","modified":1553142204734},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"9b84ab576982b2c3bb0291da49143bc77fba3cc6","modified":1553142204750},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1553142204750},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"ff947f3561b229bc528cb1837d4ca19612219411","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"753d262911c27baf663fcaf199267133528656af","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"a10b7f19d7b5725527514622899df413a34a89db","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"b1e13df83fb2b1d5d513b30b7aa6158b0837daab","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"7d94845f96197d9d84a405fa5d4ede75fb81b225","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"45f3f629c2aacc381095750e1c8649041a71a84b","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"8a399df90dadba5ad4e781445b58f4765aeb701e","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"71397a5823e8ec8aad3b68aace13150623b3e19d","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"5a8027328f060f965b3014060bebec1d7cf149c1","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"7b11eac3a0685fa1ab2ab6ecff60afc4f15f0d16","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"e6d10ee4fb70b3ae1cd37e9e36e000306734aa2e","modified":1553142204750},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"f9a1647a8f1866deeb94052d1f87a5df99cb1e70","modified":1553142204750},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"b83a51bbe0f1e2ded9819070840b0ea145f003a6","modified":1553142204750},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"4c501ea0b9c494181eb3c607c5526a5754e7fbd8","modified":1553142204750},{"_id":"themes/next/layout/_third-party/comments/youyan.swig","hash":"7e65ff8fe586cd655b0e9d1ad2912663ff9bd36c","modified":1553142204750},{"_id":"themes/next/layout/_third-party/comments/duoshuo.swig","hash":"1600f340e0225361580c44890568dc07dbcf2c89","modified":1553142204750},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"493bd5999a1061b981922be92d8277a0f9152447","modified":1553142204750},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"34599633658f3b0ffb487728b7766e1c7b551f5a","modified":1553142204765},{"_id":"themes/next/layout/_third-party/comments/gitment.swig","hash":"4dcc3213c033994d342d02b800b6229295433d30","modified":1553142204750},{"_id":"themes/next/layout/_third-party/comments/hypercomments.swig","hash":"af7f3e43cbdc4f88c13f101f0f341af96ace3383","modified":1553142204750},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"1b492d528a7d48216d4548011000fced2f4a538d","modified":1553142204750},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"d8c98938719284fa06492c114d99a1904652a555","modified":1553142204765},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"3403fdd8efde1a0afd11ae8a5a97673f5903087f","modified":1553142204812},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"93479642fd076a1257fecc25fcf5d20ccdefe509","modified":1553142204765},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"fe95dd3d166634c466e19aa756e65ad6e8254d3e","modified":1553142204765},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"9246162d4bc7e949ce1d12d135cbbaf5dc3024ec","modified":1553142204750},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"07f7da320689f828f6e36a6123807964a45157a0","modified":1553142204812},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"7896c3ee107e1a8b9108b6019f1c070600a1e8cc","modified":1553142204812},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"58e7dd5947817d9fc30770712fc39b2f52230d1e","modified":1553142204828},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"4069f918ccc312da86db6c51205fc6c6eaabb116","modified":1553142204828},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"a25408534f8fe6e321db4bbf9dd03335d648fe17","modified":1553142204828},{"_id":"themes/next/source/css/_variables/base.styl","hash":"b1f6ea881a4938a54603d68282b0f8efb4d7915d","modified":1553142204828},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"0e55cbd93852dc3f8ccb44df74d35d9918f847e0","modified":1553142204812},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"b35a7dc47b634197b93487cea8671a40a9fdffce","modified":1553142204828},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"cb431b54ba9c692165a1f5a12e4c564a560f8058","modified":1553142204828},{"_id":"themes/next/source/js/src/affix.js","hash":"1b509c3b5b290a6f4607f0f06461a0c33acb69b1","modified":1553142204828},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"1512c751d219577d338ac0780fb2bbd9075d5298","modified":1553142204828},{"_id":"themes/next/source/js/src/exturl.js","hash":"a2a0f0de07e46211f74942a468f42ee270aa555c","modified":1553142204828},{"_id":"themes/next/source/js/src/post-details.js","hash":"93a18271b4123dd8f94f09d1439b47c3c19a8712","modified":1553142204828},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"0289031200c3d4c2bdd801ee10fff13bb2c353e4","modified":1553142204828},{"_id":"themes/next/source/js/src/motion.js","hash":"885176ed51d468f662fbf0fc09611f45c7e5a3b1","modified":1553142204828},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"b7657be25fc52ec67c75ab5481bdcb483573338b","modified":1553142204843},{"_id":"themes/next/source/js/src/utils.js","hash":"b7ddc240208d57596a67c78a04a11b0f0bdecc97","modified":1553142204843},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"02cf91514e41200bc9df5d8bdbeb58575ec06074","modified":1553142204843},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1553142204843},{"_id":"themes/next/source/lib/fastclick/.bower.json","hash":"bf3eef9d647cd7c9b62feda3bc708c6cdd7c0877","modified":1553142204859},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","hash":"b02737510e9b89aeed6b54f89f602a9c24b06ff2","modified":1553142204843},{"_id":"themes/next/source/lib/fastclick/bower.json","hash":"a9b3ee1e4db71a0e4ea6d5bed292d176dd68b261","modified":1553142204859},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"03ddbf76c1dd1afb93eed0b670d2eee747472ef1","modified":1553142204859},{"_id":"themes/next/source/lib/fastclick/README.md","hash":"68a9b9d53126405b0fa5f3324f1fb96dbcc547aa","modified":1553142204859},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"c31ff06a740955e44edd4403902e653ccabfd4db","modified":1553142204859},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1553142204859},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"71e7183634dc1b9449f590f15ebd7201add22ca7","modified":1553142204859},{"_id":"themes/next/source/lib/jquery/.bower.json","hash":"865d6c1328ab209a4376b9d2b7a7824369565f28","modified":1553142204874},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1553142204843},{"_id":"themes/next/source/lib/jquery_lazyload/.bower.json","hash":"90fa628f156d8045357ff11eaf32e61abacf10e8","modified":1553142204874},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","hash":"4ded6fee668544778e97e38c2b211fc56c848e77","modified":1553142204874},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","hash":"e0acf1db27b0cc16128a59c46db1db406b5c4c58","modified":1553142204874},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"b4aefc910578d76b267e86dfffdd5121c8db9aec","modified":1553142204859},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","hash":"b930297cb98b8e1dbd5abe9bc1ed9d5935d18ce8","modified":1553142204874},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","hash":"f4a570908f6c89c6edfb1c74959e733eaadea4f2","modified":1553142204874},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","hash":"bf773ad48a0b9aa77681a89d7569eefc0f7b7b18","modified":1553142204874},{"_id":"themes/next/source/lib/fastclick/LICENSE","hash":"6f474ea75c42442da7bbcf2e9143ce98258efd8d","modified":1553142204859},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.js","hash":"2ce5f3bf15c523b9bfc97720d8884bb22602a454","modified":1553142204874},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1553142204874},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1553142204874},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1553142204874},{"_id":"themes/next/source/lib/needsharebutton/font-embedded.css","hash":"14264a210bf94232d58d7599ea2ba93bfa4fb458","modified":1553142204874},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.css","hash":"e33aa8fa48b6639d8d8b937d13261597dd473b3a","modified":1553142204874},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1553142204874},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1553142204890},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1553142204890},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1553142204890},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1553142204890},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1553142204890},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1553142204890},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1553142204890},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"8aaa675f577d5501f5f22d5ccb07c2b76310b690","modified":1553142204890},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","hash":"46a50b91c98b639c9a2b9265c5a1e66a5c656881","modified":1553142204890},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1553142204890},{"_id":"themes/next/source/lib/velocity/.bower.json","hash":"63da5e80ebb61bb66a2794d5936315ca44231f0c","modified":1553142204890},{"_id":"themes/next/source/lib/velocity/bower.json","hash":"92d92860418c4216aa59eb4cb4a556290a7ad9c3","modified":1553142204890},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1553142204890},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"dbbfb50f6502f6b81dcc9fee7b31f1e812da3464","modified":1553142204906},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"8148492dd49aa876d32bb7d5b728d3f5bf6f5074","modified":1553142204890},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"bf172816a9c57f9040e3d19c24e181a142daf92b","modified":1553142204906},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"dde584994ac13dc601836e86f4cf490e418d9723","modified":1553142204906},{"_id":"themes/next/source/lib/jquery/index.js","hash":"17a740d68a1c330876c198b6a4d9319f379f3af2","modified":1553142204874},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"218cc936ba3518a3591b2c9eda46bc701edf7710","modified":1553142204765},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"2530de0f3125a912756f6c0e9090cd012134a4c5","modified":1553142204765},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"12662536c7a07fff548abe94171f34b768dd610f","modified":1553142204812},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"8f86f694c0749a18ab3ad6f6df75466ca137a4bc","modified":1553142204765},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"7ad4081466b397e2a6204141bb7768b7c01bd93c","modified":1553142204765},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"237d185ac62ec9877e300947fa0109c44fb8db19","modified":1553142204765},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"8b32928686c327151e13d3ab100157f9a03cd59f","modified":1553142204765},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","hash":"2d9a9f38c493fdf7c0b833bb9184b6a1645c11b2","modified":1553142204890},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"ff4489cd582f518bba6909a301ac1292a38b4e96","modified":1553142204765},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"6eb4bcc3056bd279d000607e8b4dad50d368ca69","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"4f2801fc4cf3f31bf2069f41db8c6ce0e3da9e39","modified":1553142204781},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"1da5c800d025345f212a3bf1be035060f4e5e6ed","modified":1553142204812},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"24ee4b356ff55fc6e58f26a929fa07750002cf29","modified":1553142204812},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"91ca75492cd51f2553f4d294ed2f48239fcd55eb","modified":1553142204812},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a17e2b871a335f290afb392a08f94fd35f59c715","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"31127dcbf4c7b4ada53ffbf1638b5fe325b7cbc0","modified":1553142204812},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"ea9069645696f86c5df64208490876fe150c8cae","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"748dbfbf9c08e719ddc775958003c64b00d39dab","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"a98ad885ee4f48d85b2578a0b9c2bbf166e96733","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"5dbc0d0c897e46760e5dbee416530d485c747bba","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"25d5e45a355ee2093f3b8b8eeac125ebf3905026","modified":1553142204812},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"3f40e8a9fe8e7bd5cfc4cf4cbbbcb9539462e973","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"b1025c421406d2c24cc92a02ae28c1915b01e240","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"60fa84aa7731760f05f52dd7d8f79b5f74ac478d","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"d0bfd1bef988c76f7d7dd72d88af6f0908a8b0db","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9b913b73d31d21f057f97115ffab93cfa578b884","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"bce344d3a665b4c55230d2a91eac2ad16d6f32fd","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"26666c1f472bf5f3fb9bc62081cca22b4de15ccb","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"9c99034f8e00d47e978b3959f51eb4a9ded0fcc8","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"1f6e2ce674735269599acc6d77b3ea18d31967fc","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"86197902dfd3bededba10ba62b8f9f22e0420bde","modified":1553142204828},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"4642e30010af8b2b037f5b43146b10a934941958","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"416988dca389e6e2fdfa51fa7f4ee07eb53f82fb","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"30561ed60fc64f3e4ce85143bdb55faa814743a6","modified":1553142204828},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"f1d0b5d7af32c423eaa8bb93ab6a0b45655645dc","modified":1553142204843},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1553142204843},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1553142204843},{"_id":"themes/next/source/lib/Han/dist/han.min.js","hash":"16b03db23a52623348f37c04544f2792032c1fb6","modified":1553142204843},{"_id":"themes/next/source/lib/Han/dist/han.min.css","hash":"6d586bfcfb7ae48f1b12f76eec82d3ad31947501","modified":1553142204843},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1553142204843},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1553142204843},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1553142204843},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1553142204843},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"82f33ad0842aa9c154d029e0dada2497d4eb1d57","modified":1553142204859},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"ae6318aeb62ad4ce7a7e9a4cdacd93ffb004f0fb","modified":1553142204859},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","hash":"1d6aeda0480d0e4cb6198edf7719d601d4ae2ccc","modified":1553142204859},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1553142204859},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"d71602cbca33b9ecdb7ab291b7f86a49530f3601","modified":1553142204859},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"88af80502c44cd52ca81ffe7dc7276b7eccb06cf","modified":1553142204859},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"3655f1fdf1e584c4d8e8d39026093ca306a5a341","modified":1553142204859},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"41ea797c68dbcff2f6fb3aba1d1043a22e7cc0f6","modified":1553142204890},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"a817b6c158cbc5bab3582713de9fe18a18a80552","modified":1553142204890},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1553142204859},{"_id":"themes/next/source/lib/Han/dist/han.css","hash":"6c26cdb36687d4f0a11dabf5290a909c3506be5c","modified":1553142204843},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1553142204874},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1553142204874},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"9f73c4696f0907aa451a855444f88fc0698fa472","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"53cde051e0337f4bf42fb8d6d7a79fa3fa6d4ef2","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d63e0cacc53dd375fcc113465a4328c59ff5f2c1","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"1727702eac5d326b5c81a667944a245016668231","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"167986d0f649516671ddf7193eebba7b421cd115","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"1a0d059799a298fe17c49a44298d32cebde93785","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"b6f3a06a94a6ee5470c956663164d58eda818a64","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"7fb593f90d74a99c21840679933b9ef6fdc16a61","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"f9760ecf186954cee3ba4a149be334e9ba296b89","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"4e3838d7ac81d9ad133960f0f7ed58a44a015285","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"0656e753f182c9f47fef7304c847b7587a85ef0d","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"50450d9fdc8a2b2be8cfca51e3e1a01ffd636c0b","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"62fbbd32cf5a99ae550c45c763a2c4813a138d01","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"7fe4d4d656e86276c17cb4e48a560cb6a4def703","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"caf263d1928496688c0e1419801eafd7e6919ce5","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"a200c0a1c5a895ac9dc41e0641a5dfcd766be99b","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"8cf318644acc8b4978537c263290363e21c7f5af","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"cd9e214e502697f2f2db84eb721bac57a49b0fce","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"875cbe88d5c7f6248990e2beb97c9828920e7e24","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"a6c6eb8adba0a090ad1f4b9124e866887f20d10d","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"d0d7a5c90d62b685520d2b47fea8ba6019ff5402","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"5a982d8ef3b3623ea5f59e63728990f5623c1b57","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"01567edaea6978628aa5521a122a85434c418bfd","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"27deb3d3a243d30022055dac7dad851024099a8b","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"ccb34c52be8adba5996c6b94f9e723bd07d34c16","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"7968343e41f8b94b318c36289dff1196c3eb1791","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"ca88ea6999a61fb905eb6e72eba5f92d4ee31e6e","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"39f04c4c7237a4e10acd3002331992b79945d241","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"8dd9a1c6f4f6baa00c2cf01837e7617120cf9660","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"11c22f0fb3f6beb13e5a425ec064a4ff974c13b7","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"61f8cea3c01acd600e90e1bc2a07def405503748","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"761eba9811b050b25d548cc0854de4824b41eb08","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"89d6c3b697efc63de42afd2e89194b1be14152af","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"1153bb71edf253765145559674390e16dd67c633","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"28a8737c090fbffd188d73a00b42e90b9ee57df2","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"5ef6343835f484a2c0770bd1eb9cc443609e4c39","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"a3bdd71237afc112b2aa255f278cab6baeb25351","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"a1521d48bb06d8d703753f52a198baa197af7da2","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"3159b55f35c40bd08e55b00148c523760a708c51","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"e71652d3216e289c8548b1ea2357822c1476a425","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"2ab1322fe52ab5aafd49e68f5bd890e8380ee927","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"2fe76476432b31993338cb45cdb3b29a518b6379","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"2ad1a2a9bbf6742d1b0762c4c623b68113d1e0fe","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"b80604868e4f5cf20fccafd7ee415c20c804f700","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"5dbeed535d63a50265d96b396a5440f9bb31e4ba","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"b7076e58d647265ee0ad2b461fe8ce72c9373bc5","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"a6e7d698702c2e383dde3fde2abde27951679084","modified":1553142204796},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"4237c6e9d59da349639de20e559e87c2c0218cfd","modified":1553142204890},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"9a409b798decdefdaf7a23f0b11004a8c27e82f3","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"10599e16414a8b7a76c4e79e6617b5fe3d4d1adf","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"28825ae15fa20ae3942cdaa7bcc1f3523ce59acc","modified":1553142204812},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"15975ba7456b96916b1dbac448a1a0d2c38b8f3d","modified":1553142204812},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"b2495ae5e04dcca610aacadc47881d9e716cd440","modified":1553142204781},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"9c8196394a89dfa40b87bf0019e80144365a9c93","modified":1553142204812},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"154a87a32d2fead480d5e909c37f6c476671c5e6","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/third-party/gitment.styl","hash":"874278147115601d2abf15987f5f7a84ada1ac6b","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"bba4f3bdb7517cd85376df3e1209b570c0548c69","modified":1553142204796},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"16087276945fa038f199692e3eabb1c52b8ea633","modified":1553142204812},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"717cc7f82be9cc151e23a7678601ff2fd3a7fa1d","modified":1553142204796},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"a07aa12cc36ac5c819670c2a3c17d07ed7a08986","modified":1553142204812},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1553142204812},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1553142204843},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1553142204843},{"_id":"themes/next/source/lib/Han/dist/han.js","hash":"4ac683b2bc8531c84d98f51b86957be0e6f830f3","modified":1553142204843},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1553142204843},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1553142204843},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"6394c48092085788a8c0ef72670b0652006231a1","modified":1553142204859},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"51139a4c79573d372a347ef01a493222a1eaf10a","modified":1553142204859},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"b88b589f5f1aa1b3d87cc7eef34c281ff749b1ae","modified":1553142204859},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"ee948b4489aedeb548a77c9e45d8c7c5732fd62d","modified":1553142204859},{"_id":"themes/next/source/lib/Han/dist/font/han.woff2","hash":"623af3ed5423371ac136a4fe0e8cc7bb7396037a","modified":1553142204843},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1553142204859},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1553142204874},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"d22b1629cb23a6181bebb70d0cf653ffe4b835c8","modified":1553142204859},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1553142204859},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1553142204843},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","hash":"90a1b22129efc172e2dfcceeeb76bff58bc3192f","modified":1553142204843},{"_id":"themes/next/source/lib/three/three.min.js","hash":"26273b1cb4914850a89529b48091dc584f2c57b8","modified":1553142204890},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1553142204874}],"Category":[],"Data":[],"Page":[{"title":"categories","date":"2016-11-11T02:13:10.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2016-11-11 10:13:10\ntype: \"categories\"\n---","updated":"2019-03-21T04:23:24.672Z","path":"categories/index.html","comments":1,"layout":"page","_id":"ckknbqwfl000010udwep1n4va","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2016-11-11T02:14:54.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2016-11-11 10:14:54\ntype: \"tags\"\n---\n","updated":"2019-03-21T04:23:24.672Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ckknbqwfs000210udwuf2e7yw","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"javascript设计模式","date":"2017-11-26T11:29:57.000Z","_content":"<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/designMode/1.jpg\" width=\"80%\" height=\"50%\">\n在合适的时间，看到合适的书是幸运的！文中的例子摘自《JavaScript设计模式与开发实践》这本书；\n<!-- more -->\n\n## 单例模式\n\n>保证一个类仅有一个实例，并提供一个访问它的全局访问点；\n\n登录弹窗\n\n````javascript\n    var getSingle = function(fn){\n        var result;\n        return function(){\n            return result || (result = fn.apply(this, arguments));\n        }\n    };\n\n    var createLoginLayer = function(){\n        var div = document.createElement('div');\n        div.innerHTML = '我是登录弹窗';\n        div.style.display = 'none';\n        document.body.appendChild(div);\n        return div;\n    };\n\n    var createSingleLoginLayer = getSingle( createLoginLayer );\n\n    document.getElementById('loginBtn').onclick = function(){\n        var loginLayer = createSingleLoginLayer();\n        loginLayer.style.display = 'block';\n    }\n````\n\n## 策略模式\n\n>定义一系列的算法，把他们一个个封装起来，并且使它们可以相互替换\n\n表单验证\n\n````javascript\n    //策略对象\n    var strategies = {\n        isNonEmpty: function( value, errorMsg ){\n            if( value==='' ){\n                return errorMsg;\n            }\n        },\n        minLength: function( value, length, errorMsg ){\n            if( value.length < length ){\n                return errorMsg;\n            }\n        },\n        isMobile: function( value, errorMsg ){\n            if( !/(^1[3|5|8][0-9]{9}$)/.test( value ) ){\n                return errorMsg;\n            }\n        }\n    };\n\n    //Validator 类\n    var Validator = function(){\n        this.cache = [];\n    };\n\n    Validator.prototype.add = function( dom, rules ){\n        var self = this;\n        for( var i=0, rule; rule = rules[ i++ ]; ){\n            (function(rule){\n                var strategyAry = rule.strategy.split(':');\n                var errorMsg = rule.errorMsg;\n                self.cache.push(function(){\n                    var strategy = strategyAry.shift();\n                    strategyAry.unshift( dom.value );\n                    strategyAry.push(errorMsg);\n                    return strategies[ strategy ].apply( dom, strategyAry );\n                });\n            })(rule)\n        }\n    };\n\n    Validator.prototype.start = function(){\n        for( var i = 0, validatorFunc; validatorFunc = this.cache[ i++ ]; ){\n            var errorMsg = validatorFunc();\n            if( errorMsg ){\n                return errorMsg;\n            }\n        }\n    };\n\n    //客户调用代码\n    var registerForm = document.getElementById( 'registerForm' );\n\n    var validateFunc = function(){\n        var validator = new Validator();\n        validator.add( registerForm.userName,\n         [{ strategy: 'isNonEmpty', errorMsg: '用户名不能为空' },\n          { strategy: 'minLength:10', errorMsg: '用户名长度不能小于10位' }]\n        );\n\n        validator.add( registerForm.password,[{ \n            strategy: 'minLength:6', \n            errorMsg: '密码长度不能小于6位' \n            }]);\n\n        validator.add( registerForm.phoneNumber,[{ \n            strategy: 'isMobile', \n            errorMsg: '手机号码格式不正确' \n            }]);\n\n        var errorMsg = validator.start();\n        return errorMsg;\n    };\n\n    registerForm.onsubmit = function(){\n        var errorMsg = validataFunc();\n        if( errorMsg ){\n            alert( errorMsg );\n            return false;\n        }\n    };\n\n````\n\n## 代理模式\n\n>为一个对象提供一个代用品或占位符，以便控制对它的访问。\n\n图片预加载\n\n````javascript\n    var myImage = (function(){\n        var imgNode = document.createElement('img');\n        document.body.appendChild( imgNode );\n        return function(){\n            imgNode.src = src;\n        }\n    })();\n\n    var proxyImage = (function(){\n        var img = new Image;\n        img.onload = function(){\n            myImage( this.src );\n        }\n        return function( src ){\n            myImage('http://sucimg.itc.cn/avatarimg/903387522_1510992087902_c55');\n            img.src = src;\n        }\n    })();\n\n    proxyImage('http://7xqrwh.com1.z0.glb.clouddn.com/image/designMode/1.jpg');\n````\n\n## 迭代器模式\n\n>提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。\n\n外部迭代器\n\n````javascript\n    var Iterator = function( obj ){\n        var current = 0;\n        var next = function(){\n            current += 1;\n        }\n        var isDone = function(){\n            return current >= obj.length;\n        }\n        var getCurrItem = function(){\n            return obj[current];\n        }\n        return {\n            next:next,\n            isDone:isDone,\n            getCurrItem:getCurrItem\n        }\n    };\n\n    //比较2个数组是否相等\n    var compare = function(iterator1, iterator2){\n        while(!iterator1.isDone() && !iterator2.isDone()){\n            if(iterator1.getCurrItem() !== iterator2.getCurrItem()){\n                throw new Error('iterator1 和 iterator2不相等');\n            }\n            iteration1.next();\n            iteration2.next();\n        }\n        alert('iterator1 和 iterator2相等');\n    }\n\n    var iterator1 = Iterator([1,2,3]);\n    var iterator2 = Iterator([1,2,3]);\n\n    cpmpare(iterator1, iterator2);\n````\n\n倒序迭代器\n\n````javascript\n    var reverseEach = function(ary, callback){\n        for( var l = arr.length - 1; l>=0; l--; ){\n            callback(l, ary[l]);\n        }\n    };\n\n    reverseEach([0,1,2], function(i, n){\n        console.log(n);  //2,1,0\n    });\n````\n\n终止迭代器\n\n````javascript\n    var each = function(ary, callback){\n        for( var i=0; i<ary.length; i<l; i++ ){\n            if( callback(i, ary[i]) === false ){\n                break;\n            }\n        }\n    };\n\n    each([1,2,3,4,5], function(i, n){\n        if(n>3){\n            return false;\n        }\n        console.log(n); //1,2,3\n    })\n````\n\n## 发布订阅模式\n\n>发布订阅模式又叫观察者模式，它定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。\n\n全局的发布订阅对象\n\n````javascript\n    var Event = (function(){\n        var clientList = {},\n            listen,\n            trigger,\n            remove;\n\n        listen = function(key, fn){\n            if( !clientList[key] ){\n                clientList[key] = [];\n            }\n            clientList[key].push(fn);\n        };\n\n        trigger = function(){\n            var key = Array.prototype.shift.call( arguments );\n                fns = clientList[key];\n                if(!fns || fns.length === 0){\n                    return false;\n                }\n                for(var i=0, fn; fn = fns[i++];){\n                    fn.apply(this, arguments);\n                }\n        };\n\n        remove = function(key, fn){\n            var fns = clientList[key];\n            if(!fns){\n                return false;\n            }\n            if(!fn){\n                fns && ( fns.length = 0 ); //没有传fn就remove所有的订阅消息\n            }else{\n                for(var l = fns.length-1; l>=0; l--){\n                    var _fn = fns[l];\n                    if(_fn === fn){\n                        fns.splice(l, 1);\n                    }\n                }\n            }\n        };\n\n        return {\n            listen: listen,\n            trigger: trigger,\n            remove: remove\n        }\n    })();\n\n    //调用\n    Event.listen('squareMeter88',function(price){\n        console.log('价格='+price);\n    });\n\n    Event.trigger('squareMeter88', 2000000);\n````\n\n可以先发布在订阅的发布订阅模式\n\n````javascript\n    var Event = (function(){\n        var global = this,\n            Event,\n            _default = 'default';\n        Event = function(){\n            var _listen, _trigger, _remove,\n                _slice = Array.prototype.slice,\n                _shift = Array.prototype.shift,\n                _unshift = Array.prototype.unshift,\n                namespaceCache = {},\n                _create,\n                find,\n                each = function( ary, fn ){\n                    var ret;\n                    for(var i=0, l=ary.length; i<l; i++){\n                        var n = ary[i];\n                        ret = fn.call(n, i, n);\n                    }\n                    return ret;\n                };\n                _listen = function( key, fn, cache ){\n                    if( !cache[key] ){\n                        cache[key] = [];\n                    }\n                    cache[key].push(fn);\n                };\n                _remove = function( key, cache, fn ){\n                    if( cache[key] ){\n                        if(fn){\n                            for(var i=cache[key].length; i>=0; i--){\n                                if(cache[key][i]===fn){\n                                    cache[key].splice(i, 1);\n                                }\n                            }\n                        }else{\n                            cache[key] = [];\n                        }\n                    }\n                };\n                _trigger = function(){\n                    var cache = _shift.call(arguments),\n                        key = _shift.call(arguments),\n                        args = arguments,\n                        _self = this,\n                        ret,\n                        stack = cache[key];\n                    if(!stack || !stack.length){\n                        return;\n                    }\n                    return each(stack, function(){\n                        return this.apply(_self, args);\n                    });\n                };\n                _create = function(namespace){\n                    var namespace = namespace || _default;\n                    var cache = {},\n                        offlineStack = [],\n                        ret = {\n                            listen: function(key, fn, last){\n                                _listen(key, fn, cache);\n                                if(offlineStack === null){\n                                    return;\n                                }\n                                if(last === 'last'){\n                                    offlineStack.length && offlineStack.pop()();\n                                }else{\n                                    each(offlineStack, function(){\n                                        this();\n                                    });\n                                }\n                                offlienStack = null;\n                            },\n                            one: function(key, fn, last){\n                                _remove(key, cache);\n                                this.listen(key, fn, last);\n                            },\n                            remove: function(key, fn){\n                                _remvoe(key, cache, fn);\n                            },\n                            trigger: function(){\n                                var fn,\n                                    args,\n                                    _self = this;\n                                _unshift.call(arguments, cache);\n                                args = arguments;\n                                fn = function(){\n                                    return _trigger.apply(_self, args);\n                                };\n                                if(offlineStack){\n                                    return offlineStack.push(fn);\n                                }\n                                return fn();\n                            }\n                        };\n                        return namespace ? ( namespaceCache[ namespace ] ? namespaceCache[ namespace ] : namespaceCache[ namespace ] = ret ) : ret;\n                };\n\n                return {\n                    create: _create,\n                    one: function(key, fn, last){\n                        var event = this.create();\n                            event.one(key, fn, last);\n                    },\n                    remove: function(key, fn){\n                        var event = this.create();\n                            event.remove( key, fn );\n                    },\n                    listen: function(key, fn, last){\n                        var event = this.create();\n                            event.listen(key, fn, last);\n                    },\n                    trigger: function(){\n                        var event = this.create();\n                        event.trigger.apply(this, arguments);\n                    }\n                };\n        }();\n        return Event;\n    })();\n\n    //先发布后订阅\n    Event.trigger('click', 1);\n\n    Event.listen('click', function(a){\n        console.log(a)\n    });\n\n    //使用命名空间\n    Event.create('namespace1').listen('click', function(a){\n        console.log(a);\n    });\n\n    Event.create('namepace1').trigger('click', 1);\n\n    Event.create('namespace2').listen('click', function(a){\n        console.log(a);\n    });\n\n    Event.create('namepace2').trigger('click', 2);\n````\n\n## 命令模式\n\n>命令模式是最简单和优雅的模式之一，命令模式中的命令指的是一个执行某些特定事情的指令。\n\n菜单程序\n\n````javascript\n\n    var setCommand = function(button, command){\n        button.onclick = function(){\n            command.execute();\n        }\n    };\n\n    var MenuBar = {\n        refresh: function(){\n            console.log('刷新菜单目录');\n        }\n    };\n    var SubMenu = {\n        add: function(){\n            console.log('添加子菜单');\n        },\n        del: function(){\n            console.log('删除子菜单');\n        }\n    };\n\n    var RefreshMenuBarCommand = function(receiver){\n        this.receiver = receiver;\n    };\n\n    RefreshMenuBarCommand.prototype.execute = function(){\n        this.receiver.refresh();\n    };\n\n    var AddSubMenuCommand = function(receiver){\n        this.receiver = receiver;\n    };\n\n    AddSubMenuCommand.prototype.execute = function(){\n        this.receiver.add();\n    };\n\n    var DelSubMenuCommand = function(receiver){\n        this.receiver = receiver;\n    };\n\n    DelSubMenuCommand.prototype.execute = function(){\n        console.log('删除子菜单');\n    };\n\n    var refreshMenuBarCommand = new RefreshMenuBarCommand(MenuBar);\n    var addSubMenuCommand = new AddSubMenuCommand(SubMenu);\n    var delSubMenuCommand = new DelSubMenuCommand(SubMenu);\n\n    setCommand(button1, refreshMenuBarCommand);\n    setCommand(button2, addSubMenuCommand);\n    setCommand(button3, delSubMenuCommand);\n\n````\n\n## 组合模式\n\n>组合模式就是用小的子对象来构建更大的对象，而这些小的对象本身也许是由更小的“孙对象”构成的。\n\n更强大的宏命令\n\n````javascript\n    var MacroCommand = function(){\n        return {\n            commandsList:[],\n            add:function(command){\n                this.commandsList.push( command );\n            },\n            execute: function(){\n                for(var i=0, command; command = this.commandsList[ i++ ];){\n                    command.execute();\n                }\n            }\n        }\n    };\n    var openAcCommand = {\n        execute: function(){\n            console.log('打开空调');\n        }\n    };\n    //组合对象\n    var openTvCommand = {\n        execute: function(){\n            console.log('打开电视');\n        }\n    };\n\n    var openSoundCommand = {\n        execute: function(){\n            console.log('打开音响');\n        }\n    };\n\n    var macroCommand1 = MacroCommand();\n    macroCommand1.add(openTvCommand);\n    macroCommand1.add(openSoundCommand);\n\n    //组合对象\n    var closeDoorCommand = {\n        execute: function(){\n            console.log('关门');\n        }\n    };\n    var closePcCommand = {\n        execute: function(){\n            console.log('打开电脑');\n        }\n    };\n    var closeQQCommand = {\n        execute: function(){\n            console.log('登录');\n        }\n    };\n\n    var macroCommand2 = MacroCommand();\n    macroCommand2.add(closeDoorCommand);\n    macroCommand2.add(closePcCommand);\n    macroCommand2.add(closeQQCommand);\n\n    //根组合对象\n    var macroCommand = MacroCommand();\n    macroCommand.add(openAcCommand);\n    macroCommand.add(macroCommand1);\n    macroCommand.add(macroCommand2);\n\n    //组合对象是一个树形结构，它会被递归调用\n    var setCommand = (function(command){\n        command.execute();\n    })(macroCommand);\n````","source":"_posts/javascript设计模式.md","raw":"---\ntitle: javascript设计模式\ndate: 2017-11-26 19:29:57\ntags: javascript\n---\n<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/designMode/1.jpg\" width=\"80%\" height=\"50%\">\n在合适的时间，看到合适的书是幸运的！文中的例子摘自《JavaScript设计模式与开发实践》这本书；\n<!-- more -->\n\n## 单例模式\n\n>保证一个类仅有一个实例，并提供一个访问它的全局访问点；\n\n登录弹窗\n\n````javascript\n    var getSingle = function(fn){\n        var result;\n        return function(){\n            return result || (result = fn.apply(this, arguments));\n        }\n    };\n\n    var createLoginLayer = function(){\n        var div = document.createElement('div');\n        div.innerHTML = '我是登录弹窗';\n        div.style.display = 'none';\n        document.body.appendChild(div);\n        return div;\n    };\n\n    var createSingleLoginLayer = getSingle( createLoginLayer );\n\n    document.getElementById('loginBtn').onclick = function(){\n        var loginLayer = createSingleLoginLayer();\n        loginLayer.style.display = 'block';\n    }\n````\n\n## 策略模式\n\n>定义一系列的算法，把他们一个个封装起来，并且使它们可以相互替换\n\n表单验证\n\n````javascript\n    //策略对象\n    var strategies = {\n        isNonEmpty: function( value, errorMsg ){\n            if( value==='' ){\n                return errorMsg;\n            }\n        },\n        minLength: function( value, length, errorMsg ){\n            if( value.length < length ){\n                return errorMsg;\n            }\n        },\n        isMobile: function( value, errorMsg ){\n            if( !/(^1[3|5|8][0-9]{9}$)/.test( value ) ){\n                return errorMsg;\n            }\n        }\n    };\n\n    //Validator 类\n    var Validator = function(){\n        this.cache = [];\n    };\n\n    Validator.prototype.add = function( dom, rules ){\n        var self = this;\n        for( var i=0, rule; rule = rules[ i++ ]; ){\n            (function(rule){\n                var strategyAry = rule.strategy.split(':');\n                var errorMsg = rule.errorMsg;\n                self.cache.push(function(){\n                    var strategy = strategyAry.shift();\n                    strategyAry.unshift( dom.value );\n                    strategyAry.push(errorMsg);\n                    return strategies[ strategy ].apply( dom, strategyAry );\n                });\n            })(rule)\n        }\n    };\n\n    Validator.prototype.start = function(){\n        for( var i = 0, validatorFunc; validatorFunc = this.cache[ i++ ]; ){\n            var errorMsg = validatorFunc();\n            if( errorMsg ){\n                return errorMsg;\n            }\n        }\n    };\n\n    //客户调用代码\n    var registerForm = document.getElementById( 'registerForm' );\n\n    var validateFunc = function(){\n        var validator = new Validator();\n        validator.add( registerForm.userName,\n         [{ strategy: 'isNonEmpty', errorMsg: '用户名不能为空' },\n          { strategy: 'minLength:10', errorMsg: '用户名长度不能小于10位' }]\n        );\n\n        validator.add( registerForm.password,[{ \n            strategy: 'minLength:6', \n            errorMsg: '密码长度不能小于6位' \n            }]);\n\n        validator.add( registerForm.phoneNumber,[{ \n            strategy: 'isMobile', \n            errorMsg: '手机号码格式不正确' \n            }]);\n\n        var errorMsg = validator.start();\n        return errorMsg;\n    };\n\n    registerForm.onsubmit = function(){\n        var errorMsg = validataFunc();\n        if( errorMsg ){\n            alert( errorMsg );\n            return false;\n        }\n    };\n\n````\n\n## 代理模式\n\n>为一个对象提供一个代用品或占位符，以便控制对它的访问。\n\n图片预加载\n\n````javascript\n    var myImage = (function(){\n        var imgNode = document.createElement('img');\n        document.body.appendChild( imgNode );\n        return function(){\n            imgNode.src = src;\n        }\n    })();\n\n    var proxyImage = (function(){\n        var img = new Image;\n        img.onload = function(){\n            myImage( this.src );\n        }\n        return function( src ){\n            myImage('http://sucimg.itc.cn/avatarimg/903387522_1510992087902_c55');\n            img.src = src;\n        }\n    })();\n\n    proxyImage('http://7xqrwh.com1.z0.glb.clouddn.com/image/designMode/1.jpg');\n````\n\n## 迭代器模式\n\n>提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。\n\n外部迭代器\n\n````javascript\n    var Iterator = function( obj ){\n        var current = 0;\n        var next = function(){\n            current += 1;\n        }\n        var isDone = function(){\n            return current >= obj.length;\n        }\n        var getCurrItem = function(){\n            return obj[current];\n        }\n        return {\n            next:next,\n            isDone:isDone,\n            getCurrItem:getCurrItem\n        }\n    };\n\n    //比较2个数组是否相等\n    var compare = function(iterator1, iterator2){\n        while(!iterator1.isDone() && !iterator2.isDone()){\n            if(iterator1.getCurrItem() !== iterator2.getCurrItem()){\n                throw new Error('iterator1 和 iterator2不相等');\n            }\n            iteration1.next();\n            iteration2.next();\n        }\n        alert('iterator1 和 iterator2相等');\n    }\n\n    var iterator1 = Iterator([1,2,3]);\n    var iterator2 = Iterator([1,2,3]);\n\n    cpmpare(iterator1, iterator2);\n````\n\n倒序迭代器\n\n````javascript\n    var reverseEach = function(ary, callback){\n        for( var l = arr.length - 1; l>=0; l--; ){\n            callback(l, ary[l]);\n        }\n    };\n\n    reverseEach([0,1,2], function(i, n){\n        console.log(n);  //2,1,0\n    });\n````\n\n终止迭代器\n\n````javascript\n    var each = function(ary, callback){\n        for( var i=0; i<ary.length; i<l; i++ ){\n            if( callback(i, ary[i]) === false ){\n                break;\n            }\n        }\n    };\n\n    each([1,2,3,4,5], function(i, n){\n        if(n>3){\n            return false;\n        }\n        console.log(n); //1,2,3\n    })\n````\n\n## 发布订阅模式\n\n>发布订阅模式又叫观察者模式，它定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。\n\n全局的发布订阅对象\n\n````javascript\n    var Event = (function(){\n        var clientList = {},\n            listen,\n            trigger,\n            remove;\n\n        listen = function(key, fn){\n            if( !clientList[key] ){\n                clientList[key] = [];\n            }\n            clientList[key].push(fn);\n        };\n\n        trigger = function(){\n            var key = Array.prototype.shift.call( arguments );\n                fns = clientList[key];\n                if(!fns || fns.length === 0){\n                    return false;\n                }\n                for(var i=0, fn; fn = fns[i++];){\n                    fn.apply(this, arguments);\n                }\n        };\n\n        remove = function(key, fn){\n            var fns = clientList[key];\n            if(!fns){\n                return false;\n            }\n            if(!fn){\n                fns && ( fns.length = 0 ); //没有传fn就remove所有的订阅消息\n            }else{\n                for(var l = fns.length-1; l>=0; l--){\n                    var _fn = fns[l];\n                    if(_fn === fn){\n                        fns.splice(l, 1);\n                    }\n                }\n            }\n        };\n\n        return {\n            listen: listen,\n            trigger: trigger,\n            remove: remove\n        }\n    })();\n\n    //调用\n    Event.listen('squareMeter88',function(price){\n        console.log('价格='+price);\n    });\n\n    Event.trigger('squareMeter88', 2000000);\n````\n\n可以先发布在订阅的发布订阅模式\n\n````javascript\n    var Event = (function(){\n        var global = this,\n            Event,\n            _default = 'default';\n        Event = function(){\n            var _listen, _trigger, _remove,\n                _slice = Array.prototype.slice,\n                _shift = Array.prototype.shift,\n                _unshift = Array.prototype.unshift,\n                namespaceCache = {},\n                _create,\n                find,\n                each = function( ary, fn ){\n                    var ret;\n                    for(var i=0, l=ary.length; i<l; i++){\n                        var n = ary[i];\n                        ret = fn.call(n, i, n);\n                    }\n                    return ret;\n                };\n                _listen = function( key, fn, cache ){\n                    if( !cache[key] ){\n                        cache[key] = [];\n                    }\n                    cache[key].push(fn);\n                };\n                _remove = function( key, cache, fn ){\n                    if( cache[key] ){\n                        if(fn){\n                            for(var i=cache[key].length; i>=0; i--){\n                                if(cache[key][i]===fn){\n                                    cache[key].splice(i, 1);\n                                }\n                            }\n                        }else{\n                            cache[key] = [];\n                        }\n                    }\n                };\n                _trigger = function(){\n                    var cache = _shift.call(arguments),\n                        key = _shift.call(arguments),\n                        args = arguments,\n                        _self = this,\n                        ret,\n                        stack = cache[key];\n                    if(!stack || !stack.length){\n                        return;\n                    }\n                    return each(stack, function(){\n                        return this.apply(_self, args);\n                    });\n                };\n                _create = function(namespace){\n                    var namespace = namespace || _default;\n                    var cache = {},\n                        offlineStack = [],\n                        ret = {\n                            listen: function(key, fn, last){\n                                _listen(key, fn, cache);\n                                if(offlineStack === null){\n                                    return;\n                                }\n                                if(last === 'last'){\n                                    offlineStack.length && offlineStack.pop()();\n                                }else{\n                                    each(offlineStack, function(){\n                                        this();\n                                    });\n                                }\n                                offlienStack = null;\n                            },\n                            one: function(key, fn, last){\n                                _remove(key, cache);\n                                this.listen(key, fn, last);\n                            },\n                            remove: function(key, fn){\n                                _remvoe(key, cache, fn);\n                            },\n                            trigger: function(){\n                                var fn,\n                                    args,\n                                    _self = this;\n                                _unshift.call(arguments, cache);\n                                args = arguments;\n                                fn = function(){\n                                    return _trigger.apply(_self, args);\n                                };\n                                if(offlineStack){\n                                    return offlineStack.push(fn);\n                                }\n                                return fn();\n                            }\n                        };\n                        return namespace ? ( namespaceCache[ namespace ] ? namespaceCache[ namespace ] : namespaceCache[ namespace ] = ret ) : ret;\n                };\n\n                return {\n                    create: _create,\n                    one: function(key, fn, last){\n                        var event = this.create();\n                            event.one(key, fn, last);\n                    },\n                    remove: function(key, fn){\n                        var event = this.create();\n                            event.remove( key, fn );\n                    },\n                    listen: function(key, fn, last){\n                        var event = this.create();\n                            event.listen(key, fn, last);\n                    },\n                    trigger: function(){\n                        var event = this.create();\n                        event.trigger.apply(this, arguments);\n                    }\n                };\n        }();\n        return Event;\n    })();\n\n    //先发布后订阅\n    Event.trigger('click', 1);\n\n    Event.listen('click', function(a){\n        console.log(a)\n    });\n\n    //使用命名空间\n    Event.create('namespace1').listen('click', function(a){\n        console.log(a);\n    });\n\n    Event.create('namepace1').trigger('click', 1);\n\n    Event.create('namespace2').listen('click', function(a){\n        console.log(a);\n    });\n\n    Event.create('namepace2').trigger('click', 2);\n````\n\n## 命令模式\n\n>命令模式是最简单和优雅的模式之一，命令模式中的命令指的是一个执行某些特定事情的指令。\n\n菜单程序\n\n````javascript\n\n    var setCommand = function(button, command){\n        button.onclick = function(){\n            command.execute();\n        }\n    };\n\n    var MenuBar = {\n        refresh: function(){\n            console.log('刷新菜单目录');\n        }\n    };\n    var SubMenu = {\n        add: function(){\n            console.log('添加子菜单');\n        },\n        del: function(){\n            console.log('删除子菜单');\n        }\n    };\n\n    var RefreshMenuBarCommand = function(receiver){\n        this.receiver = receiver;\n    };\n\n    RefreshMenuBarCommand.prototype.execute = function(){\n        this.receiver.refresh();\n    };\n\n    var AddSubMenuCommand = function(receiver){\n        this.receiver = receiver;\n    };\n\n    AddSubMenuCommand.prototype.execute = function(){\n        this.receiver.add();\n    };\n\n    var DelSubMenuCommand = function(receiver){\n        this.receiver = receiver;\n    };\n\n    DelSubMenuCommand.prototype.execute = function(){\n        console.log('删除子菜单');\n    };\n\n    var refreshMenuBarCommand = new RefreshMenuBarCommand(MenuBar);\n    var addSubMenuCommand = new AddSubMenuCommand(SubMenu);\n    var delSubMenuCommand = new DelSubMenuCommand(SubMenu);\n\n    setCommand(button1, refreshMenuBarCommand);\n    setCommand(button2, addSubMenuCommand);\n    setCommand(button3, delSubMenuCommand);\n\n````\n\n## 组合模式\n\n>组合模式就是用小的子对象来构建更大的对象，而这些小的对象本身也许是由更小的“孙对象”构成的。\n\n更强大的宏命令\n\n````javascript\n    var MacroCommand = function(){\n        return {\n            commandsList:[],\n            add:function(command){\n                this.commandsList.push( command );\n            },\n            execute: function(){\n                for(var i=0, command; command = this.commandsList[ i++ ];){\n                    command.execute();\n                }\n            }\n        }\n    };\n    var openAcCommand = {\n        execute: function(){\n            console.log('打开空调');\n        }\n    };\n    //组合对象\n    var openTvCommand = {\n        execute: function(){\n            console.log('打开电视');\n        }\n    };\n\n    var openSoundCommand = {\n        execute: function(){\n            console.log('打开音响');\n        }\n    };\n\n    var macroCommand1 = MacroCommand();\n    macroCommand1.add(openTvCommand);\n    macroCommand1.add(openSoundCommand);\n\n    //组合对象\n    var closeDoorCommand = {\n        execute: function(){\n            console.log('关门');\n        }\n    };\n    var closePcCommand = {\n        execute: function(){\n            console.log('打开电脑');\n        }\n    };\n    var closeQQCommand = {\n        execute: function(){\n            console.log('登录');\n        }\n    };\n\n    var macroCommand2 = MacroCommand();\n    macroCommand2.add(closeDoorCommand);\n    macroCommand2.add(closePcCommand);\n    macroCommand2.add(closeQQCommand);\n\n    //根组合对象\n    var macroCommand = MacroCommand();\n    macroCommand.add(openAcCommand);\n    macroCommand.add(macroCommand1);\n    macroCommand.add(macroCommand2);\n\n    //组合对象是一个树形结构，它会被递归调用\n    var setCommand = (function(command){\n        command.execute();\n    })(macroCommand);\n````","slug":"javascript设计模式","published":1,"updated":"2019-03-21T04:23:24.640Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckknbqwfn000110udqb37gg1m","content":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/designMode/1.jpg\" width=\"80%\" height=\"50%\"><br>在合适的时间，看到合适的书是幸运的！文中的例子摘自《JavaScript设计模式与开发实践》这本书；<br><a id=\"more\"></a></p>\n<h2 id=\"单例模式\"><a href=\"#单例模式\" class=\"headerlink\" title=\"单例模式\"></a>单例模式</h2><blockquote>\n<p>保证一个类仅有一个实例，并提供一个访问它的全局访问点；</p>\n</blockquote>\n<p>登录弹窗</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> getSingle = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result || (result = fn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> createLoginLayer = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> div = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">    div.innerHTML = <span class=\"string\">'我是登录弹窗'</span>;</span><br><span class=\"line\">    div.style.display = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(div);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> div;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> createSingleLoginLayer = getSingle( createLoginLayer );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'loginBtn'</span>).onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> loginLayer = createSingleLoginLayer();</span><br><span class=\"line\">    loginLayer.style.display = <span class=\"string\">'block'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"策略模式\"><a href=\"#策略模式\" class=\"headerlink\" title=\"策略模式\"></a>策略模式</h2><blockquote>\n<p>定义一系列的算法，把他们一个个封装起来，并且使它们可以相互替换</p>\n</blockquote>\n<p>表单验证</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//策略对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> strategies = &#123;</span><br><span class=\"line\">    isNonEmpty: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value, errorMsg </span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( value===<span class=\"string\">''</span> )&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> errorMsg;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    minLength: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value, length, errorMsg </span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( value.length &lt; length )&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> errorMsg;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    isMobile: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value, errorMsg </span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( !<span class=\"regexp\">/(^1[3|5|8][0-9]&#123;9&#125;$)/</span>.test( value ) )&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> errorMsg;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Validator 类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Validator = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.cache = [];</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Validator.prototype.add = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> dom, rules </span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i=<span class=\"number\">0</span>, rule; rule = rules[ i++ ]; )&#123;</span><br><span class=\"line\">        (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">rule</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> strategyAry = rule.strategy.split(<span class=\"string\">':'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> errorMsg = rule.errorMsg;</span><br><span class=\"line\">            self.cache.push(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> strategy = strategyAry.shift();</span><br><span class=\"line\">                strategyAry.unshift( dom.value );</span><br><span class=\"line\">                strategyAry.push(errorMsg);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> strategies[ strategy ].apply( dom, strategyAry );</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;)(rule)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Validator.prototype.start = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, validatorFunc; validatorFunc = <span class=\"keyword\">this</span>.cache[ i++ ]; )&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> errorMsg = validatorFunc();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( errorMsg )&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> errorMsg;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//客户调用代码</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> registerForm = <span class=\"built_in\">document</span>.getElementById( <span class=\"string\">'registerForm'</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> validateFunc = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> validator = <span class=\"keyword\">new</span> Validator();</span><br><span class=\"line\">    validator.add( registerForm.userName,</span><br><span class=\"line\">     [&#123; <span class=\"attr\">strategy</span>: <span class=\"string\">'isNonEmpty'</span>, <span class=\"attr\">errorMsg</span>: <span class=\"string\">'用户名不能为空'</span> &#125;,</span><br><span class=\"line\">      &#123; <span class=\"attr\">strategy</span>: <span class=\"string\">'minLength:10'</span>, <span class=\"attr\">errorMsg</span>: <span class=\"string\">'用户名长度不能小于10位'</span> &#125;]</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    validator.add( registerForm.password,[&#123; </span><br><span class=\"line\">        strategy: <span class=\"string\">'minLength:6'</span>, </span><br><span class=\"line\">        errorMsg: <span class=\"string\">'密码长度不能小于6位'</span> </span><br><span class=\"line\">        &#125;]);</span><br><span class=\"line\"></span><br><span class=\"line\">    validator.add( registerForm.phoneNumber,[&#123; </span><br><span class=\"line\">        strategy: <span class=\"string\">'isMobile'</span>, </span><br><span class=\"line\">        errorMsg: <span class=\"string\">'手机号码格式不正确'</span> </span><br><span class=\"line\">        &#125;]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> errorMsg = validator.start();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> errorMsg;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">registerForm.onsubmit = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> errorMsg = validataFunc();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( errorMsg )&#123;</span><br><span class=\"line\">        alert( errorMsg );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"代理模式\"><a href=\"#代理模式\" class=\"headerlink\" title=\"代理模式\"></a>代理模式</h2><blockquote>\n<p>为一个对象提供一个代用品或占位符，以便控制对它的访问。</p>\n</blockquote>\n<p>图片预加载</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> myImage = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgNode = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild( imgNode );</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        imgNode.src = src;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> proxyImage = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> img = <span class=\"keyword\">new</span> Image;</span><br><span class=\"line\">    img.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        myImage( <span class=\"keyword\">this</span>.src );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> src </span>)</span>&#123;</span><br><span class=\"line\">        myImage(<span class=\"string\">'http://sucimg.itc.cn/avatarimg/903387522_1510992087902_c55'</span>);</span><br><span class=\"line\">        img.src = src;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\">proxyImage(<span class=\"string\">'http://7xqrwh.com1.z0.glb.clouddn.com/image/designMode/1.jpg'</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"迭代器模式\"><a href=\"#迭代器模式\" class=\"headerlink\" title=\"迭代器模式\"></a>迭代器模式</h2><blockquote>\n<p>提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。</p>\n</blockquote>\n<p>外部迭代器</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Iterator = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> obj </span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> current = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> next = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        current += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isDone = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> current &gt;= obj.length;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> getCurrItem = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj[current];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        next:next,</span><br><span class=\"line\">        isDone:isDone,</span><br><span class=\"line\">        getCurrItem:getCurrItem</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//比较2个数组是否相等</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> compare = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">iterator1, iterator2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(!iterator1.isDone() &amp;&amp; !iterator2.isDone())&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(iterator1.getCurrItem() !== iterator2.getCurrItem())&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'iterator1 和 iterator2不相等'</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        iteration1.next();</span><br><span class=\"line\">        iteration2.next();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    alert(<span class=\"string\">'iterator1 和 iterator2相等'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> iterator1 = Iterator([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]);</span><br><span class=\"line\"><span class=\"keyword\">var</span> iterator2 = Iterator([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">cpmpare(iterator1, iterator2);</span><br></pre></td></tr></table></figure>\n<p>倒序迭代器</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> reverseEach = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ary, callback</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> l = arr.length - <span class=\"number\">1</span>; l&gt;=<span class=\"number\">0</span>; l--; )&#123;</span><br><span class=\"line\">        callback(l, ary[l]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">reverseEach([<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i, n</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(n);  <span class=\"comment\">//2,1,0</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>终止迭代器</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> each = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ary, callback</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i&lt;ary.length; i&lt;l; i++ )&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( callback(i, ary[i]) === <span class=\"literal\">false</span> )&#123;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">each([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i, n</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(n&gt;<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(n); <span class=\"comment\">//1,2,3</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"发布订阅模式\"><a href=\"#发布订阅模式\" class=\"headerlink\" title=\"发布订阅模式\"></a>发布订阅模式</h2><blockquote>\n<p>发布订阅模式又叫观察者模式，它定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。</p>\n</blockquote>\n<p>全局的发布订阅对象</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Event = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> clientList = &#123;&#125;,</span><br><span class=\"line\">        listen,</span><br><span class=\"line\">        trigger,</span><br><span class=\"line\">        remove;</span><br><span class=\"line\"></span><br><span class=\"line\">    listen = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( !clientList[key] )&#123;</span><br><span class=\"line\">            clientList[key] = [];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        clientList[key].push(fn);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    trigger = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> key = <span class=\"built_in\">Array</span>.prototype.shift.call( <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">            fns = clientList[key];</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!fns || fns.length === <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>, fn; fn = fns[i++];)&#123;</span><br><span class=\"line\">                fn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    remove = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> fns = clientList[key];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!fns)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!fn)&#123;</span><br><span class=\"line\">            fns &amp;&amp; ( fns.length = <span class=\"number\">0</span> ); <span class=\"comment\">//没有传fn就remove所有的订阅消息</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> l = fns.length<span class=\"number\">-1</span>; l&gt;=<span class=\"number\">0</span>; l--)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> _fn = fns[l];</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(_fn === fn)&#123;</span><br><span class=\"line\">                    fns.splice(l, <span class=\"number\">1</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        listen: listen,</span><br><span class=\"line\">        trigger: trigger,</span><br><span class=\"line\">        remove: remove</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//调用</span></span><br><span class=\"line\">Event.listen(<span class=\"string\">'squareMeter88'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">price</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'价格='</span>+price);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">Event.trigger(<span class=\"string\">'squareMeter88'</span>, <span class=\"number\">2000000</span>);</span><br></pre></td></tr></table></figure>\n<p>可以先发布在订阅的发布订阅模式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Event = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> global = <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        Event,</span><br><span class=\"line\">        _default = <span class=\"string\">'default'</span>;</span><br><span class=\"line\">    Event = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> _listen, _trigger, _remove,</span><br><span class=\"line\">            _slice = <span class=\"built_in\">Array</span>.prototype.slice,</span><br><span class=\"line\">            _shift = <span class=\"built_in\">Array</span>.prototype.shift,</span><br><span class=\"line\">            _unshift = <span class=\"built_in\">Array</span>.prototype.unshift,</span><br><span class=\"line\">            namespaceCache = &#123;&#125;,</span><br><span class=\"line\">            _create,</span><br><span class=\"line\">            find,</span><br><span class=\"line\">            each = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> ary, fn </span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> ret;</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>, l=ary.length; i&lt;l; i++)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> n = ary[i];</span><br><span class=\"line\">                    ret = fn.call(n, i, n);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            _listen = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> key, fn, cache </span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>( !cache[key] )&#123;</span><br><span class=\"line\">                    cache[key] = [];</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                cache[key].push(fn);</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            _remove = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> key, cache, fn </span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>( cache[key] )&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(fn)&#123;</span><br><span class=\"line\">                        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=cache[key].length; i&gt;=<span class=\"number\">0</span>; i--)&#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span>(cache[key][i]===fn)&#123;</span><br><span class=\"line\">                                cache[key].splice(i, <span class=\"number\">1</span>);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                        cache[key] = [];</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            _trigger = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> cache = _shift.call(<span class=\"built_in\">arguments</span>),</span><br><span class=\"line\">                    key = _shift.call(<span class=\"built_in\">arguments</span>),</span><br><span class=\"line\">                    args = <span class=\"built_in\">arguments</span>,</span><br><span class=\"line\">                    _self = <span class=\"keyword\">this</span>,</span><br><span class=\"line\">                    ret,</span><br><span class=\"line\">                    stack = cache[key];</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(!stack || !stack.length)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> each(stack, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.apply(_self, args);</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            _create = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">namespace</span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> namespace = namespace || _default;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> cache = &#123;&#125;,</span><br><span class=\"line\">                    offlineStack = [],</span><br><span class=\"line\">                    ret = &#123;</span><br><span class=\"line\">                        listen: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn, last</span>)</span>&#123;</span><br><span class=\"line\">                            _listen(key, fn, cache);</span><br><span class=\"line\">                            <span class=\"keyword\">if</span>(offlineStack === <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span>(last === <span class=\"string\">'last'</span>)&#123;</span><br><span class=\"line\">                                offlineStack.length &amp;&amp; offlineStack.pop()();</span><br><span class=\"line\">                            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                                each(offlineStack, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                                    <span class=\"keyword\">this</span>();</span><br><span class=\"line\">                                &#125;);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            offlienStack = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        one: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn, last</span>)</span>&#123;</span><br><span class=\"line\">                            _remove(key, cache);</span><br><span class=\"line\">                            <span class=\"keyword\">this</span>.listen(key, fn, last);</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        remove: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn</span>)</span>&#123;</span><br><span class=\"line\">                            _remvoe(key, cache, fn);</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        trigger: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                            <span class=\"keyword\">var</span> fn,</span><br><span class=\"line\">                                args,</span><br><span class=\"line\">                                _self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">                            _unshift.call(<span class=\"built_in\">arguments</span>, cache);</span><br><span class=\"line\">                            args = <span class=\"built_in\">arguments</span>;</span><br><span class=\"line\">                            fn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> _trigger.apply(_self, args);</span><br><span class=\"line\">                            &#125;;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span>(offlineStack)&#123;</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> offlineStack.push(fn);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"keyword\">return</span> fn();</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> namespace ? ( namespaceCache[ namespace ] ? namespaceCache[ namespace ] : namespaceCache[ namespace ] = ret ) : ret;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                create: _create,</span><br><span class=\"line\">                one: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn, last</span>)</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> event = <span class=\"keyword\">this</span>.create();</span><br><span class=\"line\">                        event.one(key, fn, last);</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                remove: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn</span>)</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> event = <span class=\"keyword\">this</span>.create();</span><br><span class=\"line\">                        event.remove( key, fn );</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                listen: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn, last</span>)</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> event = <span class=\"keyword\">this</span>.create();</span><br><span class=\"line\">                        event.listen(key, fn, last);</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                trigger: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> event = <span class=\"keyword\">this</span>.create();</span><br><span class=\"line\">                    event.trigger.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">    &#125;();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Event;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//先发布后订阅</span></span><br><span class=\"line\">Event.trigger(<span class=\"string\">'click'</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">Event.listen(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//使用命名空间</span></span><br><span class=\"line\">Event.create(<span class=\"string\">'namespace1'</span>).listen(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">Event.create(<span class=\"string\">'namepace1'</span>).trigger(<span class=\"string\">'click'</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">Event.create(<span class=\"string\">'namespace2'</span>).listen(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">Event.create(<span class=\"string\">'namepace2'</span>).trigger(<span class=\"string\">'click'</span>, <span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"命令模式\"><a href=\"#命令模式\" class=\"headerlink\" title=\"命令模式\"></a>命令模式</h2><blockquote>\n<p>命令模式是最简单和优雅的模式之一，命令模式中的命令指的是一个执行某些特定事情的指令。</p>\n</blockquote>\n<p>菜单程序</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> setCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">button, command</span>)</span>&#123;</span><br><span class=\"line\">    button.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        command.execute();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuBar = &#123;</span><br><span class=\"line\">    refresh: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'刷新菜单目录'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> SubMenu = &#123;</span><br><span class=\"line\">    add: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'添加子菜单'</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    del: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'删除子菜单'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> RefreshMenuBarCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">RefreshMenuBarCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.refresh();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> AddSubMenuCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">AddSubMenuCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.add();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> DelSubMenuCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">DelSubMenuCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'删除子菜单'</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> refreshMenuBarCommand = <span class=\"keyword\">new</span> RefreshMenuBarCommand(MenuBar);</span><br><span class=\"line\"><span class=\"keyword\">var</span> addSubMenuCommand = <span class=\"keyword\">new</span> AddSubMenuCommand(SubMenu);</span><br><span class=\"line\"><span class=\"keyword\">var</span> delSubMenuCommand = <span class=\"keyword\">new</span> DelSubMenuCommand(SubMenu);</span><br><span class=\"line\"></span><br><span class=\"line\">setCommand(button1, refreshMenuBarCommand);</span><br><span class=\"line\">setCommand(button2, addSubMenuCommand);</span><br><span class=\"line\">setCommand(button3, delSubMenuCommand);</span><br></pre></td></tr></table></figure>\n<h2 id=\"组合模式\"><a href=\"#组合模式\" class=\"headerlink\" title=\"组合模式\"></a>组合模式</h2><blockquote>\n<p>组合模式就是用小的子对象来构建更大的对象，而这些小的对象本身也许是由更小的“孙对象”构成的。</p>\n</blockquote>\n<p>更强大的宏命令</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> MacroCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        commandsList:[],</span><br><span class=\"line\">        add:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">command</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.commandsList.push( command );</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>, command; command = <span class=\"keyword\">this</span>.commandsList[ i++ ];)&#123;</span><br><span class=\"line\">                command.execute();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> openAcCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开空调'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">//组合对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> openTvCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开电视'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> openSoundCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开音响'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> macroCommand1 = MacroCommand();</span><br><span class=\"line\">macroCommand1.add(openTvCommand);</span><br><span class=\"line\">macroCommand1.add(openSoundCommand);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//组合对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> closeDoorCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'关门'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> closePcCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开电脑'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> closeQQCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'登录'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> macroCommand2 = MacroCommand();</span><br><span class=\"line\">macroCommand2.add(closeDoorCommand);</span><br><span class=\"line\">macroCommand2.add(closePcCommand);</span><br><span class=\"line\">macroCommand2.add(closeQQCommand);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//根组合对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> macroCommand = MacroCommand();</span><br><span class=\"line\">macroCommand.add(openAcCommand);</span><br><span class=\"line\">macroCommand.add(macroCommand1);</span><br><span class=\"line\">macroCommand.add(macroCommand2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//组合对象是一个树形结构，它会被递归调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> setCommand = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">command</span>)</span>&#123;</span><br><span class=\"line\">    command.execute();</span><br><span class=\"line\">&#125;)(macroCommand);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/designMode/1.jpg\" width=\"80%\" height=\"50%\"><br>在合适的时间，看到合适的书是幸运的！文中的例子摘自《JavaScript设计模式与开发实践》这本书；<br>","more":"</p>\n<h2 id=\"单例模式\"><a href=\"#单例模式\" class=\"headerlink\" title=\"单例模式\"></a>单例模式</h2><blockquote>\n<p>保证一个类仅有一个实例，并提供一个访问它的全局访问点；</p>\n</blockquote>\n<p>登录弹窗</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> getSingle = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result || (result = fn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> createLoginLayer = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> div = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">    div.innerHTML = <span class=\"string\">'我是登录弹窗'</span>;</span><br><span class=\"line\">    div.style.display = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(div);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> div;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> createSingleLoginLayer = getSingle( createLoginLayer );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'loginBtn'</span>).onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> loginLayer = createSingleLoginLayer();</span><br><span class=\"line\">    loginLayer.style.display = <span class=\"string\">'block'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"策略模式\"><a href=\"#策略模式\" class=\"headerlink\" title=\"策略模式\"></a>策略模式</h2><blockquote>\n<p>定义一系列的算法，把他们一个个封装起来，并且使它们可以相互替换</p>\n</blockquote>\n<p>表单验证</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//策略对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> strategies = &#123;</span><br><span class=\"line\">    isNonEmpty: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value, errorMsg </span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( value===<span class=\"string\">''</span> )&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> errorMsg;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    minLength: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value, length, errorMsg </span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( value.length &lt; length )&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> errorMsg;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    isMobile: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> value, errorMsg </span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( !<span class=\"regexp\">/(^1[3|5|8][0-9]&#123;9&#125;$)/</span>.test( value ) )&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> errorMsg;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Validator 类</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Validator = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.cache = [];</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Validator.prototype.add = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> dom, rules </span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i=<span class=\"number\">0</span>, rule; rule = rules[ i++ ]; )&#123;</span><br><span class=\"line\">        (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">rule</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> strategyAry = rule.strategy.split(<span class=\"string\">':'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> errorMsg = rule.errorMsg;</span><br><span class=\"line\">            self.cache.push(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> strategy = strategyAry.shift();</span><br><span class=\"line\">                strategyAry.unshift( dom.value );</span><br><span class=\"line\">                strategyAry.push(errorMsg);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> strategies[ strategy ].apply( dom, strategyAry );</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;)(rule)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Validator.prototype.start = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, validatorFunc; validatorFunc = <span class=\"keyword\">this</span>.cache[ i++ ]; )&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> errorMsg = validatorFunc();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( errorMsg )&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> errorMsg;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//客户调用代码</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> registerForm = <span class=\"built_in\">document</span>.getElementById( <span class=\"string\">'registerForm'</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> validateFunc = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> validator = <span class=\"keyword\">new</span> Validator();</span><br><span class=\"line\">    validator.add( registerForm.userName,</span><br><span class=\"line\">     [&#123; <span class=\"attr\">strategy</span>: <span class=\"string\">'isNonEmpty'</span>, <span class=\"attr\">errorMsg</span>: <span class=\"string\">'用户名不能为空'</span> &#125;,</span><br><span class=\"line\">      &#123; <span class=\"attr\">strategy</span>: <span class=\"string\">'minLength:10'</span>, <span class=\"attr\">errorMsg</span>: <span class=\"string\">'用户名长度不能小于10位'</span> &#125;]</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    validator.add( registerForm.password,[&#123; </span><br><span class=\"line\">        strategy: <span class=\"string\">'minLength:6'</span>, </span><br><span class=\"line\">        errorMsg: <span class=\"string\">'密码长度不能小于6位'</span> </span><br><span class=\"line\">        &#125;]);</span><br><span class=\"line\"></span><br><span class=\"line\">    validator.add( registerForm.phoneNumber,[&#123; </span><br><span class=\"line\">        strategy: <span class=\"string\">'isMobile'</span>, </span><br><span class=\"line\">        errorMsg: <span class=\"string\">'手机号码格式不正确'</span> </span><br><span class=\"line\">        &#125;]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> errorMsg = validator.start();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> errorMsg;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">registerForm.onsubmit = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> errorMsg = validataFunc();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( errorMsg )&#123;</span><br><span class=\"line\">        alert( errorMsg );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"代理模式\"><a href=\"#代理模式\" class=\"headerlink\" title=\"代理模式\"></a>代理模式</h2><blockquote>\n<p>为一个对象提供一个代用品或占位符，以便控制对它的访问。</p>\n</blockquote>\n<p>图片预加载</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> myImage = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgNode = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild( imgNode );</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        imgNode.src = src;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> proxyImage = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> img = <span class=\"keyword\">new</span> Image;</span><br><span class=\"line\">    img.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        myImage( <span class=\"keyword\">this</span>.src );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> src </span>)</span>&#123;</span><br><span class=\"line\">        myImage(<span class=\"string\">'http://sucimg.itc.cn/avatarimg/903387522_1510992087902_c55'</span>);</span><br><span class=\"line\">        img.src = src;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\">proxyImage(<span class=\"string\">'http://7xqrwh.com1.z0.glb.clouddn.com/image/designMode/1.jpg'</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"迭代器模式\"><a href=\"#迭代器模式\" class=\"headerlink\" title=\"迭代器模式\"></a>迭代器模式</h2><blockquote>\n<p>提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。</p>\n</blockquote>\n<p>外部迭代器</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Iterator = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> obj </span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> current = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> next = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        current += <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isDone = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> current &gt;= obj.length;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> getCurrItem = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj[current];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        next:next,</span><br><span class=\"line\">        isDone:isDone,</span><br><span class=\"line\">        getCurrItem:getCurrItem</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//比较2个数组是否相等</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> compare = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">iterator1, iterator2</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(!iterator1.isDone() &amp;&amp; !iterator2.isDone())&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(iterator1.getCurrItem() !== iterator2.getCurrItem())&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'iterator1 和 iterator2不相等'</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        iteration1.next();</span><br><span class=\"line\">        iteration2.next();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    alert(<span class=\"string\">'iterator1 和 iterator2相等'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> iterator1 = Iterator([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]);</span><br><span class=\"line\"><span class=\"keyword\">var</span> iterator2 = Iterator([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">cpmpare(iterator1, iterator2);</span><br></pre></td></tr></table></figure>\n<p>倒序迭代器</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> reverseEach = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ary, callback</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> l = arr.length - <span class=\"number\">1</span>; l&gt;=<span class=\"number\">0</span>; l--; )&#123;</span><br><span class=\"line\">        callback(l, ary[l]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">reverseEach([<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i, n</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(n);  <span class=\"comment\">//2,1,0</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>终止迭代器</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> each = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ary, callback</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i&lt;ary.length; i&lt;l; i++ )&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( callback(i, ary[i]) === <span class=\"literal\">false</span> )&#123;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">each([<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">i, n</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(n&gt;<span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(n); <span class=\"comment\">//1,2,3</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"发布订阅模式\"><a href=\"#发布订阅模式\" class=\"headerlink\" title=\"发布订阅模式\"></a>发布订阅模式</h2><blockquote>\n<p>发布订阅模式又叫观察者模式，它定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。</p>\n</blockquote>\n<p>全局的发布订阅对象</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Event = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> clientList = &#123;&#125;,</span><br><span class=\"line\">        listen,</span><br><span class=\"line\">        trigger,</span><br><span class=\"line\">        remove;</span><br><span class=\"line\"></span><br><span class=\"line\">    listen = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( !clientList[key] )&#123;</span><br><span class=\"line\">            clientList[key] = [];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        clientList[key].push(fn);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    trigger = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> key = <span class=\"built_in\">Array</span>.prototype.shift.call( <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">            fns = clientList[key];</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(!fns || fns.length === <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>, fn; fn = fns[i++];)&#123;</span><br><span class=\"line\">                fn.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    remove = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> fns = clientList[key];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!fns)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!fn)&#123;</span><br><span class=\"line\">            fns &amp;&amp; ( fns.length = <span class=\"number\">0</span> ); <span class=\"comment\">//没有传fn就remove所有的订阅消息</span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> l = fns.length<span class=\"number\">-1</span>; l&gt;=<span class=\"number\">0</span>; l--)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> _fn = fns[l];</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(_fn === fn)&#123;</span><br><span class=\"line\">                    fns.splice(l, <span class=\"number\">1</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        listen: listen,</span><br><span class=\"line\">        trigger: trigger,</span><br><span class=\"line\">        remove: remove</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//调用</span></span><br><span class=\"line\">Event.listen(<span class=\"string\">'squareMeter88'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">price</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'价格='</span>+price);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">Event.trigger(<span class=\"string\">'squareMeter88'</span>, <span class=\"number\">2000000</span>);</span><br></pre></td></tr></table></figure>\n<p>可以先发布在订阅的发布订阅模式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Event = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> global = <span class=\"keyword\">this</span>,</span><br><span class=\"line\">        Event,</span><br><span class=\"line\">        _default = <span class=\"string\">'default'</span>;</span><br><span class=\"line\">    Event = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> _listen, _trigger, _remove,</span><br><span class=\"line\">            _slice = <span class=\"built_in\">Array</span>.prototype.slice,</span><br><span class=\"line\">            _shift = <span class=\"built_in\">Array</span>.prototype.shift,</span><br><span class=\"line\">            _unshift = <span class=\"built_in\">Array</span>.prototype.unshift,</span><br><span class=\"line\">            namespaceCache = &#123;&#125;,</span><br><span class=\"line\">            _create,</span><br><span class=\"line\">            find,</span><br><span class=\"line\">            each = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> ary, fn </span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> ret;</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>, l=ary.length; i&lt;l; i++)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> n = ary[i];</span><br><span class=\"line\">                    ret = fn.call(n, i, n);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            _listen = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> key, fn, cache </span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>( !cache[key] )&#123;</span><br><span class=\"line\">                    cache[key] = [];</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                cache[key].push(fn);</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            _remove = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> key, cache, fn </span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>( cache[key] )&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(fn)&#123;</span><br><span class=\"line\">                        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=cache[key].length; i&gt;=<span class=\"number\">0</span>; i--)&#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span>(cache[key][i]===fn)&#123;</span><br><span class=\"line\">                                cache[key].splice(i, <span class=\"number\">1</span>);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                        cache[key] = [];</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            _trigger = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> cache = _shift.call(<span class=\"built_in\">arguments</span>),</span><br><span class=\"line\">                    key = _shift.call(<span class=\"built_in\">arguments</span>),</span><br><span class=\"line\">                    args = <span class=\"built_in\">arguments</span>,</span><br><span class=\"line\">                    _self = <span class=\"keyword\">this</span>,</span><br><span class=\"line\">                    ret,</span><br><span class=\"line\">                    stack = cache[key];</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(!stack || !stack.length)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> each(stack, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.apply(_self, args);</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            _create = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">namespace</span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> namespace = namespace || _default;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> cache = &#123;&#125;,</span><br><span class=\"line\">                    offlineStack = [],</span><br><span class=\"line\">                    ret = &#123;</span><br><span class=\"line\">                        listen: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn, last</span>)</span>&#123;</span><br><span class=\"line\">                            _listen(key, fn, cache);</span><br><span class=\"line\">                            <span class=\"keyword\">if</span>(offlineStack === <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span>(last === <span class=\"string\">'last'</span>)&#123;</span><br><span class=\"line\">                                offlineStack.length &amp;&amp; offlineStack.pop()();</span><br><span class=\"line\">                            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                                each(offlineStack, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                                    <span class=\"keyword\">this</span>();</span><br><span class=\"line\">                                &#125;);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            offlienStack = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        one: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn, last</span>)</span>&#123;</span><br><span class=\"line\">                            _remove(key, cache);</span><br><span class=\"line\">                            <span class=\"keyword\">this</span>.listen(key, fn, last);</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        remove: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn</span>)</span>&#123;</span><br><span class=\"line\">                            _remvoe(key, cache, fn);</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        trigger: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                            <span class=\"keyword\">var</span> fn,</span><br><span class=\"line\">                                args,</span><br><span class=\"line\">                                _self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">                            _unshift.call(<span class=\"built_in\">arguments</span>, cache);</span><br><span class=\"line\">                            args = <span class=\"built_in\">arguments</span>;</span><br><span class=\"line\">                            fn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> _trigger.apply(_self, args);</span><br><span class=\"line\">                            &#125;;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span>(offlineStack)&#123;</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> offlineStack.push(fn);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"keyword\">return</span> fn();</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> namespace ? ( namespaceCache[ namespace ] ? namespaceCache[ namespace ] : namespaceCache[ namespace ] = ret ) : ret;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                create: _create,</span><br><span class=\"line\">                one: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn, last</span>)</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> event = <span class=\"keyword\">this</span>.create();</span><br><span class=\"line\">                        event.one(key, fn, last);</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                remove: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn</span>)</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> event = <span class=\"keyword\">this</span>.create();</span><br><span class=\"line\">                        event.remove( key, fn );</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                listen: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key, fn, last</span>)</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> event = <span class=\"keyword\">this</span>.create();</span><br><span class=\"line\">                        event.listen(key, fn, last);</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                trigger: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> event = <span class=\"keyword\">this</span>.create();</span><br><span class=\"line\">                    event.trigger.apply(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">    &#125;();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Event;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//先发布后订阅</span></span><br><span class=\"line\">Event.trigger(<span class=\"string\">'click'</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">Event.listen(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//使用命名空间</span></span><br><span class=\"line\">Event.create(<span class=\"string\">'namespace1'</span>).listen(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">Event.create(<span class=\"string\">'namepace1'</span>).trigger(<span class=\"string\">'click'</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">Event.create(<span class=\"string\">'namespace2'</span>).listen(<span class=\"string\">'click'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">Event.create(<span class=\"string\">'namepace2'</span>).trigger(<span class=\"string\">'click'</span>, <span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"命令模式\"><a href=\"#命令模式\" class=\"headerlink\" title=\"命令模式\"></a>命令模式</h2><blockquote>\n<p>命令模式是最简单和优雅的模式之一，命令模式中的命令指的是一个执行某些特定事情的指令。</p>\n</blockquote>\n<p>菜单程序</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> setCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">button, command</span>)</span>&#123;</span><br><span class=\"line\">    button.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        command.execute();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> MenuBar = &#123;</span><br><span class=\"line\">    refresh: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'刷新菜单目录'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> SubMenu = &#123;</span><br><span class=\"line\">    add: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'添加子菜单'</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    del: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'删除子菜单'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> RefreshMenuBarCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">RefreshMenuBarCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.refresh();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> AddSubMenuCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">AddSubMenuCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver.add();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> DelSubMenuCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">receiver</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.receiver = receiver;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">DelSubMenuCommand.prototype.execute = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'删除子菜单'</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> refreshMenuBarCommand = <span class=\"keyword\">new</span> RefreshMenuBarCommand(MenuBar);</span><br><span class=\"line\"><span class=\"keyword\">var</span> addSubMenuCommand = <span class=\"keyword\">new</span> AddSubMenuCommand(SubMenu);</span><br><span class=\"line\"><span class=\"keyword\">var</span> delSubMenuCommand = <span class=\"keyword\">new</span> DelSubMenuCommand(SubMenu);</span><br><span class=\"line\"></span><br><span class=\"line\">setCommand(button1, refreshMenuBarCommand);</span><br><span class=\"line\">setCommand(button2, addSubMenuCommand);</span><br><span class=\"line\">setCommand(button3, delSubMenuCommand);</span><br></pre></td></tr></table></figure>\n<h2 id=\"组合模式\"><a href=\"#组合模式\" class=\"headerlink\" title=\"组合模式\"></a>组合模式</h2><blockquote>\n<p>组合模式就是用小的子对象来构建更大的对象，而这些小的对象本身也许是由更小的“孙对象”构成的。</p>\n</blockquote>\n<p>更强大的宏命令</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> MacroCommand = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        commandsList:[],</span><br><span class=\"line\">        add:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">command</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.commandsList.push( command );</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>, command; command = <span class=\"keyword\">this</span>.commandsList[ i++ ];)&#123;</span><br><span class=\"line\">                command.execute();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> openAcCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开空调'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">//组合对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> openTvCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开电视'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> openSoundCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开音响'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> macroCommand1 = MacroCommand();</span><br><span class=\"line\">macroCommand1.add(openTvCommand);</span><br><span class=\"line\">macroCommand1.add(openSoundCommand);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//组合对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> closeDoorCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'关门'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> closePcCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'打开电脑'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> closeQQCommand = &#123;</span><br><span class=\"line\">    execute: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'登录'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> macroCommand2 = MacroCommand();</span><br><span class=\"line\">macroCommand2.add(closeDoorCommand);</span><br><span class=\"line\">macroCommand2.add(closePcCommand);</span><br><span class=\"line\">macroCommand2.add(closeQQCommand);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//根组合对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> macroCommand = MacroCommand();</span><br><span class=\"line\">macroCommand.add(openAcCommand);</span><br><span class=\"line\">macroCommand.add(macroCommand1);</span><br><span class=\"line\">macroCommand.add(macroCommand2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//组合对象是一个树形结构，它会被递归调用</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> setCommand = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">command</span>)</span>&#123;</span><br><span class=\"line\">    command.execute();</span><br><span class=\"line\">&#125;)(macroCommand);</span><br></pre></td></tr></table></figure>"},{"title":"Ubuntu系统部署nodejs项目","date":"2017-11-15T06:50:00.000Z","_content":"<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/banner.jpg\" width=\"80%\" height=\"50%\">\n最初学习nodejs，用express写了个项目，想部署到服务器运行；从来没有接触过服务器的我，对于项目的部署是一个模糊的概念；也搜索了很多部署相关的文章，看着也是晕头晕脑的没有看懂；这篇文章主要记录，我的部署过程；\n<!-- more -->\n\n## 购买服务器\n\n我买的是阿里云服务器\n\n* 操作系统：Ubuntu 14.04 64位\n* cpu：1核\n* 内存：1GB\n* 高效云盘：40GB\n\n买的最便宜的那一种，也不贵一年才330；\n\n阿里云 https://www.aliyun.com\n\n1.注册进入首页\n2.点击`控制台`，进入控制台管理页面\n3.点击`云服务器ECS`\n4.点击`实例`\n5.在点击最右边的`创建实例`\n\n进入到创建实例页面，选择相应选项购买完了，回到管理控制台页面；能看见刚购买的实例；\n还有一定要记住好服务器密码；\n\n![实例](http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/1.png)\n\n在windows上安装<a href=\"http://www.netsarang.com/products/xsh_overview.html\" target=\"_blank\">Xshell</a>\n安装成功以后，打开Xshell通过\n* 服务器id\n* 服务器密码\n\n登录你的服务器\n\n## 用户管理\n\n添加用户\n````javascript\n    sudo adduser zs \n````\n\n赋予用户权限 \n````javascript\n    sudo vim /etc/sudoers\n    \n    root   ALL=(ALL:ALL) ALL   //找到这个位置\n    zs     ALL=(ALL:ALL) ALL   //添加这一行\n````\n\n切换用户\n````javascript\n    su - zs\n````\n\n## 安装软件\n\n* 更新软件厂库\n\n````javascript\n    sudo apt-get update\n````\n\n* 安装git\n\n````javascript\n    sudo apt-get install git\n    git --version   //查看git版本，git是否安装成功\n````\n\n\n* <a href=\"https://github.com/creationix/nvm\" target=\"_blank\">安装nvm</a>\n\n````javascript\n    curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.5/install.sh | bash\n````\n\n````javascript\n    //如果提示：To run 'curl' please ask your administrator to install the package 'curl'\n    //需要先安装curl模块，在安装nvm\n    sudo apt-get install curl\n````\n\n````javascript\n    //输入nvm --version，如果报错 nvm: command not found\n    source ~/.bashrc\n````\n\n* 安装nodejs\n\n````javascript\n    nvm install 6  //会安装nodejs 6的最新版本\n    nvm alias default 6.11.4 //设置默认版本\n````\n\n* <a href=\"https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/\" target=\"_blank\">安装mongoDB数据库</a>\n\n````javascript\n    sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 0C49F3730359A14518585931BC711F9BA15703C6\n````\n\n````javascript\n    //这一步安装需要注意，你的Ubuntu 版本\n    echo \"deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.4 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list\n````\n\n````javascript\n    sudo apt-get update\n````\n\n````javascript\n    sudo apt-get install -y mongodb-org\n````\n\n\n````javascript\n    //启动数据库\n    sudo service mongod start\n    \n    //waiting for connections on port 27017 说明启动成功了\n    vi /var/log/mongodb/mongod.log  \n````\n\n* 安装pm2\n\n````javascript\n    npm install pm2 -g\n````\n\n\n* 安装nginx\n\n````javascript\n    sudo apt-get install nginx\n\n    //开机启动\n    sudo apt-get install sysv-rc-conf\n    sudo sysv-rc-conf nginx on\n````\n\n\n## 上传代码\n\n软件安装的都差不多了，我用的是sublime text编辑器sftp软件上传代码；\n\n在root用户下给zs临时用户添加权限 chown -R zs.zs /work/nbdemo/\n\n此时，可以通过sftp把本地的项目文件上传到服务器的/work/nbdemo/目录下\n\nsftp-config.json 文件\n\n````json\n{\n    \"type\": \"sftp\",\n    \"save_before_upload\": true,\n    \"upload_on_save\": false,\n    \"sync_down_on_open\": false,\n    \"sync_skip_deletes\": false,\n    \"sync_same_age\": true,\n    \"confirm_downloads\": false,\n    \"confirm_sync\": true,\n    \"confirm_overwrite_newer\": false,\n    \n    \"host\": \"服务器ip地址\",\n    \"user\": \"用户名\",\n    \"password\": \"用户密码\",\n    //\"port\": \"22\",\n    \n    \"remote_path\": \"要上传到服务器的目录路径\",\n    //忽略上传的文件\n    \"ignore_regexes\": [\n        \"\\\\.sublime-(project|workspace)\", \"sftp-config(-alt\\\\d?)?\\\\.json\",\n        \"sftp-settings\\\\.json\", \"/venv/\", \"\\\\.svn/\", \"\\\\.hg/\", \"\\\\.git/\",\n        \"\\\\.bzr\", \"_darcs\", \"CVS\", \"\\\\.DS_Store\", \"Thumbs\\\\.db\", \"desktop\\\\.ini\",\"node_modules\",\"./db/\"\n    ]\n  \n}\n\n````\n\n### 一个坑\n\n代码上传上去了之后，并成功运行pm2 start ./bin/www\n\n在浏览器地址栏输入服务器ip，不能访问；弄了好几个小时；才发现是要在阿里云控制台，配置安全组；\n\n![实例](http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/11.png)\n\n后面就可以访问了；\n\n我这里是通过nginx做的端口代理，项目本身是8080端口；\n\nnginx 代理文件， nbdemo-con-8080.conf\n\n文件放在 /etc/nginx/conf.d/目录下\n\n````javascript\n    upstream test{\n        server 127.0.0.1:8080;\n    }\n\n    server {\n        listen 80;\n        server_name 47.95.221.113;\n\n        location / {\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header Host $http_host;\n            proxy_set_header X-NginX-Proxy true;\n            proxy_redirect off;\n            proxy_pass http://test;\n        }\n    }\n````\n\n至此，代码部署就差不多完了，项目也可以访问了；\n","source":"_posts/Ubuntu系统部署nodejs项目.md","raw":"---\ntitle: Ubuntu系统部署nodejs项目\ndate: 2017-11-15 14:50:00\ntags: nodejs\n---\n<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/banner.jpg\" width=\"80%\" height=\"50%\">\n最初学习nodejs，用express写了个项目，想部署到服务器运行；从来没有接触过服务器的我，对于项目的部署是一个模糊的概念；也搜索了很多部署相关的文章，看着也是晕头晕脑的没有看懂；这篇文章主要记录，我的部署过程；\n<!-- more -->\n\n## 购买服务器\n\n我买的是阿里云服务器\n\n* 操作系统：Ubuntu 14.04 64位\n* cpu：1核\n* 内存：1GB\n* 高效云盘：40GB\n\n买的最便宜的那一种，也不贵一年才330；\n\n阿里云 https://www.aliyun.com\n\n1.注册进入首页\n2.点击`控制台`，进入控制台管理页面\n3.点击`云服务器ECS`\n4.点击`实例`\n5.在点击最右边的`创建实例`\n\n进入到创建实例页面，选择相应选项购买完了，回到管理控制台页面；能看见刚购买的实例；\n还有一定要记住好服务器密码；\n\n![实例](http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/1.png)\n\n在windows上安装<a href=\"http://www.netsarang.com/products/xsh_overview.html\" target=\"_blank\">Xshell</a>\n安装成功以后，打开Xshell通过\n* 服务器id\n* 服务器密码\n\n登录你的服务器\n\n## 用户管理\n\n添加用户\n````javascript\n    sudo adduser zs \n````\n\n赋予用户权限 \n````javascript\n    sudo vim /etc/sudoers\n    \n    root   ALL=(ALL:ALL) ALL   //找到这个位置\n    zs     ALL=(ALL:ALL) ALL   //添加这一行\n````\n\n切换用户\n````javascript\n    su - zs\n````\n\n## 安装软件\n\n* 更新软件厂库\n\n````javascript\n    sudo apt-get update\n````\n\n* 安装git\n\n````javascript\n    sudo apt-get install git\n    git --version   //查看git版本，git是否安装成功\n````\n\n\n* <a href=\"https://github.com/creationix/nvm\" target=\"_blank\">安装nvm</a>\n\n````javascript\n    curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.5/install.sh | bash\n````\n\n````javascript\n    //如果提示：To run 'curl' please ask your administrator to install the package 'curl'\n    //需要先安装curl模块，在安装nvm\n    sudo apt-get install curl\n````\n\n````javascript\n    //输入nvm --version，如果报错 nvm: command not found\n    source ~/.bashrc\n````\n\n* 安装nodejs\n\n````javascript\n    nvm install 6  //会安装nodejs 6的最新版本\n    nvm alias default 6.11.4 //设置默认版本\n````\n\n* <a href=\"https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/\" target=\"_blank\">安装mongoDB数据库</a>\n\n````javascript\n    sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 0C49F3730359A14518585931BC711F9BA15703C6\n````\n\n````javascript\n    //这一步安装需要注意，你的Ubuntu 版本\n    echo \"deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.4 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list\n````\n\n````javascript\n    sudo apt-get update\n````\n\n````javascript\n    sudo apt-get install -y mongodb-org\n````\n\n\n````javascript\n    //启动数据库\n    sudo service mongod start\n    \n    //waiting for connections on port 27017 说明启动成功了\n    vi /var/log/mongodb/mongod.log  \n````\n\n* 安装pm2\n\n````javascript\n    npm install pm2 -g\n````\n\n\n* 安装nginx\n\n````javascript\n    sudo apt-get install nginx\n\n    //开机启动\n    sudo apt-get install sysv-rc-conf\n    sudo sysv-rc-conf nginx on\n````\n\n\n## 上传代码\n\n软件安装的都差不多了，我用的是sublime text编辑器sftp软件上传代码；\n\n在root用户下给zs临时用户添加权限 chown -R zs.zs /work/nbdemo/\n\n此时，可以通过sftp把本地的项目文件上传到服务器的/work/nbdemo/目录下\n\nsftp-config.json 文件\n\n````json\n{\n    \"type\": \"sftp\",\n    \"save_before_upload\": true,\n    \"upload_on_save\": false,\n    \"sync_down_on_open\": false,\n    \"sync_skip_deletes\": false,\n    \"sync_same_age\": true,\n    \"confirm_downloads\": false,\n    \"confirm_sync\": true,\n    \"confirm_overwrite_newer\": false,\n    \n    \"host\": \"服务器ip地址\",\n    \"user\": \"用户名\",\n    \"password\": \"用户密码\",\n    //\"port\": \"22\",\n    \n    \"remote_path\": \"要上传到服务器的目录路径\",\n    //忽略上传的文件\n    \"ignore_regexes\": [\n        \"\\\\.sublime-(project|workspace)\", \"sftp-config(-alt\\\\d?)?\\\\.json\",\n        \"sftp-settings\\\\.json\", \"/venv/\", \"\\\\.svn/\", \"\\\\.hg/\", \"\\\\.git/\",\n        \"\\\\.bzr\", \"_darcs\", \"CVS\", \"\\\\.DS_Store\", \"Thumbs\\\\.db\", \"desktop\\\\.ini\",\"node_modules\",\"./db/\"\n    ]\n  \n}\n\n````\n\n### 一个坑\n\n代码上传上去了之后，并成功运行pm2 start ./bin/www\n\n在浏览器地址栏输入服务器ip，不能访问；弄了好几个小时；才发现是要在阿里云控制台，配置安全组；\n\n![实例](http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/11.png)\n\n后面就可以访问了；\n\n我这里是通过nginx做的端口代理，项目本身是8080端口；\n\nnginx 代理文件， nbdemo-con-8080.conf\n\n文件放在 /etc/nginx/conf.d/目录下\n\n````javascript\n    upstream test{\n        server 127.0.0.1:8080;\n    }\n\n    server {\n        listen 80;\n        server_name 47.95.221.113;\n\n        location / {\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header Host $http_host;\n            proxy_set_header X-NginX-Proxy true;\n            proxy_redirect off;\n            proxy_pass http://test;\n        }\n    }\n````\n\n至此，代码部署就差不多完了，项目也可以访问了；\n","slug":"Ubuntu系统部署nodejs项目","published":1,"updated":"2019-03-21T04:23:24.640Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckknbqwft000310udnz9r01pl","content":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/banner.jpg\" width=\"80%\" height=\"50%\"><br>最初学习nodejs，用express写了个项目，想部署到服务器运行；从来没有接触过服务器的我，对于项目的部署是一个模糊的概念；也搜索了很多部署相关的文章，看着也是晕头晕脑的没有看懂；这篇文章主要记录，我的部署过程；<br><a id=\"more\"></a></p>\n<h2 id=\"购买服务器\"><a href=\"#购买服务器\" class=\"headerlink\" title=\"购买服务器\"></a>购买服务器</h2><p>我买的是阿里云服务器</p>\n<ul>\n<li>操作系统：Ubuntu 14.04 64位</li>\n<li>cpu：1核</li>\n<li>内存：1GB</li>\n<li>高效云盘：40GB</li>\n</ul>\n<p>买的最便宜的那一种，也不贵一年才330；</p>\n<p>阿里云 <a href=\"https://www.aliyun.com\" target=\"_blank\" rel=\"noopener\">https://www.aliyun.com</a></p>\n<p>1.注册进入首页<br>2.点击<code>控制台</code>，进入控制台管理页面<br>3.点击<code>云服务器ECS</code><br>4.点击<code>实例</code><br>5.在点击最右边的<code>创建实例</code></p>\n<p>进入到创建实例页面，选择相应选项购买完了，回到管理控制台页面；能看见刚购买的实例；<br>还有一定要记住好服务器密码；</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/1.png\" alt=\"实例\"></p>\n<p>在windows上安装<a href=\"http://www.netsarang.com/products/xsh_overview.html\" target=\"_blank\">Xshell</a><br>安装成功以后，打开Xshell通过</p>\n<ul>\n<li>服务器id</li>\n<li>服务器密码</li>\n</ul>\n<p>登录你的服务器</p>\n<h2 id=\"用户管理\"><a href=\"#用户管理\" class=\"headerlink\" title=\"用户管理\"></a>用户管理</h2><p>添加用户<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo adduser zs</span><br></pre></td></tr></table></figure></p>\n<p>赋予用户权限<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vim /etc/sudoers</span><br><span class=\"line\"></span><br><span class=\"line\">root   ALL=(ALL:ALL) ALL   <span class=\"comment\">//找到这个位置</span></span><br><span class=\"line\">zs     ALL=(ALL:ALL) ALL   <span class=\"comment\">//添加这一行</span></span><br></pre></td></tr></table></figure></p>\n<p>切换用户<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su - zs</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"安装软件\"><a href=\"#安装软件\" class=\"headerlink\" title=\"安装软件\"></a>安装软件</h2><ul>\n<li>更新软件厂库</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> update</span><br></pre></td></tr></table></figure>\n<ul>\n<li>安装git</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> install git</span><br><span class=\"line\">git --version   //查看git版本，git是否安装成功</span><br></pre></td></tr></table></figure>\n<ul>\n<li><a href=\"https://github.com/creationix/nvm\" target=\"_blank\">安装nvm</a></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o- https:<span class=\"comment\">//raw.githubusercontent.com/creationix/nvm/v0.33.5/install.sh | bash</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//如果提示：To run 'curl' please ask your administrator to install the package 'curl'</span></span><br><span class=\"line\"><span class=\"comment\">//需要先安装curl模块，在安装nvm</span></span><br><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> install curl</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//输入nvm --version，如果报错 nvm: command not found</span></span><br><span class=\"line\">source ~<span class=\"regexp\">/.bashrc</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>安装nodejs</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nvm install <span class=\"number\">6</span>  <span class=\"comment\">//会安装nodejs 6的最新版本</span></span><br><span class=\"line\">nvm alias <span class=\"keyword\">default</span> <span class=\"number\">6.11</span><span class=\"number\">.4</span> <span class=\"comment\">//设置默认版本</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><a href=\"https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/\" target=\"_blank\">安装mongoDB数据库</a></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-key adv --keyserver hkp:<span class=\"comment\">//keyserver.ubuntu.com:80 --recv 0C49F3730359A14518585931BC711F9BA15703C6</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//这一步安装需要注意，你的Ubuntu 版本</span></span><br><span class=\"line\">echo <span class=\"string\">\"deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.4 multiverse\"</span> | sudo tee /etc/apt/sources.list.d/mongodb-org<span class=\"number\">-3.4</span>.list</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> update</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> install -y mongodb-org</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//启动数据库</span></span><br><span class=\"line\">sudo service mongod start</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//waiting for connections on port 27017 说明启动成功了</span></span><br><span class=\"line\">vi /<span class=\"keyword\">var</span>/log/mongodb/mongod.log</span><br></pre></td></tr></table></figure>\n<ul>\n<li>安装pm2</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install pm2 -g</span><br></pre></td></tr></table></figure>\n<ul>\n<li>安装nginx</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> install nginx</span><br><span class=\"line\"></span><br><span class=\"line\">//开机启动</span><br><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> install sysv-rc-conf</span><br><span class=\"line\">sudo sysv-rc-conf nginx on</span><br></pre></td></tr></table></figure>\n<h2 id=\"上传代码\"><a href=\"#上传代码\" class=\"headerlink\" title=\"上传代码\"></a>上传代码</h2><p>软件安装的都差不多了，我用的是sublime text编辑器sftp软件上传代码；</p>\n<p>在root用户下给zs临时用户添加权限 chown -R zs.zs /work/nbdemo/</p>\n<p>此时，可以通过sftp把本地的项目文件上传到服务器的/work/nbdemo/目录下</p>\n<p>sftp-config.json 文件</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"sftp\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"save_before_upload\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"upload_on_save\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"sync_down_on_open\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"sync_skip_deletes\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"sync_same_age\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"confirm_downloads\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"confirm_sync\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"confirm_overwrite_newer\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"attr\">\"host\"</span>: <span class=\"string\">\"服务器ip地址\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"user\"</span>: <span class=\"string\">\"用户名\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"password\"</span>: <span class=\"string\">\"用户密码\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">//\"port\": \"22\",</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"attr\">\"remote_path\"</span>: <span class=\"string\">\"要上传到服务器的目录路径\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">//忽略上传的文件</span></span><br><span class=\"line\">    <span class=\"attr\">\"ignore_regexes\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"\\\\.sublime-(project|workspace)\"</span>, <span class=\"string\">\"sftp-config(-alt\\\\d?)?\\\\.json\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"sftp-settings\\\\.json\"</span>, <span class=\"string\">\"/venv/\"</span>, <span class=\"string\">\"\\\\.svn/\"</span>, <span class=\"string\">\"\\\\.hg/\"</span>, <span class=\"string\">\"\\\\.git/\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"\\\\.bzr\"</span>, <span class=\"string\">\"_darcs\"</span>, <span class=\"string\">\"CVS\"</span>, <span class=\"string\">\"\\\\.DS_Store\"</span>, <span class=\"string\">\"Thumbs\\\\.db\"</span>, <span class=\"string\">\"desktop\\\\.ini\"</span>,<span class=\"string\">\"node_modules\"</span>,<span class=\"string\">\"./db/\"</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"一个坑\"><a href=\"#一个坑\" class=\"headerlink\" title=\"一个坑\"></a>一个坑</h3><p>代码上传上去了之后，并成功运行pm2 start ./bin/www</p>\n<p>在浏览器地址栏输入服务器ip，不能访问；弄了好几个小时；才发现是要在阿里云控制台，配置安全组；</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/11.png\" alt=\"实例\"></p>\n<p>后面就可以访问了；</p>\n<p>我这里是通过nginx做的端口代理，项目本身是8080端口；</p>\n<p>nginx 代理文件， nbdemo-con-8080.conf</p>\n<p>文件放在 /etc/nginx/conf.d/目录下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream test&#123;</span><br><span class=\"line\">    server <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8080</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen <span class=\"number\">80</span>;</span><br><span class=\"line\">    server_name <span class=\"number\">47.95</span><span class=\"number\">.221</span><span class=\"number\">.113</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header Host $http_host;</span><br><span class=\"line\">        proxy_set_header X-NginX-<span class=\"built_in\">Proxy</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        proxy_redirect off;</span><br><span class=\"line\">        proxy_pass http:<span class=\"comment\">//test;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>至此，代码部署就差不多完了，项目也可以访问了；</p>\n","site":{"data":{}},"excerpt":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/banner.jpg\" width=\"80%\" height=\"50%\"><br>最初学习nodejs，用express写了个项目，想部署到服务器运行；从来没有接触过服务器的我，对于项目的部署是一个模糊的概念；也搜索了很多部署相关的文章，看着也是晕头晕脑的没有看懂；这篇文章主要记录，我的部署过程；<br>","more":"</p>\n<h2 id=\"购买服务器\"><a href=\"#购买服务器\" class=\"headerlink\" title=\"购买服务器\"></a>购买服务器</h2><p>我买的是阿里云服务器</p>\n<ul>\n<li>操作系统：Ubuntu 14.04 64位</li>\n<li>cpu：1核</li>\n<li>内存：1GB</li>\n<li>高效云盘：40GB</li>\n</ul>\n<p>买的最便宜的那一种，也不贵一年才330；</p>\n<p>阿里云 <a href=\"https://www.aliyun.com\" target=\"_blank\" rel=\"noopener\">https://www.aliyun.com</a></p>\n<p>1.注册进入首页<br>2.点击<code>控制台</code>，进入控制台管理页面<br>3.点击<code>云服务器ECS</code><br>4.点击<code>实例</code><br>5.在点击最右边的<code>创建实例</code></p>\n<p>进入到创建实例页面，选择相应选项购买完了，回到管理控制台页面；能看见刚购买的实例；<br>还有一定要记住好服务器密码；</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/1.png\" alt=\"实例\"></p>\n<p>在windows上安装<a href=\"http://www.netsarang.com/products/xsh_overview.html\" target=\"_blank\">Xshell</a><br>安装成功以后，打开Xshell通过</p>\n<ul>\n<li>服务器id</li>\n<li>服务器密码</li>\n</ul>\n<p>登录你的服务器</p>\n<h2 id=\"用户管理\"><a href=\"#用户管理\" class=\"headerlink\" title=\"用户管理\"></a>用户管理</h2><p>添加用户<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo adduser zs</span><br></pre></td></tr></table></figure></p>\n<p>赋予用户权限<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vim /etc/sudoers</span><br><span class=\"line\"></span><br><span class=\"line\">root   ALL=(ALL:ALL) ALL   <span class=\"comment\">//找到这个位置</span></span><br><span class=\"line\">zs     ALL=(ALL:ALL) ALL   <span class=\"comment\">//添加这一行</span></span><br></pre></td></tr></table></figure></p>\n<p>切换用户<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su - zs</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"安装软件\"><a href=\"#安装软件\" class=\"headerlink\" title=\"安装软件\"></a>安装软件</h2><ul>\n<li>更新软件厂库</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> update</span><br></pre></td></tr></table></figure>\n<ul>\n<li>安装git</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> install git</span><br><span class=\"line\">git --version   //查看git版本，git是否安装成功</span><br></pre></td></tr></table></figure>\n<ul>\n<li><a href=\"https://github.com/creationix/nvm\" target=\"_blank\">安装nvm</a></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o- https:<span class=\"comment\">//raw.githubusercontent.com/creationix/nvm/v0.33.5/install.sh | bash</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//如果提示：To run 'curl' please ask your administrator to install the package 'curl'</span></span><br><span class=\"line\"><span class=\"comment\">//需要先安装curl模块，在安装nvm</span></span><br><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> install curl</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//输入nvm --version，如果报错 nvm: command not found</span></span><br><span class=\"line\">source ~<span class=\"regexp\">/.bashrc</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>安装nodejs</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nvm install <span class=\"number\">6</span>  <span class=\"comment\">//会安装nodejs 6的最新版本</span></span><br><span class=\"line\">nvm alias <span class=\"keyword\">default</span> <span class=\"number\">6.11</span><span class=\"number\">.4</span> <span class=\"comment\">//设置默认版本</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><a href=\"https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/\" target=\"_blank\">安装mongoDB数据库</a></li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-key adv --keyserver hkp:<span class=\"comment\">//keyserver.ubuntu.com:80 --recv 0C49F3730359A14518585931BC711F9BA15703C6</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//这一步安装需要注意，你的Ubuntu 版本</span></span><br><span class=\"line\">echo <span class=\"string\">\"deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.4 multiverse\"</span> | sudo tee /etc/apt/sources.list.d/mongodb-org<span class=\"number\">-3.4</span>.list</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> update</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> install -y mongodb-org</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//启动数据库</span></span><br><span class=\"line\">sudo service mongod start</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//waiting for connections on port 27017 说明启动成功了</span></span><br><span class=\"line\">vi /<span class=\"keyword\">var</span>/log/mongodb/mongod.log</span><br></pre></td></tr></table></figure>\n<ul>\n<li>安装pm2</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install pm2 -g</span><br></pre></td></tr></table></figure>\n<ul>\n<li>安装nginx</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> install nginx</span><br><span class=\"line\"></span><br><span class=\"line\">//开机启动</span><br><span class=\"line\">sudo apt-<span class=\"keyword\">get</span> install sysv-rc-conf</span><br><span class=\"line\">sudo sysv-rc-conf nginx on</span><br></pre></td></tr></table></figure>\n<h2 id=\"上传代码\"><a href=\"#上传代码\" class=\"headerlink\" title=\"上传代码\"></a>上传代码</h2><p>软件安装的都差不多了，我用的是sublime text编辑器sftp软件上传代码；</p>\n<p>在root用户下给zs临时用户添加权限 chown -R zs.zs /work/nbdemo/</p>\n<p>此时，可以通过sftp把本地的项目文件上传到服务器的/work/nbdemo/目录下</p>\n<p>sftp-config.json 文件</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"sftp\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"save_before_upload\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"upload_on_save\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"sync_down_on_open\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"sync_skip_deletes\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"sync_same_age\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"confirm_downloads\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"confirm_sync\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"confirm_overwrite_newer\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"attr\">\"host\"</span>: <span class=\"string\">\"服务器ip地址\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"user\"</span>: <span class=\"string\">\"用户名\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"password\"</span>: <span class=\"string\">\"用户密码\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">//\"port\": \"22\",</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"attr\">\"remote_path\"</span>: <span class=\"string\">\"要上传到服务器的目录路径\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">//忽略上传的文件</span></span><br><span class=\"line\">    <span class=\"attr\">\"ignore_regexes\"</span>: [</span><br><span class=\"line\">        <span class=\"string\">\"\\\\.sublime-(project|workspace)\"</span>, <span class=\"string\">\"sftp-config(-alt\\\\d?)?\\\\.json\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"sftp-settings\\\\.json\"</span>, <span class=\"string\">\"/venv/\"</span>, <span class=\"string\">\"\\\\.svn/\"</span>, <span class=\"string\">\"\\\\.hg/\"</span>, <span class=\"string\">\"\\\\.git/\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"\\\\.bzr\"</span>, <span class=\"string\">\"_darcs\"</span>, <span class=\"string\">\"CVS\"</span>, <span class=\"string\">\"\\\\.DS_Store\"</span>, <span class=\"string\">\"Thumbs\\\\.db\"</span>, <span class=\"string\">\"desktop\\\\.ini\"</span>,<span class=\"string\">\"node_modules\"</span>,<span class=\"string\">\"./db/\"</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"一个坑\"><a href=\"#一个坑\" class=\"headerlink\" title=\"一个坑\"></a>一个坑</h3><p>代码上传上去了之后，并成功运行pm2 start ./bin/www</p>\n<p>在浏览器地址栏输入服务器ip，不能访问；弄了好几个小时；才发现是要在阿里云控制台，配置安全组；</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/deploy/11.png\" alt=\"实例\"></p>\n<p>后面就可以访问了；</p>\n<p>我这里是通过nginx做的端口代理，项目本身是8080端口；</p>\n<p>nginx 代理文件， nbdemo-con-8080.conf</p>\n<p>文件放在 /etc/nginx/conf.d/目录下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream test&#123;</span><br><span class=\"line\">    server <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8080</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen <span class=\"number\">80</span>;</span><br><span class=\"line\">    server_name <span class=\"number\">47.95</span><span class=\"number\">.221</span><span class=\"number\">.113</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header Host $http_host;</span><br><span class=\"line\">        proxy_set_header X-NginX-<span class=\"built_in\">Proxy</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        proxy_redirect off;</span><br><span class=\"line\">        proxy_pass http:<span class=\"comment\">//test;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>至此，代码部署就差不多完了，项目也可以访问了；</p>"},{"title":"分类侧边栏","date":"2017-11-07T10:05:26.000Z","_content":"<img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/timg.jpg\" width=\"80%\" height=\"50%\">\n模仿京东商城分类侧边栏效果，实现一个分类侧边栏demo\n<!-- more -->\n\n## 京东商城界面\n\n### 界面图\n![动画效果](http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/1.png)\n### 功能分析\n* 当前项在可移动范围内，始终相对于商品区域垂直居中\n* 当前项颜色会变红\n\n## 我实现的demo\n### 最终效果\n![动画效果](http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/ggg.gif)\n\n### 第一个demo\n[demo地址](https://zhongs.github.io/scroll/sidebar_scroll/demo0.html)\n* 没有滚动效果\n* 在不使用jquery的情况下，想给内滚动加上过度效果，得自己实现一个；当然zepto也没实现能改变scrollTop的动画函数\n\n### 第二个demo \n[demo地址](https://zhongs.github.io/scroll/sidebar_scroll/demo1.html)\n* 加上滚动效果\n\n### 第三个demo\n[demo地址](https://zhongs.github.io/scroll/sidebar_scroll/demo2.html)\n* 加上了tween缓冲效果\n\n### <a href=\"https://github.com/zhongs/scroll/tree/master/sidebar_scroll\" target=\"_blank\">项目源码地址</a>\n","source":"_posts/分类侧边栏.md","raw":"---\ntitle: 分类侧边栏\ndate: 2017-11-07 18:05:26\ntags: 滚动\n---\n<img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/timg.jpg\" width=\"80%\" height=\"50%\">\n模仿京东商城分类侧边栏效果，实现一个分类侧边栏demo\n<!-- more -->\n\n## 京东商城界面\n\n### 界面图\n![动画效果](http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/1.png)\n### 功能分析\n* 当前项在可移动范围内，始终相对于商品区域垂直居中\n* 当前项颜色会变红\n\n## 我实现的demo\n### 最终效果\n![动画效果](http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/ggg.gif)\n\n### 第一个demo\n[demo地址](https://zhongs.github.io/scroll/sidebar_scroll/demo0.html)\n* 没有滚动效果\n* 在不使用jquery的情况下，想给内滚动加上过度效果，得自己实现一个；当然zepto也没实现能改变scrollTop的动画函数\n\n### 第二个demo \n[demo地址](https://zhongs.github.io/scroll/sidebar_scroll/demo1.html)\n* 加上滚动效果\n\n### 第三个demo\n[demo地址](https://zhongs.github.io/scroll/sidebar_scroll/demo2.html)\n* 加上了tween缓冲效果\n\n### <a href=\"https://github.com/zhongs/scroll/tree/master/sidebar_scroll\" target=\"_blank\">项目源码地址</a>\n","slug":"分类侧边栏","published":1,"updated":"2019-03-21T04:23:24.672Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckknbqwfx000510udd06g2nws","content":"<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/timg.jpg\" width=\"80%\" height=\"50%\"><br>模仿京东商城分类侧边栏效果，实现一个分类侧边栏demo<br><a id=\"more\"></a></p>\n<h2 id=\"京东商城界面\"><a href=\"#京东商城界面\" class=\"headerlink\" title=\"京东商城界面\"></a>京东商城界面</h2><h3 id=\"界面图\"><a href=\"#界面图\" class=\"headerlink\" title=\"界面图\"></a>界面图</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/1.png\" alt=\"动画效果\"></p>\n<h3 id=\"功能分析\"><a href=\"#功能分析\" class=\"headerlink\" title=\"功能分析\"></a>功能分析</h3><ul>\n<li>当前项在可移动范围内，始终相对于商品区域垂直居中</li>\n<li>当前项颜色会变红</li>\n</ul>\n<h2 id=\"我实现的demo\"><a href=\"#我实现的demo\" class=\"headerlink\" title=\"我实现的demo\"></a>我实现的demo</h2><h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/ggg.gif\" alt=\"动画效果\"></p>\n<h3 id=\"第一个demo\"><a href=\"#第一个demo\" class=\"headerlink\" title=\"第一个demo\"></a>第一个demo</h3><p><a href=\"https://zhongs.github.io/scroll/sidebar_scroll/demo0.html\" target=\"_blank\" rel=\"noopener\">demo地址</a></p>\n<ul>\n<li>没有滚动效果</li>\n<li>在不使用jquery的情况下，想给内滚动加上过度效果，得自己实现一个；当然zepto也没实现能改变scrollTop的动画函数</li>\n</ul>\n<h3 id=\"第二个demo\"><a href=\"#第二个demo\" class=\"headerlink\" title=\"第二个demo\"></a>第二个demo</h3><p><a href=\"https://zhongs.github.io/scroll/sidebar_scroll/demo1.html\" target=\"_blank\" rel=\"noopener\">demo地址</a></p>\n<ul>\n<li>加上滚动效果</li>\n</ul>\n<h3 id=\"第三个demo\"><a href=\"#第三个demo\" class=\"headerlink\" title=\"第三个demo\"></a>第三个demo</h3><p><a href=\"https://zhongs.github.io/scroll/sidebar_scroll/demo2.html\" target=\"_blank\" rel=\"noopener\">demo地址</a></p>\n<ul>\n<li>加上了tween缓冲效果</li>\n</ul>\n<h3 id=\"项目源码地址\"><a href=\"#项目源码地址\" class=\"headerlink\" title=\"项目源码地址\"></a><a href=\"https://github.com/zhongs/scroll/tree/master/sidebar_scroll\" target=\"_blank\">项目源码地址</a></h3>","site":{"data":{}},"excerpt":"<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/timg.jpg\" width=\"80%\" height=\"50%\"><br>模仿京东商城分类侧边栏效果，实现一个分类侧边栏demo<br>","more":"</p>\n<h2 id=\"京东商城界面\"><a href=\"#京东商城界面\" class=\"headerlink\" title=\"京东商城界面\"></a>京东商城界面</h2><h3 id=\"界面图\"><a href=\"#界面图\" class=\"headerlink\" title=\"界面图\"></a>界面图</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/1.png\" alt=\"动画效果\"></p>\n<h3 id=\"功能分析\"><a href=\"#功能分析\" class=\"headerlink\" title=\"功能分析\"></a>功能分析</h3><ul>\n<li>当前项在可移动范围内，始终相对于商品区域垂直居中</li>\n<li>当前项颜色会变红</li>\n</ul>\n<h2 id=\"我实现的demo\"><a href=\"#我实现的demo\" class=\"headerlink\" title=\"我实现的demo\"></a>我实现的demo</h2><h3 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/sidebar/ggg.gif\" alt=\"动画效果\"></p>\n<h3 id=\"第一个demo\"><a href=\"#第一个demo\" class=\"headerlink\" title=\"第一个demo\"></a>第一个demo</h3><p><a href=\"https://zhongs.github.io/scroll/sidebar_scroll/demo0.html\" target=\"_blank\" rel=\"noopener\">demo地址</a></p>\n<ul>\n<li>没有滚动效果</li>\n<li>在不使用jquery的情况下，想给内滚动加上过度效果，得自己实现一个；当然zepto也没实现能改变scrollTop的动画函数</li>\n</ul>\n<h3 id=\"第二个demo\"><a href=\"#第二个demo\" class=\"headerlink\" title=\"第二个demo\"></a>第二个demo</h3><p><a href=\"https://zhongs.github.io/scroll/sidebar_scroll/demo1.html\" target=\"_blank\" rel=\"noopener\">demo地址</a></p>\n<ul>\n<li>加上滚动效果</li>\n</ul>\n<h3 id=\"第三个demo\"><a href=\"#第三个demo\" class=\"headerlink\" title=\"第三个demo\"></a>第三个demo</h3><p><a href=\"https://zhongs.github.io/scroll/sidebar_scroll/demo2.html\" target=\"_blank\" rel=\"noopener\">demo地址</a></p>\n<ul>\n<li>加上了tween缓冲效果</li>\n</ul>\n<h3 id=\"项目源码地址\"><a href=\"#项目源码地址\" class=\"headerlink\" title=\"项目源码地址\"></a><a href=\"https://github.com/zhongs/scroll/tree/master/sidebar_scroll\" target=\"_blank\">项目源码地址</a></h3>"},{"title":"nodejs发短信验证码","date":"2017-11-27T08:58:16.000Z","_content":"\n<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/timg.jpg\" width=\"80%\" height=\"50%\">\n\n用nodejs发短信验证码的一次实践\n\n<!-- more -->\n\n## [网易云平台](http://netease.im/)\n\n* 登录网易云，创建应用，找到应用的 App Key , App Secret\n\n![图片](http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/key.png)\n\n* [短信接入指引](http://dev.netease.im/docs/product/%E7%9F%AD%E4%BF%A1/%E7%9F%AD%E4%BF%A1%E6%8E%A5%E5%8F%A3%E6%8C%87%E5%8D%97?#发送短信/语音短信验证码)\n\n* [接口概述](http://dev.netease.im/docs/product/IM%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF/%E6%9C%8D%E5%8A%A1%E7%AB%AFAPI%E6%96%87%E6%A1%A3/%E6%8E%A5%E5%8F%A3%E6%A6%82%E8%BF%B0?#API调用说明)\n\n## 业务代码\n\n项目依赖的第三方模块\n\n* request\n* sha1\n\n请求配置\n\n```javascript\nconst options = {\n  url: \"https://api.netease.im/sms/sendcode.action\",\n  method: \"POST\",\n  body: \"mobile=13871441556\",\n  headers: {\n    \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n  }\n};\n```\n\n生成CheckSum,返回请求headers对象\n\n````javascript\nvar createCheckSum = function() {\n  const AppKey = \"xxxxxxxxxxxxxxxx\";\n  const AppSecret = \"xxxxxxxxxxxxxxxxx\";\n  const CurTime = parseInt(new Date().getTime() / 1000) + \"\";\n  const Nonce = Math.random()\n  .toString(36)\n  .substr(2, 15);\n\n  let str = AppSecret + Nonce + CurTime;\n\n  return { AppKey, CurTime, CheckSum: sha1(str), Nonce };\n};\n````\n\n在控制台输入node sendsms 调用代码 (我的js文件名叫sendsms)\n\n````javascript\nObject.assign(options.headers, createCheckSum());\n\nrequest(options, (error, response, body) => {\n  console.log(\"body:\", body);  //body: {\"code\":200,\"msg\":\"3\",\"obj\":\"1599\"}\n  if (error) {\n    throw error;\n  }\n  var info = JSON.parse(body);\n  if (info.code == 200) {\n      //其它业务代码\n  }\n});\n  \n````\n\n手机收到的短信验证码\n\n<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/b.jpg\" width=\"40%\">\n","source":"_posts/nodejs发短信验证码.md","raw":"---\ntitle: nodejs发短信验证码\ndate: 2017-11-27 16:58:16\ntags: nodejs\n---\n\n<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/timg.jpg\" width=\"80%\" height=\"50%\">\n\n用nodejs发短信验证码的一次实践\n\n<!-- more -->\n\n## [网易云平台](http://netease.im/)\n\n* 登录网易云，创建应用，找到应用的 App Key , App Secret\n\n![图片](http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/key.png)\n\n* [短信接入指引](http://dev.netease.im/docs/product/%E7%9F%AD%E4%BF%A1/%E7%9F%AD%E4%BF%A1%E6%8E%A5%E5%8F%A3%E6%8C%87%E5%8D%97?#发送短信/语音短信验证码)\n\n* [接口概述](http://dev.netease.im/docs/product/IM%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF/%E6%9C%8D%E5%8A%A1%E7%AB%AFAPI%E6%96%87%E6%A1%A3/%E6%8E%A5%E5%8F%A3%E6%A6%82%E8%BF%B0?#API调用说明)\n\n## 业务代码\n\n项目依赖的第三方模块\n\n* request\n* sha1\n\n请求配置\n\n```javascript\nconst options = {\n  url: \"https://api.netease.im/sms/sendcode.action\",\n  method: \"POST\",\n  body: \"mobile=13871441556\",\n  headers: {\n    \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n  }\n};\n```\n\n生成CheckSum,返回请求headers对象\n\n````javascript\nvar createCheckSum = function() {\n  const AppKey = \"xxxxxxxxxxxxxxxx\";\n  const AppSecret = \"xxxxxxxxxxxxxxxxx\";\n  const CurTime = parseInt(new Date().getTime() / 1000) + \"\";\n  const Nonce = Math.random()\n  .toString(36)\n  .substr(2, 15);\n\n  let str = AppSecret + Nonce + CurTime;\n\n  return { AppKey, CurTime, CheckSum: sha1(str), Nonce };\n};\n````\n\n在控制台输入node sendsms 调用代码 (我的js文件名叫sendsms)\n\n````javascript\nObject.assign(options.headers, createCheckSum());\n\nrequest(options, (error, response, body) => {\n  console.log(\"body:\", body);  //body: {\"code\":200,\"msg\":\"3\",\"obj\":\"1599\"}\n  if (error) {\n    throw error;\n  }\n  var info = JSON.parse(body);\n  if (info.code == 200) {\n      //其它业务代码\n  }\n});\n  \n````\n\n手机收到的短信验证码\n\n<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/b.jpg\" width=\"40%\">\n","slug":"nodejs发短信验证码","published":1,"updated":"2019-03-21T04:23:24.640Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckknbqwg0000610udxrlth3vw","content":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/timg.jpg\" width=\"80%\" height=\"50%\"></p>\n<p>用nodejs发短信验证码的一次实践</p>\n<a id=\"more\"></a>\n<h2 id=\"网易云平台\"><a href=\"#网易云平台\" class=\"headerlink\" title=\"网易云平台\"></a><a href=\"http://netease.im/\" target=\"_blank\" rel=\"noopener\">网易云平台</a></h2><ul>\n<li>登录网易云，创建应用，找到应用的 App Key , App Secret</li>\n</ul>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/key.png\" alt=\"图片\"></p>\n<ul>\n<li><p><a href=\"http://dev.netease.im/docs/product/%E7%9F%AD%E4%BF%A1/%E7%9F%AD%E4%BF%A1%E6%8E%A5%E5%8F%A3%E6%8C%87%E5%8D%97?#发送短信/语音短信验证码\" target=\"_blank\" rel=\"noopener\">短信接入指引</a></p>\n</li>\n<li><p><a href=\"http://dev.netease.im/docs/product/IM%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF/%E6%9C%8D%E5%8A%A1%E7%AB%AFAPI%E6%96%87%E6%A1%A3/%E6%8E%A5%E5%8F%A3%E6%A6%82%E8%BF%B0?#API调用说明\" target=\"_blank\" rel=\"noopener\">接口概述</a></p>\n</li>\n</ul>\n<h2 id=\"业务代码\"><a href=\"#业务代码\" class=\"headerlink\" title=\"业务代码\"></a>业务代码</h2><p>项目依赖的第三方模块</p>\n<ul>\n<li>request</li>\n<li>sha1</li>\n</ul>\n<p>请求配置</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> options = &#123;</span><br><span class=\"line\">  url: <span class=\"string\">\"https://api.netease.im/sms/sendcode.action\"</span>,</span><br><span class=\"line\">  method: <span class=\"string\">\"POST\"</span>,</span><br><span class=\"line\">  body: <span class=\"string\">\"mobile=13871441556\"</span>,</span><br><span class=\"line\">  headers: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"application/x-www-form-urlencoded; charset=UTF-8\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>生成CheckSum,返回请求headers对象</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> createCheckSum = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> AppKey = <span class=\"string\">\"xxxxxxxxxxxxxxxx\"</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> AppSecret = <span class=\"string\">\"xxxxxxxxxxxxxxxxx\"</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> CurTime = <span class=\"built_in\">parseInt</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() / <span class=\"number\">1000</span>) + <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> Nonce = <span class=\"built_in\">Math</span>.random()</span><br><span class=\"line\">  .toString(<span class=\"number\">36</span>)</span><br><span class=\"line\">  .substr(<span class=\"number\">2</span>, <span class=\"number\">15</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> str = AppSecret + Nonce + CurTime;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123; AppKey, CurTime, <span class=\"attr\">CheckSum</span>: sha1(str), Nonce &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>在控制台输入node sendsms 调用代码 (我的js文件名叫sendsms)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Object</span>.assign(options.headers, createCheckSum());</span><br><span class=\"line\"></span><br><span class=\"line\">request(options, (error, response, body) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"body:\"</span>, body);  <span class=\"comment\">//body: &#123;\"code\":200,\"msg\":\"3\",\"obj\":\"1599\"&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (error) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> error;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> info = <span class=\"built_in\">JSON</span>.parse(body);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (info.code == <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//其它业务代码</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>手机收到的短信验证码</p>\n<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/b.jpg\" width=\"40%\"></p>\n","site":{"data":{}},"excerpt":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/timg.jpg\" width=\"80%\" height=\"50%\"></p>\n<p>用nodejs发短信验证码的一次实践</p>","more":"<h2 id=\"网易云平台\"><a href=\"#网易云平台\" class=\"headerlink\" title=\"网易云平台\"></a><a href=\"http://netease.im/\" target=\"_blank\" rel=\"noopener\">网易云平台</a></h2><ul>\n<li>登录网易云，创建应用，找到应用的 App Key , App Secret</li>\n</ul>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/key.png\" alt=\"图片\"></p>\n<ul>\n<li><p><a href=\"http://dev.netease.im/docs/product/%E7%9F%AD%E4%BF%A1/%E7%9F%AD%E4%BF%A1%E6%8E%A5%E5%8F%A3%E6%8C%87%E5%8D%97?#发送短信/语音短信验证码\" target=\"_blank\" rel=\"noopener\">短信接入指引</a></p>\n</li>\n<li><p><a href=\"http://dev.netease.im/docs/product/IM%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF/%E6%9C%8D%E5%8A%A1%E7%AB%AFAPI%E6%96%87%E6%A1%A3/%E6%8E%A5%E5%8F%A3%E6%A6%82%E8%BF%B0?#API调用说明\" target=\"_blank\" rel=\"noopener\">接口概述</a></p>\n</li>\n</ul>\n<h2 id=\"业务代码\"><a href=\"#业务代码\" class=\"headerlink\" title=\"业务代码\"></a>业务代码</h2><p>项目依赖的第三方模块</p>\n<ul>\n<li>request</li>\n<li>sha1</li>\n</ul>\n<p>请求配置</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> options = &#123;</span><br><span class=\"line\">  url: <span class=\"string\">\"https://api.netease.im/sms/sendcode.action\"</span>,</span><br><span class=\"line\">  method: <span class=\"string\">\"POST\"</span>,</span><br><span class=\"line\">  body: <span class=\"string\">\"mobile=13871441556\"</span>,</span><br><span class=\"line\">  headers: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"application/x-www-form-urlencoded; charset=UTF-8\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>生成CheckSum,返回请求headers对象</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> createCheckSum = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> AppKey = <span class=\"string\">\"xxxxxxxxxxxxxxxx\"</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> AppSecret = <span class=\"string\">\"xxxxxxxxxxxxxxxxx\"</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> CurTime = <span class=\"built_in\">parseInt</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() / <span class=\"number\">1000</span>) + <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> Nonce = <span class=\"built_in\">Math</span>.random()</span><br><span class=\"line\">  .toString(<span class=\"number\">36</span>)</span><br><span class=\"line\">  .substr(<span class=\"number\">2</span>, <span class=\"number\">15</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> str = AppSecret + Nonce + CurTime;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123; AppKey, CurTime, <span class=\"attr\">CheckSum</span>: sha1(str), Nonce &#125;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>在控制台输入node sendsms 调用代码 (我的js文件名叫sendsms)</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Object</span>.assign(options.headers, createCheckSum());</span><br><span class=\"line\"></span><br><span class=\"line\">request(options, (error, response, body) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"body:\"</span>, body);  <span class=\"comment\">//body: &#123;\"code\":200,\"msg\":\"3\",\"obj\":\"1599\"&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (error) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> error;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> info = <span class=\"built_in\">JSON</span>.parse(body);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (info.code == <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//其它业务代码</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>手机收到的短信验证码</p>\n<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/b.jpg\" width=\"40%\"></p>"},{"title":"nodejs发邮件","date":"2017-11-30T04:32:37.000Z","_content":"\n<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/timg.jpg\" width=\"80%\" height=\"50%\">\n\n用nodejs发送邮件\n\n<!-- more -->\n\n````javascript\nconst nodemailer = require(\"nodemailer\");\n\n//http://blog.csdn.net/zzwwjjdj1/article/details/51878392\n\nnodemailer.createTestAccount((err, account) => {\n  let transporter = nodemailer.createTransport({\n    service: \"qq\",\n    auth: {\n      user: \"191492580@qq.com\", // 发送人邮箱\n      pass: \"xxxxxxxxxxxxxxxxx\" // 进入QQ个人邮箱, 设置-账户-开启服务POP3/SMTP服务,并生成授权码,现在获取授权码需要验证手机号等.\n    }\n  });\n\n  let mailOptions = {\n    from: \"191492580@qq.com\",  // 发送人邮箱\n    to: \"826177087@qq.com\",   //接收人邮箱\n    subject: \"Hello ✔\",\n    // text: \"Hello world?\", // 接受者,可以同时发送多个,以逗号隔开\n    //定义内容\n    html: ` \n    <h2>hello </h2>\n    <a href=\"https://github.com/\"></a>\n    `,\n    //发文件\n    attachments: [\n      { filename: \"package.json\", path: \"./package.json\" },\n      { filename: \"content\", content: \"发送内容\" }\n    ]\n  }; \n\n  transporter.sendMail(mailOptions, (error, info) => {\n    if (error) {\n      return console.log(error);\n    }\n    console.log(\"Message sent: %s\", info.messageId);\n    console.log(\"Preview URL: %s\", nodemailer.getTestMessageUrl(info));\n    // Message sent: <b658f8ca-6296-ccf4-8306-87d57a0b4321@blurdybloop.com>\n    // Preview URL: https://ethereal.email/message/WaQKMgKddxQDoou...\n  });\n});\n\n````","source":"_posts/nodejs发邮件.md","raw":"---\ntitle: nodejs发邮件\ndate: 2017-11-30 12:32:37\ntags: nodejs\n---\n\n<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/timg.jpg\" width=\"80%\" height=\"50%\">\n\n用nodejs发送邮件\n\n<!-- more -->\n\n````javascript\nconst nodemailer = require(\"nodemailer\");\n\n//http://blog.csdn.net/zzwwjjdj1/article/details/51878392\n\nnodemailer.createTestAccount((err, account) => {\n  let transporter = nodemailer.createTransport({\n    service: \"qq\",\n    auth: {\n      user: \"191492580@qq.com\", // 发送人邮箱\n      pass: \"xxxxxxxxxxxxxxxxx\" // 进入QQ个人邮箱, 设置-账户-开启服务POP3/SMTP服务,并生成授权码,现在获取授权码需要验证手机号等.\n    }\n  });\n\n  let mailOptions = {\n    from: \"191492580@qq.com\",  // 发送人邮箱\n    to: \"826177087@qq.com\",   //接收人邮箱\n    subject: \"Hello ✔\",\n    // text: \"Hello world?\", // 接受者,可以同时发送多个,以逗号隔开\n    //定义内容\n    html: ` \n    <h2>hello </h2>\n    <a href=\"https://github.com/\"></a>\n    `,\n    //发文件\n    attachments: [\n      { filename: \"package.json\", path: \"./package.json\" },\n      { filename: \"content\", content: \"发送内容\" }\n    ]\n  }; \n\n  transporter.sendMail(mailOptions, (error, info) => {\n    if (error) {\n      return console.log(error);\n    }\n    console.log(\"Message sent: %s\", info.messageId);\n    console.log(\"Preview URL: %s\", nodemailer.getTestMessageUrl(info));\n    // Message sent: <b658f8ca-6296-ccf4-8306-87d57a0b4321@blurdybloop.com>\n    // Preview URL: https://ethereal.email/message/WaQKMgKddxQDoou...\n  });\n});\n\n````","slug":"nodejs发邮件","published":1,"updated":"2019-03-21T04:23:24.672Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckknbqwg3000710uddo2lna30","content":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/timg.jpg\" width=\"80%\" height=\"50%\"></p>\n<p>用nodejs发送邮件</p>\n<a id=\"more\"></a>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> nodemailer = <span class=\"built_in\">require</span>(<span class=\"string\">\"nodemailer\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//http://blog.csdn.net/zzwwjjdj1/article/details/51878392</span></span><br><span class=\"line\"></span><br><span class=\"line\">nodemailer.createTestAccount(<span class=\"function\">(<span class=\"params\">err, account</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> transporter = nodemailer.createTransport(&#123;</span><br><span class=\"line\">    service: <span class=\"string\">\"qq\"</span>,</span><br><span class=\"line\">    auth: &#123;</span><br><span class=\"line\">      user: <span class=\"string\">\"191492580@qq.com\"</span>, <span class=\"comment\">// 发送人邮箱</span></span><br><span class=\"line\">      pass: <span class=\"string\">\"xxxxxxxxxxxxxxxxx\"</span> <span class=\"comment\">// 进入QQ个人邮箱, 设置-账户-开启服务POP3/SMTP服务,并生成授权码,现在获取授权码需要验证手机号等.</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> mailOptions = &#123;</span><br><span class=\"line\">    <span class=\"keyword\">from</span>: <span class=\"string\">\"191492580@qq.com\"</span>,  <span class=\"comment\">// 发送人邮箱</span></span><br><span class=\"line\">    to: <span class=\"string\">\"826177087@qq.com\"</span>,   <span class=\"comment\">//接收人邮箱</span></span><br><span class=\"line\">    subject: <span class=\"string\">\"Hello ✔\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">// text: \"Hello world?\", // 接受者,可以同时发送多个,以逗号隔开</span></span><br><span class=\"line\">    <span class=\"comment\">//定义内容</span></span><br><span class=\"line\">    html: <span class=\"string\">` </span></span><br><span class=\"line\"><span class=\"string\">    &lt;h2&gt;hello &lt;/h2&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;a href=\"https://github.com/\"&gt;&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"string\">    `</span>,</span><br><span class=\"line\">    <span class=\"comment\">//发文件</span></span><br><span class=\"line\">    attachments: [</span><br><span class=\"line\">      &#123; <span class=\"attr\">filename</span>: <span class=\"string\">\"package.json\"</span>, <span class=\"attr\">path</span>: <span class=\"string\">\"./package.json\"</span> &#125;,</span><br><span class=\"line\">      &#123; <span class=\"attr\">filename</span>: <span class=\"string\">\"content\"</span>, <span class=\"attr\">content</span>: <span class=\"string\">\"发送内容\"</span> &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;; </span><br><span class=\"line\"></span><br><span class=\"line\">  transporter.sendMail(mailOptions, (error, info) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (error) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(error);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Message sent: %s\"</span>, info.messageId);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Preview URL: %s\"</span>, nodemailer.getTestMessageUrl(info));</span><br><span class=\"line\">    <span class=\"comment\">// Message sent: &lt;b658f8ca-6296-ccf4-8306-87d57a0b4321@blurdybloop.com&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">// Preview URL: https://ethereal.email/message/WaQKMgKddxQDoou...</span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/nodesms/timg.jpg\" width=\"80%\" height=\"50%\"></p>\n<p>用nodejs发送邮件</p>","more":"<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> nodemailer = <span class=\"built_in\">require</span>(<span class=\"string\">\"nodemailer\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//http://blog.csdn.net/zzwwjjdj1/article/details/51878392</span></span><br><span class=\"line\"></span><br><span class=\"line\">nodemailer.createTestAccount(<span class=\"function\">(<span class=\"params\">err, account</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> transporter = nodemailer.createTransport(&#123;</span><br><span class=\"line\">    service: <span class=\"string\">\"qq\"</span>,</span><br><span class=\"line\">    auth: &#123;</span><br><span class=\"line\">      user: <span class=\"string\">\"191492580@qq.com\"</span>, <span class=\"comment\">// 发送人邮箱</span></span><br><span class=\"line\">      pass: <span class=\"string\">\"xxxxxxxxxxxxxxxxx\"</span> <span class=\"comment\">// 进入QQ个人邮箱, 设置-账户-开启服务POP3/SMTP服务,并生成授权码,现在获取授权码需要验证手机号等.</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> mailOptions = &#123;</span><br><span class=\"line\">    <span class=\"keyword\">from</span>: <span class=\"string\">\"191492580@qq.com\"</span>,  <span class=\"comment\">// 发送人邮箱</span></span><br><span class=\"line\">    to: <span class=\"string\">\"826177087@qq.com\"</span>,   <span class=\"comment\">//接收人邮箱</span></span><br><span class=\"line\">    subject: <span class=\"string\">\"Hello ✔\"</span>,</span><br><span class=\"line\">    <span class=\"comment\">// text: \"Hello world?\", // 接受者,可以同时发送多个,以逗号隔开</span></span><br><span class=\"line\">    <span class=\"comment\">//定义内容</span></span><br><span class=\"line\">    html: <span class=\"string\">` </span></span><br><span class=\"line\"><span class=\"string\">    &lt;h2&gt;hello &lt;/h2&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;a href=\"https://github.com/\"&gt;&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"string\">    `</span>,</span><br><span class=\"line\">    <span class=\"comment\">//发文件</span></span><br><span class=\"line\">    attachments: [</span><br><span class=\"line\">      &#123; <span class=\"attr\">filename</span>: <span class=\"string\">\"package.json\"</span>, <span class=\"attr\">path</span>: <span class=\"string\">\"./package.json\"</span> &#125;,</span><br><span class=\"line\">      &#123; <span class=\"attr\">filename</span>: <span class=\"string\">\"content\"</span>, <span class=\"attr\">content</span>: <span class=\"string\">\"发送内容\"</span> &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;; </span><br><span class=\"line\"></span><br><span class=\"line\">  transporter.sendMail(mailOptions, (error, info) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (error) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(error);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Message sent: %s\"</span>, info.messageId);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Preview URL: %s\"</span>, nodemailer.getTestMessageUrl(info));</span><br><span class=\"line\">    <span class=\"comment\">// Message sent: &lt;b658f8ca-6296-ccf4-8306-87d57a0b4321@blurdybloop.com&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">// Preview URL: https://ethereal.email/message/WaQKMgKddxQDoou...</span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>"},{"title":"实现逐帧动画的几种方式","date":"2017-10-23T14:31:18.000Z","_content":"<img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/timg.jpg\" width=\"80%\" height=\"50%\">\n公司有个特效师，专门做这样的帧动画图片，做好后就给到前端，来实现一张一张图片切换播放的动画；我用了canvas，css的animation，图片的image标签，以及图片转码base64的几种方式，分别实现了逐帧动画效果；\n<!-- more -->\n## 用canvas实现\n### 动画效果\n![动画效果](http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/ani.gif)\n![图片](http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/img.png)\n[canvas demo地址](https://zhongs.github.io/frame-animation/canvas/index.html)\n### 首先加载设计师给我的图片\n````javascript\n    //1.创建要加载的图片\n    var imgs = function() {\n        var imgsArr = [];\n        for (var i = 1; i < 21; i++) {\n            var imgSrc = `./img/${i}.png`;\n            imgsArr.push(imgSrc);\n        }\n        return imgsArr;\n    }\n\n    //2.加载图片\n    var loadImgs = function(fn) {\n        var loaded = 0; //记录已经加载图片的个数\n        var loadedImgsArr = []; //用来存放加载的图片\n        var imgsArr = imgs();\n        var imgObj = null;\n        imgsArr.forEach(function(value, index, arr) {\n            imgObj = new Image();\n            imgObj.onload = function() {\n                loaded++;\n                //这里所有的图片加载完成\n                if (loaded == imgsArr.length) {\n                    fn && fn(loadedImgsArr);\n                }\n            }\n            imgObj.src = imgsArr[index];\n            loadedImgsArr.push(imgObj);\n        });\n    }\n    \n````\n### 使用canvas的drawImage Api\n````javascript\n    //3.配置参数\n    var config = {\n        fps: 10, //帧率\n        parentBox: document.querySelectorAll('.ani-box')[0]\n    }\n\n    //4.创建canvas\n    var createCanvas = function() {\n        var canvas = document.createElement('canvas');\n        config.parentBox.appendChild(canvas);\n        var { offsetWidth, offsetHeight } = canvas.parentNode;\n        canvas.width = offsetWidth;\n        canvas.height = offsetHeight;\n        return canvas;\n    }\n\n    //5.有了图片和canvas对象，创建动画函数\n    var ani = function(imgsArr, cb) {\n        var canvas = createCanvas();\n        //图片的宽高\n        var offsetWidth = imgsArr[0].width;\n        var offsetHeight = imgsArr[0].height;\n        var ctx = canvas.getContext('2d');\n        var n = 0;\n        var timer = setInterval(function() {\n            //清屏\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n            //绘制图片        \n            ctx.drawImage(\n                imgsArr[n],\n                0, 0, offsetWidth, offsetHeight,\n                0, 0, canvas.width, canvas.height\n            );\n\n            n++;\n\n            //播放到最后一张图片\n            if (n == imgsArr.length) {\n                n = 0;\n                cb && cb(timer);\n            }\n        }, 1000 / config.fps);\n    }\n````\n### 调用\n````javascript\n    var init = function() {\n        //加载图片，执行动画\n        loadImgs(function(imgs) {\n            ani(imgs, function(timer) {\n                //播放完停留在最后一张\n                //clearInterval(timer);\n            });\n        });\n    }\n    init();\n````\n\n\n## 用css的animation动画实现\n[css demo地址](https://zhongs.github.io/frame-animation/css/index.html)\n### 首先需要知道的是有多少张图片,用scss生成css代码,会少写很多代码\n````scss\n    .animation {\n        animation: ani 2s infinite steps(1);\n    }\n\n    $img_total: 20;  //图片的总数\n    $img_n: 1;       //图片变量名\n    $n: 0;           //当前阶段，帧动画\n    @-webkit-keyframes ani {\n      @while $n <= 100 {\n        #{$n}% {\n          background-image: url(\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/#{$img_n}.png\");\n        }\n        $img_n: $img_n + 1;\n        @if ($img_n>$img_total) {\n          $img_n: 1;\n        }\n        $n: $n + ( 100 / $img_total );\n      }\n    }\n````\n\n### js判断图片是否完成\n````javascript\n     //1.创建要加载的图片\n    var imgs = function() {\n        var imgsArr = [];\n        for (var i = 1; i < 21; i++) {\n            var imgSrc = `http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/${i}.png`;\n            imgsArr.push(imgSrc);\n        }\n        return imgsArr;\n    }\n\n    //2.加载图片\n    var loadImgs = function(fn) {\n        var loaded = 0; //记录已经加载图片的个数\n        var loadedImgsArr = []; //用来存放加载的图片\n        var imgsArr = imgs();\n        var imgObj = null;\n        imgsArr.forEach(function(value, index, arr) {\n            imgObj = new Image();\n            imgObj.onload = function() {\n                loaded++;\n                //这里所有的图片加载完成\n                if (loaded == imgsArr.length) {\n                    fn && fn(loadedImgsArr);\n                }\n            }\n            imgObj.src = imgsArr[index];\n            loadedImgsArr.push(imgObj);\n        });\n    }\n\n    //添加class\n    loadImgs(function(){\n        document.querySelectorAll('.ani-box')[0].className += \" animation\"\n    })\n````\n## 用img标签的src实现\n[image标签实现demo](https://zhongs.github.io/frame-animation/img/index.html)\n### 首先还是得确保图片全部加载完成，后面就是替换src的一个过程；\n````javascript\n //1.创建要加载的图片\n    var imgs = function() {\n        var imgsArr = [];\n        for (var i = 1; i < 21; i++) {\n            var imgSrc = `./img/${i}.png`;\n            imgsArr.push(imgSrc);\n        }\n        return imgsArr;\n    }\n\n    //2.加载图片\n    var loadImgs = function(fn) {\n        var loaded = 0; //记录已经加载图片的个数\n        var loadedImgsArr = []; //用来存放加载的图片\n        var imgsArr = imgs();\n        var imgObj = null;\n        imgsArr.forEach(function(value, index, arr) {\n            imgObj = new Image();\n            imgObj.onload = function() {\n                loaded++;\n                //这里所有的图片加载完成\n                if (loaded == imgsArr.length) {\n                    fn && fn(loadedImgsArr);\n                }\n            }\n            imgObj.src = imgsArr[index];\n            loadedImgsArr.push(imgObj);\n        });\n    }\n\n    var config = {\n        fps: 10, //每秒10帧\n        box: document.querySelector('.ani-box')\n    }\n\n    //创建图片标签\n    function createImg() {\n        var img = document.createElement('img');\n        config.box.appendChild(img);\n        return img;\n    }\n\n    //定时器来播放图片\n    function run(imgArr, fn) {\n        var img = createImg();\n        var n = 0;\n        var timer = setInterval(function() {\n            img.src = imgArr[n].src;\n            n++;\n            if(n == imgArr.length){\n                n = 0;\n                fn && fn(timer);\n            }\n        }, 1000 / config.fps);\n\n    }\n\n    loadImgs(function(imgArr) {\n        run(imgArr,function(timer){\n            //clearInterval(timer);\n        });\n    });\n````\n\n## 图片转base64的实现\n![动画效果](http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/basegif.gif)\n[转码base64实现demo](https://zhongs.github.io/frame-animation/imgBase64/index.html)\n### 需要的文件格式\n![图片](http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/base64.jpg)\n### 这种实现方式需要，先把图片转成base64格式的；遇到的问题是没有找到，现成的工具转换我需要的格式，于是自己写了个简单的js文件，用nodejs来实现转码任务；\n### toBase64.js转码文件\n在cmd命令行，进入当前toBase64.js文件目录下，执行node toBase64，会在img文件夹下生成base64.js文件\n````javascript\n    var fs = require('fs');\n    var path = require('path');\n    var util = require('util');\n\n    function base64Img(src) {\n        var data = fs.readFileSync(src).toString('base64');\n        return util.format('data:%s;base64,%s', 'image', data);\n    }\n\n    var outputFile = path.join(__dirname, './img/', 'base64.js');\n\n    var isFile = fs.existsSync(outputFile);\n    if (isFile) {\n        fs.unlinkSync(outputFile);\n    }\n\n    var filePath = path.join(__dirname, './img/');\n    var data = [];\n\n    var start = 1;\n    var end = fs.readdirSync('./img').length;\n    for (; start <= end; start++) {\n        data[start] = base64Img(filePath + start + '.png');\n    }\n\n    data.splice(0, 1);\n\n    var imgData = {\n        key: data\n    }\n\n    fs.writeFile(outputFile, 'var imgData = '+JSON.stringify(imgData), function(err) {\n        if (err) {\n            console.log(err);\n        } else {\n            console.log('Completed!');\n        }\n    });\n````\n### js逻辑部分\n````javascript\n    //引入生成的base64转码文件\n    <script src=\"img/base64.js\"></script>\n    <script>\n    var config = {\n        fps: 10, //每秒10帧\n        box: document.querySelector('.ani-box')\n    }\n\n    //创建图片标签\n    function createImg() {\n        var img = document.createElement('img');\n        config.box.appendChild(img);\n        return img;\n    }\n\n    //定时器来播放图片\n    function run(imgArr, fn) {\n        var img = createImg();\n        var n = 0;\n        var timer = setInterval(function() {\n            img.src = imgArr[n];\n            n++;\n            if (n == imgArr.length) {\n                n = 0;\n                fn && fn(timer);\n            }\n        }, 1000 / config.fps);\n\n    }\n\n    run( imgData.key, function(timer) {\n        //clearInterval(timer);\n    });\n    </script>\n````\n### [所有实现方式源码地址](https://github.com/zhongs/frame-animation)\n\n### 总结\n* 4种帧动画的实现方式，原理是大同小异的；\n* 图片一张一张的加载，会增加网络请求数量，转码base64文件会有点大，但能减少网络请求；\n* 实际开发中，需求可能没这么简单，例如：需要循环播放3次，在停留在最后一张图片上；\n\n\n\n","source":"_posts/实现逐帧动画的几种方式.md","raw":"---\ntitle: 实现逐帧动画的几种方式\ndate: 2017-10-23 22:31:18\ntags: 帧动画\n---\n<img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/timg.jpg\" width=\"80%\" height=\"50%\">\n公司有个特效师，专门做这样的帧动画图片，做好后就给到前端，来实现一张一张图片切换播放的动画；我用了canvas，css的animation，图片的image标签，以及图片转码base64的几种方式，分别实现了逐帧动画效果；\n<!-- more -->\n## 用canvas实现\n### 动画效果\n![动画效果](http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/ani.gif)\n![图片](http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/img.png)\n[canvas demo地址](https://zhongs.github.io/frame-animation/canvas/index.html)\n### 首先加载设计师给我的图片\n````javascript\n    //1.创建要加载的图片\n    var imgs = function() {\n        var imgsArr = [];\n        for (var i = 1; i < 21; i++) {\n            var imgSrc = `./img/${i}.png`;\n            imgsArr.push(imgSrc);\n        }\n        return imgsArr;\n    }\n\n    //2.加载图片\n    var loadImgs = function(fn) {\n        var loaded = 0; //记录已经加载图片的个数\n        var loadedImgsArr = []; //用来存放加载的图片\n        var imgsArr = imgs();\n        var imgObj = null;\n        imgsArr.forEach(function(value, index, arr) {\n            imgObj = new Image();\n            imgObj.onload = function() {\n                loaded++;\n                //这里所有的图片加载完成\n                if (loaded == imgsArr.length) {\n                    fn && fn(loadedImgsArr);\n                }\n            }\n            imgObj.src = imgsArr[index];\n            loadedImgsArr.push(imgObj);\n        });\n    }\n    \n````\n### 使用canvas的drawImage Api\n````javascript\n    //3.配置参数\n    var config = {\n        fps: 10, //帧率\n        parentBox: document.querySelectorAll('.ani-box')[0]\n    }\n\n    //4.创建canvas\n    var createCanvas = function() {\n        var canvas = document.createElement('canvas');\n        config.parentBox.appendChild(canvas);\n        var { offsetWidth, offsetHeight } = canvas.parentNode;\n        canvas.width = offsetWidth;\n        canvas.height = offsetHeight;\n        return canvas;\n    }\n\n    //5.有了图片和canvas对象，创建动画函数\n    var ani = function(imgsArr, cb) {\n        var canvas = createCanvas();\n        //图片的宽高\n        var offsetWidth = imgsArr[0].width;\n        var offsetHeight = imgsArr[0].height;\n        var ctx = canvas.getContext('2d');\n        var n = 0;\n        var timer = setInterval(function() {\n            //清屏\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n            //绘制图片        \n            ctx.drawImage(\n                imgsArr[n],\n                0, 0, offsetWidth, offsetHeight,\n                0, 0, canvas.width, canvas.height\n            );\n\n            n++;\n\n            //播放到最后一张图片\n            if (n == imgsArr.length) {\n                n = 0;\n                cb && cb(timer);\n            }\n        }, 1000 / config.fps);\n    }\n````\n### 调用\n````javascript\n    var init = function() {\n        //加载图片，执行动画\n        loadImgs(function(imgs) {\n            ani(imgs, function(timer) {\n                //播放完停留在最后一张\n                //clearInterval(timer);\n            });\n        });\n    }\n    init();\n````\n\n\n## 用css的animation动画实现\n[css demo地址](https://zhongs.github.io/frame-animation/css/index.html)\n### 首先需要知道的是有多少张图片,用scss生成css代码,会少写很多代码\n````scss\n    .animation {\n        animation: ani 2s infinite steps(1);\n    }\n\n    $img_total: 20;  //图片的总数\n    $img_n: 1;       //图片变量名\n    $n: 0;           //当前阶段，帧动画\n    @-webkit-keyframes ani {\n      @while $n <= 100 {\n        #{$n}% {\n          background-image: url(\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/#{$img_n}.png\");\n        }\n        $img_n: $img_n + 1;\n        @if ($img_n>$img_total) {\n          $img_n: 1;\n        }\n        $n: $n + ( 100 / $img_total );\n      }\n    }\n````\n\n### js判断图片是否完成\n````javascript\n     //1.创建要加载的图片\n    var imgs = function() {\n        var imgsArr = [];\n        for (var i = 1; i < 21; i++) {\n            var imgSrc = `http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/${i}.png`;\n            imgsArr.push(imgSrc);\n        }\n        return imgsArr;\n    }\n\n    //2.加载图片\n    var loadImgs = function(fn) {\n        var loaded = 0; //记录已经加载图片的个数\n        var loadedImgsArr = []; //用来存放加载的图片\n        var imgsArr = imgs();\n        var imgObj = null;\n        imgsArr.forEach(function(value, index, arr) {\n            imgObj = new Image();\n            imgObj.onload = function() {\n                loaded++;\n                //这里所有的图片加载完成\n                if (loaded == imgsArr.length) {\n                    fn && fn(loadedImgsArr);\n                }\n            }\n            imgObj.src = imgsArr[index];\n            loadedImgsArr.push(imgObj);\n        });\n    }\n\n    //添加class\n    loadImgs(function(){\n        document.querySelectorAll('.ani-box')[0].className += \" animation\"\n    })\n````\n## 用img标签的src实现\n[image标签实现demo](https://zhongs.github.io/frame-animation/img/index.html)\n### 首先还是得确保图片全部加载完成，后面就是替换src的一个过程；\n````javascript\n //1.创建要加载的图片\n    var imgs = function() {\n        var imgsArr = [];\n        for (var i = 1; i < 21; i++) {\n            var imgSrc = `./img/${i}.png`;\n            imgsArr.push(imgSrc);\n        }\n        return imgsArr;\n    }\n\n    //2.加载图片\n    var loadImgs = function(fn) {\n        var loaded = 0; //记录已经加载图片的个数\n        var loadedImgsArr = []; //用来存放加载的图片\n        var imgsArr = imgs();\n        var imgObj = null;\n        imgsArr.forEach(function(value, index, arr) {\n            imgObj = new Image();\n            imgObj.onload = function() {\n                loaded++;\n                //这里所有的图片加载完成\n                if (loaded == imgsArr.length) {\n                    fn && fn(loadedImgsArr);\n                }\n            }\n            imgObj.src = imgsArr[index];\n            loadedImgsArr.push(imgObj);\n        });\n    }\n\n    var config = {\n        fps: 10, //每秒10帧\n        box: document.querySelector('.ani-box')\n    }\n\n    //创建图片标签\n    function createImg() {\n        var img = document.createElement('img');\n        config.box.appendChild(img);\n        return img;\n    }\n\n    //定时器来播放图片\n    function run(imgArr, fn) {\n        var img = createImg();\n        var n = 0;\n        var timer = setInterval(function() {\n            img.src = imgArr[n].src;\n            n++;\n            if(n == imgArr.length){\n                n = 0;\n                fn && fn(timer);\n            }\n        }, 1000 / config.fps);\n\n    }\n\n    loadImgs(function(imgArr) {\n        run(imgArr,function(timer){\n            //clearInterval(timer);\n        });\n    });\n````\n\n## 图片转base64的实现\n![动画效果](http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/basegif.gif)\n[转码base64实现demo](https://zhongs.github.io/frame-animation/imgBase64/index.html)\n### 需要的文件格式\n![图片](http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/base64.jpg)\n### 这种实现方式需要，先把图片转成base64格式的；遇到的问题是没有找到，现成的工具转换我需要的格式，于是自己写了个简单的js文件，用nodejs来实现转码任务；\n### toBase64.js转码文件\n在cmd命令行，进入当前toBase64.js文件目录下，执行node toBase64，会在img文件夹下生成base64.js文件\n````javascript\n    var fs = require('fs');\n    var path = require('path');\n    var util = require('util');\n\n    function base64Img(src) {\n        var data = fs.readFileSync(src).toString('base64');\n        return util.format('data:%s;base64,%s', 'image', data);\n    }\n\n    var outputFile = path.join(__dirname, './img/', 'base64.js');\n\n    var isFile = fs.existsSync(outputFile);\n    if (isFile) {\n        fs.unlinkSync(outputFile);\n    }\n\n    var filePath = path.join(__dirname, './img/');\n    var data = [];\n\n    var start = 1;\n    var end = fs.readdirSync('./img').length;\n    for (; start <= end; start++) {\n        data[start] = base64Img(filePath + start + '.png');\n    }\n\n    data.splice(0, 1);\n\n    var imgData = {\n        key: data\n    }\n\n    fs.writeFile(outputFile, 'var imgData = '+JSON.stringify(imgData), function(err) {\n        if (err) {\n            console.log(err);\n        } else {\n            console.log('Completed!');\n        }\n    });\n````\n### js逻辑部分\n````javascript\n    //引入生成的base64转码文件\n    <script src=\"img/base64.js\"></script>\n    <script>\n    var config = {\n        fps: 10, //每秒10帧\n        box: document.querySelector('.ani-box')\n    }\n\n    //创建图片标签\n    function createImg() {\n        var img = document.createElement('img');\n        config.box.appendChild(img);\n        return img;\n    }\n\n    //定时器来播放图片\n    function run(imgArr, fn) {\n        var img = createImg();\n        var n = 0;\n        var timer = setInterval(function() {\n            img.src = imgArr[n];\n            n++;\n            if (n == imgArr.length) {\n                n = 0;\n                fn && fn(timer);\n            }\n        }, 1000 / config.fps);\n\n    }\n\n    run( imgData.key, function(timer) {\n        //clearInterval(timer);\n    });\n    </script>\n````\n### [所有实现方式源码地址](https://github.com/zhongs/frame-animation)\n\n### 总结\n* 4种帧动画的实现方式，原理是大同小异的；\n* 图片一张一张的加载，会增加网络请求数量，转码base64文件会有点大，但能减少网络请求；\n* 实际开发中，需求可能没这么简单，例如：需要循环播放3次，在停留在最后一张图片上；\n\n\n\n","slug":"实现逐帧动画的几种方式","published":1,"updated":"2019-03-21T04:23:24.672Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckknbqwg5000a10ud88di4aq2","content":"<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/timg.jpg\" width=\"80%\" height=\"50%\"><br>公司有个特效师，专门做这样的帧动画图片，做好后就给到前端，来实现一张一张图片切换播放的动画；我用了canvas，css的animation，图片的image标签，以及图片转码base64的几种方式，分别实现了逐帧动画效果；<br><a id=\"more\"></a></p>\n<h2 id=\"用canvas实现\"><a href=\"#用canvas实现\" class=\"headerlink\" title=\"用canvas实现\"></a>用canvas实现</h2><h3 id=\"动画效果\"><a href=\"#动画效果\" class=\"headerlink\" title=\"动画效果\"></a>动画效果</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/ani.gif\" alt=\"动画效果\"><br><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/img.png\" alt=\"图片\"><br><a href=\"https://zhongs.github.io/frame-animation/canvas/index.html\" target=\"_blank\" rel=\"noopener\">canvas demo地址</a></p>\n<h3 id=\"首先加载设计师给我的图片\"><a href=\"#首先加载设计师给我的图片\" class=\"headerlink\" title=\"首先加载设计师给我的图片\"></a>首先加载设计师给我的图片</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1.创建要加载的图片</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> imgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgsArr = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"number\">21</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> imgSrc = <span class=\"string\">`./img/<span class=\"subst\">$&#123;i&#125;</span>.png`</span>;</span><br><span class=\"line\">        imgsArr.push(imgSrc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> imgsArr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//2.加载图片</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> loadImgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> loaded = <span class=\"number\">0</span>; <span class=\"comment\">//记录已经加载图片的个数</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> loadedImgsArr = []; <span class=\"comment\">//用来存放加载的图片</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgsArr = imgs();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgObj = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    imgsArr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>) </span>&#123;</span><br><span class=\"line\">        imgObj = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">        imgObj.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            loaded++;</span><br><span class=\"line\">            <span class=\"comment\">//这里所有的图片加载完成</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (loaded == imgsArr.length) &#123;</span><br><span class=\"line\">                fn &amp;&amp; fn(loadedImgsArr);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        imgObj.src = imgsArr[index];</span><br><span class=\"line\">        loadedImgsArr.push(imgObj);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"使用canvas的drawImage-Api\"><a href=\"#使用canvas的drawImage-Api\" class=\"headerlink\" title=\"使用canvas的drawImage Api\"></a>使用canvas的drawImage Api</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//3.配置参数</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> config = &#123;</span><br><span class=\"line\">    fps: <span class=\"number\">10</span>, <span class=\"comment\">//帧率</span></span><br><span class=\"line\">    parentBox: <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'.ani-box'</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//4.创建canvas</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> createCanvas = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">    config.parentBox.appendChild(canvas);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> &#123; offsetWidth, offsetHeight &#125; = canvas.parentNode;</span><br><span class=\"line\">    canvas.width = offsetWidth;</span><br><span class=\"line\">    canvas.height = offsetHeight;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> canvas;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//5.有了图片和canvas对象，创建动画函数</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ani = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">imgsArr, cb</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = createCanvas();</span><br><span class=\"line\">    <span class=\"comment\">//图片的宽高</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> offsetWidth = imgsArr[<span class=\"number\">0</span>].width;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> offsetHeight = imgsArr[<span class=\"number\">0</span>].height;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timer = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//清屏</span></span><br><span class=\"line\">        ctx.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//绘制图片        </span></span><br><span class=\"line\">        ctx.drawImage(</span><br><span class=\"line\">            imgsArr[n],</span><br><span class=\"line\">            <span class=\"number\">0</span>, <span class=\"number\">0</span>, offsetWidth, offsetHeight,</span><br><span class=\"line\">            <span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        n++;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//播放到最后一张图片</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (n == imgsArr.length) &#123;</span><br><span class=\"line\">            n = <span class=\"number\">0</span>;</span><br><span class=\"line\">            cb &amp;&amp; cb(timer);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span> / config.fps);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"调用\"><a href=\"#调用\" class=\"headerlink\" title=\"调用\"></a>调用</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> init = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//加载图片，执行动画</span></span><br><span class=\"line\">    loadImgs(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">imgs</span>) </span>&#123;</span><br><span class=\"line\">        ani(imgs, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">timer</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//播放完停留在最后一张</span></span><br><span class=\"line\">            <span class=\"comment\">//clearInterval(timer);</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">init();</span><br></pre></td></tr></table></figure>\n<h2 id=\"用css的animation动画实现\"><a href=\"#用css的animation动画实现\" class=\"headerlink\" title=\"用css的animation动画实现\"></a>用css的animation动画实现</h2><p><a href=\"https://zhongs.github.io/frame-animation/css/index.html\" target=\"_blank\" rel=\"noopener\">css demo地址</a></p>\n<h3 id=\"首先需要知道的是有多少张图片-用scss生成css代码-会少写很多代码\"><a href=\"#首先需要知道的是有多少张图片-用scss生成css代码-会少写很多代码\" class=\"headerlink\" title=\"首先需要知道的是有多少张图片,用scss生成css代码,会少写很多代码\"></a>首先需要知道的是有多少张图片,用scss生成css代码,会少写很多代码</h3><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.animation</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">animation</span>: ani <span class=\"number\">2s</span> infinite steps(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$img_total</span>: <span class=\"number\">20</span>;  <span class=\"comment\">//图片的总数</span></span><br><span class=\"line\"><span class=\"variable\">$img_n</span>: <span class=\"number\">1</span>;       <span class=\"comment\">//图片变量名</span></span><br><span class=\"line\"><span class=\"variable\">$n</span>: <span class=\"number\">0</span>;           <span class=\"comment\">//当前阶段，帧动画</span></span><br><span class=\"line\"><span class=\"keyword\">@-webkit-keyframes</span> ani &#123;</span><br><span class=\"line\">  <span class=\"keyword\">@while</span> <span class=\"variable\">$n</span> &lt;= <span class=\"number\">100</span> &#123;</span><br><span class=\"line\">    #&#123;<span class=\"variable\">$n</span>&#125;% &#123;</span><br><span class=\"line\">      <span class=\"attribute\">background-image</span>: url(<span class=\"string\">\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/#&#123;$img_n&#125;.png\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$img_n</span>: <span class=\"variable\">$img_n</span> + <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">@if</span> (<span class=\"variable\">$img_n</span>&gt;<span class=\"variable\">$img_total</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$img_n</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$n</span>: <span class=\"variable\">$n</span> + ( <span class=\"number\">100</span> / <span class=\"variable\">$img_total</span> );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"js判断图片是否完成\"><a href=\"#js判断图片是否完成\" class=\"headerlink\" title=\"js判断图片是否完成\"></a>js判断图片是否完成</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">//1.创建要加载的图片</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> imgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgsArr = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"number\">21</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> imgSrc = <span class=\"string\">`http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/<span class=\"subst\">$&#123;i&#125;</span>.png`</span>;</span><br><span class=\"line\">        imgsArr.push(imgSrc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> imgsArr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//2.加载图片</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> loadImgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> loaded = <span class=\"number\">0</span>; <span class=\"comment\">//记录已经加载图片的个数</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> loadedImgsArr = []; <span class=\"comment\">//用来存放加载的图片</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgsArr = imgs();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgObj = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    imgsArr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>) </span>&#123;</span><br><span class=\"line\">        imgObj = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">        imgObj.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            loaded++;</span><br><span class=\"line\">            <span class=\"comment\">//这里所有的图片加载完成</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (loaded == imgsArr.length) &#123;</span><br><span class=\"line\">                fn &amp;&amp; fn(loadedImgsArr);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        imgObj.src = imgsArr[index];</span><br><span class=\"line\">        loadedImgsArr.push(imgObj);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//添加class</span></span><br><span class=\"line\">loadImgs(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'.ani-box'</span>)[<span class=\"number\">0</span>].className += <span class=\"string\">\" animation\"</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"用img标签的src实现\"><a href=\"#用img标签的src实现\" class=\"headerlink\" title=\"用img标签的src实现\"></a>用img标签的src实现</h2><p><a href=\"https://zhongs.github.io/frame-animation/img/index.html\" target=\"_blank\" rel=\"noopener\">image标签实现demo</a></p>\n<h3 id=\"首先还是得确保图片全部加载完成，后面就是替换src的一个过程；\"><a href=\"#首先还是得确保图片全部加载完成，后面就是替换src的一个过程；\" class=\"headerlink\" title=\"首先还是得确保图片全部加载完成，后面就是替换src的一个过程；\"></a>首先还是得确保图片全部加载完成，后面就是替换src的一个过程；</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1.创建要加载的图片</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> imgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> imgsArr = [];</span><br><span class=\"line\">       <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"number\">21</span>; i++) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">var</span> imgSrc = <span class=\"string\">`./img/<span class=\"subst\">$&#123;i&#125;</span>.png`</span>;</span><br><span class=\"line\">           imgsArr.push(imgSrc);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> imgsArr;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//2.加载图片</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> loadImgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> loaded = <span class=\"number\">0</span>; <span class=\"comment\">//记录已经加载图片的个数</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> loadedImgsArr = []; <span class=\"comment\">//用来存放加载的图片</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> imgsArr = imgs();</span><br><span class=\"line\">       <span class=\"keyword\">var</span> imgObj = <span class=\"literal\">null</span>;</span><br><span class=\"line\">       imgsArr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>) </span>&#123;</span><br><span class=\"line\">           imgObj = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">           imgObj.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">               loaded++;</span><br><span class=\"line\">               <span class=\"comment\">//这里所有的图片加载完成</span></span><br><span class=\"line\">               <span class=\"keyword\">if</span> (loaded == imgsArr.length) &#123;</span><br><span class=\"line\">                   fn &amp;&amp; fn(loadedImgsArr);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           imgObj.src = imgsArr[index];</span><br><span class=\"line\">           loadedImgsArr.push(imgObj);</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">var</span> config = &#123;</span><br><span class=\"line\">       fps: <span class=\"number\">10</span>, <span class=\"comment\">//每秒10帧</span></span><br><span class=\"line\">       box: <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.ani-box'</span>)</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//创建图片标签</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createImg</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">       config.box.appendChild(img);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> img;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//定时器来播放图片</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">run</span>(<span class=\"params\">imgArr, fn</span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> img = createImg();</span><br><span class=\"line\">       <span class=\"keyword\">var</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> timer = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">           img.src = imgArr[n].src;</span><br><span class=\"line\">           n++;</span><br><span class=\"line\">           <span class=\"keyword\">if</span>(n == imgArr.length)&#123;</span><br><span class=\"line\">               n = <span class=\"number\">0</span>;</span><br><span class=\"line\">               fn &amp;&amp; fn(timer);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;, <span class=\"number\">1000</span> / config.fps);</span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   loadImgs(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">imgArr</span>) </span>&#123;</span><br><span class=\"line\">       run(imgArr,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">timer</span>)</span>&#123;</span><br><span class=\"line\">           <span class=\"comment\">//clearInterval(timer);</span></span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">   &#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"图片转base64的实现\"><a href=\"#图片转base64的实现\" class=\"headerlink\" title=\"图片转base64的实现\"></a>图片转base64的实现</h2><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/basegif.gif\" alt=\"动画效果\"><br><a href=\"https://zhongs.github.io/frame-animation/imgBase64/index.html\" target=\"_blank\" rel=\"noopener\">转码base64实现demo</a></p>\n<h3 id=\"需要的文件格式\"><a href=\"#需要的文件格式\" class=\"headerlink\" title=\"需要的文件格式\"></a>需要的文件格式</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/base64.jpg\" alt=\"图片\"></p>\n<h3 id=\"这种实现方式需要，先把图片转成base64格式的；遇到的问题是没有找到，现成的工具转换我需要的格式，于是自己写了个简单的js文件，用nodejs来实现转码任务；\"><a href=\"#这种实现方式需要，先把图片转成base64格式的；遇到的问题是没有找到，现成的工具转换我需要的格式，于是自己写了个简单的js文件，用nodejs来实现转码任务；\" class=\"headerlink\" title=\"这种实现方式需要，先把图片转成base64格式的；遇到的问题是没有找到，现成的工具转换我需要的格式，于是自己写了个简单的js文件，用nodejs来实现转码任务；\"></a>这种实现方式需要，先把图片转成base64格式的；遇到的问题是没有找到，现成的工具转换我需要的格式，于是自己写了个简单的js文件，用nodejs来实现转码任务；</h3><h3 id=\"toBase64-js转码文件\"><a href=\"#toBase64-js转码文件\" class=\"headerlink\" title=\"toBase64.js转码文件\"></a>toBase64.js转码文件</h3><p>在cmd命令行，进入当前toBase64.js文件目录下，执行node toBase64，会在img文件夹下生成base64.js文件<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> util = <span class=\"built_in\">require</span>(<span class=\"string\">'util'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">base64Img</span>(<span class=\"params\">src</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> data = fs.readFileSync(src).toString(<span class=\"string\">'base64'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> util.format(<span class=\"string\">'data:%s;base64,%s'</span>, <span class=\"string\">'image'</span>, data);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> outputFile = path.join(__dirname, <span class=\"string\">'./img/'</span>, <span class=\"string\">'base64.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> isFile = fs.existsSync(outputFile);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (isFile) &#123;</span><br><span class=\"line\">    fs.unlinkSync(outputFile);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> filePath = path.join(__dirname, <span class=\"string\">'./img/'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> data = [];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> start = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> end = fs.readdirSync(<span class=\"string\">'./img'</span>).length;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (; start &lt;= end; start++) &#123;</span><br><span class=\"line\">    data[start] = base64Img(filePath + start + <span class=\"string\">'.png'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">data.splice(<span class=\"number\">0</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> imgData = &#123;</span><br><span class=\"line\">    key: data</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fs.writeFile(outputFile, <span class=\"string\">'var imgData = '</span>+<span class=\"built_in\">JSON</span>.stringify(imgData), <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Completed!'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"js逻辑部分\"><a href=\"#js逻辑部分\" class=\"headerlink\" title=\"js逻辑部分\"></a>js逻辑部分</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//引入生成的base64转码文件</span></span><br><span class=\"line\">&lt;script src=<span class=\"string\">\"img/base64.js\"</span>&gt;&lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">var config = &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    fps: 10, /</span><span class=\"regexp\">/每秒10帧</span></span><br><span class=\"line\"><span class=\"regexp\">    box: document.querySelector('.ani-box')</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">/</span><span class=\"regexp\">/创建图片标签</span></span><br><span class=\"line\"><span class=\"regexp\">function createImg() &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    var img = document.createElement('img');</span></span><br><span class=\"line\"><span class=\"regexp\">    config.box.appendChild(img);</span></span><br><span class=\"line\"><span class=\"regexp\">    return img;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">/</span><span class=\"regexp\">/定时器来播放图片</span></span><br><span class=\"line\"><span class=\"regexp\">function run(imgArr, fn) &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    var img = createImg();</span></span><br><span class=\"line\"><span class=\"regexp\">    var n = 0;</span></span><br><span class=\"line\"><span class=\"regexp\">    var timer = setInterval(function() &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">        img.src = imgArr[n];</span></span><br><span class=\"line\"><span class=\"regexp\">        n++;</span></span><br><span class=\"line\"><span class=\"regexp\">        if (n == imgArr.length) &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            n = 0;</span></span><br><span class=\"line\"><span class=\"regexp\">            fn &amp;&amp; fn(timer);</span></span><br><span class=\"line\"><span class=\"regexp\">        &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;, 1000 /</span> config.fps);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">run( imgData.key, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">timer</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//clearInterval(timer);</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"所有实现方式源码地址\"><a href=\"#所有实现方式源码地址\" class=\"headerlink\" title=\"所有实现方式源码地址\"></a><a href=\"https://github.com/zhongs/frame-animation\" target=\"_blank\" rel=\"noopener\">所有实现方式源码地址</a></h3><h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><ul>\n<li>4种帧动画的实现方式，原理是大同小异的；</li>\n<li>图片一张一张的加载，会增加网络请求数量，转码base64文件会有点大，但能减少网络请求；</li>\n<li>实际开发中，需求可能没这么简单，例如：需要循环播放3次，在停留在最后一张图片上；</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/timg.jpg\" width=\"80%\" height=\"50%\"><br>公司有个特效师，专门做这样的帧动画图片，做好后就给到前端，来实现一张一张图片切换播放的动画；我用了canvas，css的animation，图片的image标签，以及图片转码base64的几种方式，分别实现了逐帧动画效果；<br>","more":"</p>\n<h2 id=\"用canvas实现\"><a href=\"#用canvas实现\" class=\"headerlink\" title=\"用canvas实现\"></a>用canvas实现</h2><h3 id=\"动画效果\"><a href=\"#动画效果\" class=\"headerlink\" title=\"动画效果\"></a>动画效果</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/ani.gif\" alt=\"动画效果\"><br><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/img.png\" alt=\"图片\"><br><a href=\"https://zhongs.github.io/frame-animation/canvas/index.html\" target=\"_blank\" rel=\"noopener\">canvas demo地址</a></p>\n<h3 id=\"首先加载设计师给我的图片\"><a href=\"#首先加载设计师给我的图片\" class=\"headerlink\" title=\"首先加载设计师给我的图片\"></a>首先加载设计师给我的图片</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1.创建要加载的图片</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> imgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgsArr = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"number\">21</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> imgSrc = <span class=\"string\">`./img/<span class=\"subst\">$&#123;i&#125;</span>.png`</span>;</span><br><span class=\"line\">        imgsArr.push(imgSrc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> imgsArr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//2.加载图片</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> loadImgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> loaded = <span class=\"number\">0</span>; <span class=\"comment\">//记录已经加载图片的个数</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> loadedImgsArr = []; <span class=\"comment\">//用来存放加载的图片</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgsArr = imgs();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgObj = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    imgsArr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>) </span>&#123;</span><br><span class=\"line\">        imgObj = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">        imgObj.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            loaded++;</span><br><span class=\"line\">            <span class=\"comment\">//这里所有的图片加载完成</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (loaded == imgsArr.length) &#123;</span><br><span class=\"line\">                fn &amp;&amp; fn(loadedImgsArr);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        imgObj.src = imgsArr[index];</span><br><span class=\"line\">        loadedImgsArr.push(imgObj);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"使用canvas的drawImage-Api\"><a href=\"#使用canvas的drawImage-Api\" class=\"headerlink\" title=\"使用canvas的drawImage Api\"></a>使用canvas的drawImage Api</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//3.配置参数</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> config = &#123;</span><br><span class=\"line\">    fps: <span class=\"number\">10</span>, <span class=\"comment\">//帧率</span></span><br><span class=\"line\">    parentBox: <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'.ani-box'</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//4.创建canvas</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> createCanvas = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">    config.parentBox.appendChild(canvas);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> &#123; offsetWidth, offsetHeight &#125; = canvas.parentNode;</span><br><span class=\"line\">    canvas.width = offsetWidth;</span><br><span class=\"line\">    canvas.height = offsetHeight;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> canvas;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//5.有了图片和canvas对象，创建动画函数</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ani = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">imgsArr, cb</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = createCanvas();</span><br><span class=\"line\">    <span class=\"comment\">//图片的宽高</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> offsetWidth = imgsArr[<span class=\"number\">0</span>].width;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> offsetHeight = imgsArr[<span class=\"number\">0</span>].height;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timer = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//清屏</span></span><br><span class=\"line\">        ctx.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//绘制图片        </span></span><br><span class=\"line\">        ctx.drawImage(</span><br><span class=\"line\">            imgsArr[n],</span><br><span class=\"line\">            <span class=\"number\">0</span>, <span class=\"number\">0</span>, offsetWidth, offsetHeight,</span><br><span class=\"line\">            <span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        n++;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//播放到最后一张图片</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (n == imgsArr.length) &#123;</span><br><span class=\"line\">            n = <span class=\"number\">0</span>;</span><br><span class=\"line\">            cb &amp;&amp; cb(timer);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span> / config.fps);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"调用\"><a href=\"#调用\" class=\"headerlink\" title=\"调用\"></a>调用</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> init = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//加载图片，执行动画</span></span><br><span class=\"line\">    loadImgs(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">imgs</span>) </span>&#123;</span><br><span class=\"line\">        ani(imgs, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">timer</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//播放完停留在最后一张</span></span><br><span class=\"line\">            <span class=\"comment\">//clearInterval(timer);</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">init();</span><br></pre></td></tr></table></figure>\n<h2 id=\"用css的animation动画实现\"><a href=\"#用css的animation动画实现\" class=\"headerlink\" title=\"用css的animation动画实现\"></a>用css的animation动画实现</h2><p><a href=\"https://zhongs.github.io/frame-animation/css/index.html\" target=\"_blank\" rel=\"noopener\">css demo地址</a></p>\n<h3 id=\"首先需要知道的是有多少张图片-用scss生成css代码-会少写很多代码\"><a href=\"#首先需要知道的是有多少张图片-用scss生成css代码-会少写很多代码\" class=\"headerlink\" title=\"首先需要知道的是有多少张图片,用scss生成css代码,会少写很多代码\"></a>首先需要知道的是有多少张图片,用scss生成css代码,会少写很多代码</h3><figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.animation</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">animation</span>: ani <span class=\"number\">2s</span> infinite steps(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$img_total</span>: <span class=\"number\">20</span>;  <span class=\"comment\">//图片的总数</span></span><br><span class=\"line\"><span class=\"variable\">$img_n</span>: <span class=\"number\">1</span>;       <span class=\"comment\">//图片变量名</span></span><br><span class=\"line\"><span class=\"variable\">$n</span>: <span class=\"number\">0</span>;           <span class=\"comment\">//当前阶段，帧动画</span></span><br><span class=\"line\"><span class=\"keyword\">@-webkit-keyframes</span> ani &#123;</span><br><span class=\"line\">  <span class=\"keyword\">@while</span> <span class=\"variable\">$n</span> &lt;= <span class=\"number\">100</span> &#123;</span><br><span class=\"line\">    #&#123;<span class=\"variable\">$n</span>&#125;% &#123;</span><br><span class=\"line\">      <span class=\"attribute\">background-image</span>: url(<span class=\"string\">\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/#&#123;$img_n&#125;.png\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$img_n</span>: <span class=\"variable\">$img_n</span> + <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">@if</span> (<span class=\"variable\">$img_n</span>&gt;<span class=\"variable\">$img_total</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$img_n</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$n</span>: <span class=\"variable\">$n</span> + ( <span class=\"number\">100</span> / <span class=\"variable\">$img_total</span> );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"js判断图片是否完成\"><a href=\"#js判断图片是否完成\" class=\"headerlink\" title=\"js判断图片是否完成\"></a>js判断图片是否完成</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">//1.创建要加载的图片</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> imgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgsArr = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"number\">21</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> imgSrc = <span class=\"string\">`http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/<span class=\"subst\">$&#123;i&#125;</span>.png`</span>;</span><br><span class=\"line\">        imgsArr.push(imgSrc);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> imgsArr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//2.加载图片</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> loadImgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> loaded = <span class=\"number\">0</span>; <span class=\"comment\">//记录已经加载图片的个数</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> loadedImgsArr = []; <span class=\"comment\">//用来存放加载的图片</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgsArr = imgs();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imgObj = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    imgsArr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>) </span>&#123;</span><br><span class=\"line\">        imgObj = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">        imgObj.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            loaded++;</span><br><span class=\"line\">            <span class=\"comment\">//这里所有的图片加载完成</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (loaded == imgsArr.length) &#123;</span><br><span class=\"line\">                fn &amp;&amp; fn(loadedImgsArr);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        imgObj.src = imgsArr[index];</span><br><span class=\"line\">        loadedImgsArr.push(imgObj);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//添加class</span></span><br><span class=\"line\">loadImgs(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'.ani-box'</span>)[<span class=\"number\">0</span>].className += <span class=\"string\">\" animation\"</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"用img标签的src实现\"><a href=\"#用img标签的src实现\" class=\"headerlink\" title=\"用img标签的src实现\"></a>用img标签的src实现</h2><p><a href=\"https://zhongs.github.io/frame-animation/img/index.html\" target=\"_blank\" rel=\"noopener\">image标签实现demo</a></p>\n<h3 id=\"首先还是得确保图片全部加载完成，后面就是替换src的一个过程；\"><a href=\"#首先还是得确保图片全部加载完成，后面就是替换src的一个过程；\" class=\"headerlink\" title=\"首先还是得确保图片全部加载完成，后面就是替换src的一个过程；\"></a>首先还是得确保图片全部加载完成，后面就是替换src的一个过程；</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1.创建要加载的图片</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> imgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> imgsArr = [];</span><br><span class=\"line\">       <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; <span class=\"number\">21</span>; i++) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">var</span> imgSrc = <span class=\"string\">`./img/<span class=\"subst\">$&#123;i&#125;</span>.png`</span>;</span><br><span class=\"line\">           imgsArr.push(imgSrc);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> imgsArr;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//2.加载图片</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> loadImgs = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> loaded = <span class=\"number\">0</span>; <span class=\"comment\">//记录已经加载图片的个数</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> loadedImgsArr = []; <span class=\"comment\">//用来存放加载的图片</span></span><br><span class=\"line\">       <span class=\"keyword\">var</span> imgsArr = imgs();</span><br><span class=\"line\">       <span class=\"keyword\">var</span> imgObj = <span class=\"literal\">null</span>;</span><br><span class=\"line\">       imgsArr.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">value, index, arr</span>) </span>&#123;</span><br><span class=\"line\">           imgObj = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">           imgObj.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">               loaded++;</span><br><span class=\"line\">               <span class=\"comment\">//这里所有的图片加载完成</span></span><br><span class=\"line\">               <span class=\"keyword\">if</span> (loaded == imgsArr.length) &#123;</span><br><span class=\"line\">                   fn &amp;&amp; fn(loadedImgsArr);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           imgObj.src = imgsArr[index];</span><br><span class=\"line\">           loadedImgsArr.push(imgObj);</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">var</span> config = &#123;</span><br><span class=\"line\">       fps: <span class=\"number\">10</span>, <span class=\"comment\">//每秒10帧</span></span><br><span class=\"line\">       box: <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.ani-box'</span>)</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//创建图片标签</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createImg</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">       config.box.appendChild(img);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> img;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">//定时器来播放图片</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">run</span>(<span class=\"params\">imgArr, fn</span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> img = createImg();</span><br><span class=\"line\">       <span class=\"keyword\">var</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> timer = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">           img.src = imgArr[n].src;</span><br><span class=\"line\">           n++;</span><br><span class=\"line\">           <span class=\"keyword\">if</span>(n == imgArr.length)&#123;</span><br><span class=\"line\">               n = <span class=\"number\">0</span>;</span><br><span class=\"line\">               fn &amp;&amp; fn(timer);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;, <span class=\"number\">1000</span> / config.fps);</span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   loadImgs(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">imgArr</span>) </span>&#123;</span><br><span class=\"line\">       run(imgArr,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">timer</span>)</span>&#123;</span><br><span class=\"line\">           <span class=\"comment\">//clearInterval(timer);</span></span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">   &#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"图片转base64的实现\"><a href=\"#图片转base64的实现\" class=\"headerlink\" title=\"图片转base64的实现\"></a>图片转base64的实现</h2><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/basegif.gif\" alt=\"动画效果\"><br><a href=\"https://zhongs.github.io/frame-animation/imgBase64/index.html\" target=\"_blank\" rel=\"noopener\">转码base64实现demo</a></p>\n<h3 id=\"需要的文件格式\"><a href=\"#需要的文件格式\" class=\"headerlink\" title=\"需要的文件格式\"></a>需要的文件格式</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/frameAni/base64.jpg\" alt=\"图片\"></p>\n<h3 id=\"这种实现方式需要，先把图片转成base64格式的；遇到的问题是没有找到，现成的工具转换我需要的格式，于是自己写了个简单的js文件，用nodejs来实现转码任务；\"><a href=\"#这种实现方式需要，先把图片转成base64格式的；遇到的问题是没有找到，现成的工具转换我需要的格式，于是自己写了个简单的js文件，用nodejs来实现转码任务；\" class=\"headerlink\" title=\"这种实现方式需要，先把图片转成base64格式的；遇到的问题是没有找到，现成的工具转换我需要的格式，于是自己写了个简单的js文件，用nodejs来实现转码任务；\"></a>这种实现方式需要，先把图片转成base64格式的；遇到的问题是没有找到，现成的工具转换我需要的格式，于是自己写了个简单的js文件，用nodejs来实现转码任务；</h3><h3 id=\"toBase64-js转码文件\"><a href=\"#toBase64-js转码文件\" class=\"headerlink\" title=\"toBase64.js转码文件\"></a>toBase64.js转码文件</h3><p>在cmd命令行，进入当前toBase64.js文件目录下，执行node toBase64，会在img文件夹下生成base64.js文件<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> util = <span class=\"built_in\">require</span>(<span class=\"string\">'util'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">base64Img</span>(<span class=\"params\">src</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> data = fs.readFileSync(src).toString(<span class=\"string\">'base64'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> util.format(<span class=\"string\">'data:%s;base64,%s'</span>, <span class=\"string\">'image'</span>, data);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> outputFile = path.join(__dirname, <span class=\"string\">'./img/'</span>, <span class=\"string\">'base64.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> isFile = fs.existsSync(outputFile);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (isFile) &#123;</span><br><span class=\"line\">    fs.unlinkSync(outputFile);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> filePath = path.join(__dirname, <span class=\"string\">'./img/'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> data = [];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> start = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> end = fs.readdirSync(<span class=\"string\">'./img'</span>).length;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (; start &lt;= end; start++) &#123;</span><br><span class=\"line\">    data[start] = base64Img(filePath + start + <span class=\"string\">'.png'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">data.splice(<span class=\"number\">0</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> imgData = &#123;</span><br><span class=\"line\">    key: data</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fs.writeFile(outputFile, <span class=\"string\">'var imgData = '</span>+<span class=\"built_in\">JSON</span>.stringify(imgData), <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Completed!'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"js逻辑部分\"><a href=\"#js逻辑部分\" class=\"headerlink\" title=\"js逻辑部分\"></a>js逻辑部分</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//引入生成的base64转码文件</span></span><br><span class=\"line\">&lt;script src=<span class=\"string\">\"img/base64.js\"</span>&gt;&lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">var config = &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    fps: 10, /</span><span class=\"regexp\">/每秒10帧</span></span><br><span class=\"line\"><span class=\"regexp\">    box: document.querySelector('.ani-box')</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">/</span><span class=\"regexp\">/创建图片标签</span></span><br><span class=\"line\"><span class=\"regexp\">function createImg() &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    var img = document.createElement('img');</span></span><br><span class=\"line\"><span class=\"regexp\">    config.box.appendChild(img);</span></span><br><span class=\"line\"><span class=\"regexp\">    return img;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">/</span><span class=\"regexp\">/定时器来播放图片</span></span><br><span class=\"line\"><span class=\"regexp\">function run(imgArr, fn) &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    var img = createImg();</span></span><br><span class=\"line\"><span class=\"regexp\">    var n = 0;</span></span><br><span class=\"line\"><span class=\"regexp\">    var timer = setInterval(function() &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">        img.src = imgArr[n];</span></span><br><span class=\"line\"><span class=\"regexp\">        n++;</span></span><br><span class=\"line\"><span class=\"regexp\">        if (n == imgArr.length) &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            n = 0;</span></span><br><span class=\"line\"><span class=\"regexp\">            fn &amp;&amp; fn(timer);</span></span><br><span class=\"line\"><span class=\"regexp\">        &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;, 1000 /</span> config.fps);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">run( imgData.key, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">timer</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//clearInterval(timer);</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"所有实现方式源码地址\"><a href=\"#所有实现方式源码地址\" class=\"headerlink\" title=\"所有实现方式源码地址\"></a><a href=\"https://github.com/zhongs/frame-animation\" target=\"_blank\" rel=\"noopener\">所有实现方式源码地址</a></h3><h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><ul>\n<li>4种帧动画的实现方式，原理是大同小异的；</li>\n<li>图片一张一张的加载，会增加网络请求数量，转码base64文件会有点大，但能减少网络请求；</li>\n<li>实际开发中，需求可能没这么简单，例如：需要循环播放3次，在停留在最后一张图片上；</li>\n</ul>"},{"title":"视频转码播放实践","date":"2017-11-09T08:25:16.000Z","_content":"<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/bg.jpg\" width=\"80%\" height=\"50%\">\n在手机微信客户端播放视频，有一个问题很头疼；那就是video标签，在安卓手机自动弹出一个view窗口全屏播放；于是乎想着把视频资源转码成base64格式的数据，来放到页面播放；\n<!-- more -->\n## 在转码之前要做下面这些事情\n\n### 安装 ffmpeg \n视频的转码要保证自己电脑安装了ffmpeg，首先是下载它。\n<a href=\"http://ffmpeg.zeranoe.com/builds/\" target=\"_blank\">软件安装下载地址：</a>\n\n![下载地址](http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/1.png)\n\n下载下来解压，可以把目录重命名，找个位置放着，比如像这样：\n\n![下载地址](http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/2.png)\n\n一般来说解压之后还要配置环境变量，不然你在cmd命令行，输入ffmpeg会出现如下情况：\n\n![下载地址](http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/4.png)\n\n环境变量的配置\n复制ffmpeg安装包的bin目录\n\n![下载地址](http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/3.png)\n\n貌似绝大多数，如上图cmd中的问题，都是像下面这样解决；\n\n![下载地址](http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/5.png)\n\n### 使用nodejs第三方模块ffmpeg \nffmpeg模块可以把一个视频，按照配置生成许多一帧一帧的图片和音频mp3文件；\n之前写过一篇<a href=\"https://zhongs.github.io/2017/10/23/%E5%AE%9E%E7%8E%B0%E9%80%90%E5%B8%A7%E5%8A%A8%E7%94%BB%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/\" target=\"_blank\">《实现逐帧动画的几种方式》</a>的文章，这里我就可以把生成的图片转换成base64格式，然后在用image标签播放\n\n这里是我使用ffmpeg转码视频的部分代码：\napp.js 这个是任务入口文件； 进到cmd执行 node app 即可将mp4目录下的文件转换成，我想要的帧动画图片和mp3音频文件，并且分别放在dist目录下；\n\n````javascript\n    var fs = require('fs');\n    var path = require('path');\n    var util = require('util');\n    var ff = require('./lib/ff');\n    var createBase64 = require('./lib/toBase64');\n    var del = require('./lib/delete');\n    var config = {\n        src_path: path.join(__dirname, './mp4/video.mp4'),\n        deleteDirAndFile: path.join(__dirname, './dist/'),\n        save_img_path: path.join(__dirname, './dist/img/'),\n        save_mp3_path: path.join(__dirname, './dist/mp3/')\n    }\n    //删除dist目录\n    del.deleteAllSync(config.deleteDirAndFile);\n    //生成音频文件\n    ff.createMp3(config.src_path, config.save_mp3_path);\n    //生成图片\n    ff.createImg(config.src_path, config.save_img_path, {\n        size: '375x667', //生成的图片尺寸\n        frame_rate:10 //一秒内捕获的帧数\n    }, () => {\n        //图片转base64\n        createBase64({\n            imgPath: config.save_img_path,\n            savePath: path.join(__dirname, './dist/'),\n            fps:10\n        });\n    });\n\n````\n\n./lib/ff.js 这个文件负责创建帧动画图片和音频mp3文件\n\n````javascript\n    var ffmpeg = require('ffmpeg');\n    var del = require('./delete');\n    /**\n     *  src_path 视频路径\n     *  save_path 保存图片的路径\n     */\n    function createImg(src_path, save_path, config, cb) {\n\n        del.createDirSync(save_path);\n\n        try {\n            var process = new ffmpeg(src_path);\n            Object.assign(config, {\n                file_name: 'img'\n            });\n            process.then(function(video) {\n                // Callback mode\n                video.fnExtractFrameToJPG(save_path, config, function(error, files) {\n                    if (!error)\n                        console.log('视频转图片成功！')\n                    cb && cb();\n                });\n            }, function(err) {\n                console.log('Error: ' + err);\n            });\n        } catch (e) {\n            console.log(e.code);\n            console.log(e.msg);\n        }\n    }\n    /**\n     * src_path 视频路径\n     * save_path_name 生成mp3的文件名路径\n     */\n    function createMp3(src_path, save_path_name, cb) {\n        del.createDirSync(save_path_name);\n        try {\n            var process = new ffmpeg(src_path);\n            process.then(function(video) {\n                video.fnExtractSoundToMP3(save_path_name + 'music.mp3', function(error, file) {\n                    if (!error)\n                        console.log('提取视频中的音频成功！')\n                    cb && cb()\n                });\n            }, function(err) {\n                console.log('Error: ' + err);\n            });\n        } catch (e) {\n            console.log(e.code);\n            console.log(e.msg);\n        }\n    }\n    module.exports = {\n        createImg,\n        createMp3\n    }\n````\n\n./lib/delete.js 这个文件有2个方法，用来删除和创建，生成的dist目录\n\n````javascript\n    var path = require('path');\n    var fs = require('fs');\n    function deleteAllSync(path) {\n        //如果文件存在，则返回 true，否则返回 false。\n        if (fs.existsSync(path)) {\n            //返回一个不包括 '.' 和 '..' 的文件名的数组\n            fs.readdirSync(path).forEach(function(file, index) {\n                var curPath = path + \"/\" + file;\n                /**\n                 * fs.statSync(curPath)  返回一个 fs.Stats 实例\n                 * 是目录 递归调用\n                 * 不是目录 删除文件\n                 */\n                if (fs.statSync(curPath).isDirectory()) { // recurse  \n                    deleteAllSync(curPath);\n                } else { // delete file  \n                    fs.unlinkSync(curPath);\n                }\n            });\n            fs.rmdirSync(path);\n        }\n    }\n    //递归创建目录 同步方法\n    function createDirSync(dirname) {\n        // console.log(dirname);\n        if (fs.existsSync(dirname)) {\n            return true;\n        } else {\n            if (createDirSync(path.dirname(dirname))) {\n                fs.mkdirSync(dirname);\n                return true;\n            }\n        }\n    }\n    module.exports = {\n        deleteAllSync,\n        createDirSync\n    }\n````\n\n## 前台页面\n\nindex.html 是前端页面逻辑\n\n````javascript\n    var music = document.getElementById(\"mp3\");\n    var config = {\n        box: document.querySelector('.ani-box')\n    }\n    /**\n     * Audio/Video DOM 事件 在ios上无效；\n     * \n     * ios 要播放音频才能监听到DOM事件，不播放监听不到；\n     * 安卓 不播放就可以，监听DOM 事件；\n     */\n    music.play();\n    music.pause();\n    document.addEventListener(\"WeixinJSBridgeReady\", function() {\n        WeixinJSBridge.invoke('getNetworkType', {}, function(e) {\n            music.play();\n            music.pause();\n        });\n    }, false);\n\n    //创建图片标签\n    function createImg() {\n        var img = document.createElement('img');\n        config.box.appendChild(img);\n        return img;\n    }\n\n    //定时器来播放图片\n    function run(imgArr, fn) {\n        var img = createImg();\n        var n = 0;\n        var timer = setInterval(function() {\n            img.src = imgArr[n];\n            n++;\n            if (n == imgArr.length) {\n                n = 0;\n                fn && fn(timer);\n            }\n        }, 1000 / imgData.fps);\n    }\n\n    //动态加载js文件\n    function pLoadJs(url) {\n        return new Promise(function(resolve, reject) {\n            var script = document.createElement('script');　　　　\n            script.type = 'text/javascript';　　　　\n            script.async = 'async';　　　　\n            script.src = url;　　　　\n            document.body.appendChild(script);　　　　\n            if (script.readyState) { //IE\n                script.onreadystatechange = function() {　　　　　　　　\n                    if (script.readyState == 'complete' || script.readyState == 'loaded') {　　　　　　　　　　\n                        script.onreadystatechange = null;　　　　　　　　　　\n                        resolve('js加载完成');　　\n                    }　　　　　　\n                }　　　　\n            } else { //非IE\n                script.onload = function() {\n                    resolve('js加载完成');\n                }　　　　\n            }\n        });\n    }\n\n    function pLoadMp3(music) {\n        return new Promise(function(resolve, reject) {\n            music.addEventListener('canplay', function() {\n                //数据已经可以播放(当前位置已经加载) 但没有数据能播放下一帧的内容\n                if (music.readyState >= 2) {\n                    resolve('music加载完成');\n                }\n            }, false);\n        });\n    }\n\n    //当音频和视频同时加载ok，在播放\n    function playViode() {\n        //音频\n        music.play();\n        document.addEventListener(\"WeixinJSBridgeReady\", function() {\n            WeixinJSBridge.invoke('getNetworkType', {}, function(e) {\n                music.play();\n            });\n        }, false);\n\n        //图片\n        run(imgData.key, function(timer) {\n            clearInterval(timer);\n            alert('播完了！')\n        });\n    }\n\n    Promise.all([\n        pLoadJs('./dist/base64.js'),\n        pLoadMp3(music)\n    ]).then(function(posts) {\n        console.log('资源都加载好了！');\n        alert('资源都加载好了！');\n        playViode();\n    }).catch(function(reason) {\n        alert(JSON.stringify(reason));\n    })\n````\n\nvideo.pm4视频有770KB，转码后base64.js有512KB，音频文件有157KB\n最后静态资源都上传到了cdn上面\n\n* <a href=\"http://1251097942.cdn.myqcloud.com/1251097942/cd/zs/mp4-to-base64/index.html\" target=\"_blank\">页面效果预览</a>\n\n* <a href=\"https://github.com/zhongs/mp4-to-base64\" target=\"_blank\">项目源码地址</a>\n\n## 总结\n* 这种方式能解决安卓手机全屏播放问题\n* 转码文件资源很大，第一次进页面比较慢\n* 视频画面质量有所下降","source":"_posts/视频转码播放实践.md","raw":"---\ntitle: 视频转码播放实践\ndate: 2017-11-09 16:25:16\ntags: 全屏播放\n---\n<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/bg.jpg\" width=\"80%\" height=\"50%\">\n在手机微信客户端播放视频，有一个问题很头疼；那就是video标签，在安卓手机自动弹出一个view窗口全屏播放；于是乎想着把视频资源转码成base64格式的数据，来放到页面播放；\n<!-- more -->\n## 在转码之前要做下面这些事情\n\n### 安装 ffmpeg \n视频的转码要保证自己电脑安装了ffmpeg，首先是下载它。\n<a href=\"http://ffmpeg.zeranoe.com/builds/\" target=\"_blank\">软件安装下载地址：</a>\n\n![下载地址](http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/1.png)\n\n下载下来解压，可以把目录重命名，找个位置放着，比如像这样：\n\n![下载地址](http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/2.png)\n\n一般来说解压之后还要配置环境变量，不然你在cmd命令行，输入ffmpeg会出现如下情况：\n\n![下载地址](http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/4.png)\n\n环境变量的配置\n复制ffmpeg安装包的bin目录\n\n![下载地址](http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/3.png)\n\n貌似绝大多数，如上图cmd中的问题，都是像下面这样解决；\n\n![下载地址](http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/5.png)\n\n### 使用nodejs第三方模块ffmpeg \nffmpeg模块可以把一个视频，按照配置生成许多一帧一帧的图片和音频mp3文件；\n之前写过一篇<a href=\"https://zhongs.github.io/2017/10/23/%E5%AE%9E%E7%8E%B0%E9%80%90%E5%B8%A7%E5%8A%A8%E7%94%BB%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/\" target=\"_blank\">《实现逐帧动画的几种方式》</a>的文章，这里我就可以把生成的图片转换成base64格式，然后在用image标签播放\n\n这里是我使用ffmpeg转码视频的部分代码：\napp.js 这个是任务入口文件； 进到cmd执行 node app 即可将mp4目录下的文件转换成，我想要的帧动画图片和mp3音频文件，并且分别放在dist目录下；\n\n````javascript\n    var fs = require('fs');\n    var path = require('path');\n    var util = require('util');\n    var ff = require('./lib/ff');\n    var createBase64 = require('./lib/toBase64');\n    var del = require('./lib/delete');\n    var config = {\n        src_path: path.join(__dirname, './mp4/video.mp4'),\n        deleteDirAndFile: path.join(__dirname, './dist/'),\n        save_img_path: path.join(__dirname, './dist/img/'),\n        save_mp3_path: path.join(__dirname, './dist/mp3/')\n    }\n    //删除dist目录\n    del.deleteAllSync(config.deleteDirAndFile);\n    //生成音频文件\n    ff.createMp3(config.src_path, config.save_mp3_path);\n    //生成图片\n    ff.createImg(config.src_path, config.save_img_path, {\n        size: '375x667', //生成的图片尺寸\n        frame_rate:10 //一秒内捕获的帧数\n    }, () => {\n        //图片转base64\n        createBase64({\n            imgPath: config.save_img_path,\n            savePath: path.join(__dirname, './dist/'),\n            fps:10\n        });\n    });\n\n````\n\n./lib/ff.js 这个文件负责创建帧动画图片和音频mp3文件\n\n````javascript\n    var ffmpeg = require('ffmpeg');\n    var del = require('./delete');\n    /**\n     *  src_path 视频路径\n     *  save_path 保存图片的路径\n     */\n    function createImg(src_path, save_path, config, cb) {\n\n        del.createDirSync(save_path);\n\n        try {\n            var process = new ffmpeg(src_path);\n            Object.assign(config, {\n                file_name: 'img'\n            });\n            process.then(function(video) {\n                // Callback mode\n                video.fnExtractFrameToJPG(save_path, config, function(error, files) {\n                    if (!error)\n                        console.log('视频转图片成功！')\n                    cb && cb();\n                });\n            }, function(err) {\n                console.log('Error: ' + err);\n            });\n        } catch (e) {\n            console.log(e.code);\n            console.log(e.msg);\n        }\n    }\n    /**\n     * src_path 视频路径\n     * save_path_name 生成mp3的文件名路径\n     */\n    function createMp3(src_path, save_path_name, cb) {\n        del.createDirSync(save_path_name);\n        try {\n            var process = new ffmpeg(src_path);\n            process.then(function(video) {\n                video.fnExtractSoundToMP3(save_path_name + 'music.mp3', function(error, file) {\n                    if (!error)\n                        console.log('提取视频中的音频成功！')\n                    cb && cb()\n                });\n            }, function(err) {\n                console.log('Error: ' + err);\n            });\n        } catch (e) {\n            console.log(e.code);\n            console.log(e.msg);\n        }\n    }\n    module.exports = {\n        createImg,\n        createMp3\n    }\n````\n\n./lib/delete.js 这个文件有2个方法，用来删除和创建，生成的dist目录\n\n````javascript\n    var path = require('path');\n    var fs = require('fs');\n    function deleteAllSync(path) {\n        //如果文件存在，则返回 true，否则返回 false。\n        if (fs.existsSync(path)) {\n            //返回一个不包括 '.' 和 '..' 的文件名的数组\n            fs.readdirSync(path).forEach(function(file, index) {\n                var curPath = path + \"/\" + file;\n                /**\n                 * fs.statSync(curPath)  返回一个 fs.Stats 实例\n                 * 是目录 递归调用\n                 * 不是目录 删除文件\n                 */\n                if (fs.statSync(curPath).isDirectory()) { // recurse  \n                    deleteAllSync(curPath);\n                } else { // delete file  \n                    fs.unlinkSync(curPath);\n                }\n            });\n            fs.rmdirSync(path);\n        }\n    }\n    //递归创建目录 同步方法\n    function createDirSync(dirname) {\n        // console.log(dirname);\n        if (fs.existsSync(dirname)) {\n            return true;\n        } else {\n            if (createDirSync(path.dirname(dirname))) {\n                fs.mkdirSync(dirname);\n                return true;\n            }\n        }\n    }\n    module.exports = {\n        deleteAllSync,\n        createDirSync\n    }\n````\n\n## 前台页面\n\nindex.html 是前端页面逻辑\n\n````javascript\n    var music = document.getElementById(\"mp3\");\n    var config = {\n        box: document.querySelector('.ani-box')\n    }\n    /**\n     * Audio/Video DOM 事件 在ios上无效；\n     * \n     * ios 要播放音频才能监听到DOM事件，不播放监听不到；\n     * 安卓 不播放就可以，监听DOM 事件；\n     */\n    music.play();\n    music.pause();\n    document.addEventListener(\"WeixinJSBridgeReady\", function() {\n        WeixinJSBridge.invoke('getNetworkType', {}, function(e) {\n            music.play();\n            music.pause();\n        });\n    }, false);\n\n    //创建图片标签\n    function createImg() {\n        var img = document.createElement('img');\n        config.box.appendChild(img);\n        return img;\n    }\n\n    //定时器来播放图片\n    function run(imgArr, fn) {\n        var img = createImg();\n        var n = 0;\n        var timer = setInterval(function() {\n            img.src = imgArr[n];\n            n++;\n            if (n == imgArr.length) {\n                n = 0;\n                fn && fn(timer);\n            }\n        }, 1000 / imgData.fps);\n    }\n\n    //动态加载js文件\n    function pLoadJs(url) {\n        return new Promise(function(resolve, reject) {\n            var script = document.createElement('script');　　　　\n            script.type = 'text/javascript';　　　　\n            script.async = 'async';　　　　\n            script.src = url;　　　　\n            document.body.appendChild(script);　　　　\n            if (script.readyState) { //IE\n                script.onreadystatechange = function() {　　　　　　　　\n                    if (script.readyState == 'complete' || script.readyState == 'loaded') {　　　　　　　　　　\n                        script.onreadystatechange = null;　　　　　　　　　　\n                        resolve('js加载完成');　　\n                    }　　　　　　\n                }　　　　\n            } else { //非IE\n                script.onload = function() {\n                    resolve('js加载完成');\n                }　　　　\n            }\n        });\n    }\n\n    function pLoadMp3(music) {\n        return new Promise(function(resolve, reject) {\n            music.addEventListener('canplay', function() {\n                //数据已经可以播放(当前位置已经加载) 但没有数据能播放下一帧的内容\n                if (music.readyState >= 2) {\n                    resolve('music加载完成');\n                }\n            }, false);\n        });\n    }\n\n    //当音频和视频同时加载ok，在播放\n    function playViode() {\n        //音频\n        music.play();\n        document.addEventListener(\"WeixinJSBridgeReady\", function() {\n            WeixinJSBridge.invoke('getNetworkType', {}, function(e) {\n                music.play();\n            });\n        }, false);\n\n        //图片\n        run(imgData.key, function(timer) {\n            clearInterval(timer);\n            alert('播完了！')\n        });\n    }\n\n    Promise.all([\n        pLoadJs('./dist/base64.js'),\n        pLoadMp3(music)\n    ]).then(function(posts) {\n        console.log('资源都加载好了！');\n        alert('资源都加载好了！');\n        playViode();\n    }).catch(function(reason) {\n        alert(JSON.stringify(reason));\n    })\n````\n\nvideo.pm4视频有770KB，转码后base64.js有512KB，音频文件有157KB\n最后静态资源都上传到了cdn上面\n\n* <a href=\"http://1251097942.cdn.myqcloud.com/1251097942/cd/zs/mp4-to-base64/index.html\" target=\"_blank\">页面效果预览</a>\n\n* <a href=\"https://github.com/zhongs/mp4-to-base64\" target=\"_blank\">项目源码地址</a>\n\n## 总结\n* 这种方式能解决安卓手机全屏播放问题\n* 转码文件资源很大，第一次进页面比较慢\n* 视频画面质量有所下降","slug":"视频转码播放实践","published":1,"updated":"2019-03-21T04:23:24.672Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckknbqwg7000b10udi7coadv7","content":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/bg.jpg\" width=\"80%\" height=\"50%\"><br>在手机微信客户端播放视频，有一个问题很头疼；那就是video标签，在安卓手机自动弹出一个view窗口全屏播放；于是乎想着把视频资源转码成base64格式的数据，来放到页面播放；<br><a id=\"more\"></a></p>\n<h2 id=\"在转码之前要做下面这些事情\"><a href=\"#在转码之前要做下面这些事情\" class=\"headerlink\" title=\"在转码之前要做下面这些事情\"></a>在转码之前要做下面这些事情</h2><h3 id=\"安装-ffmpeg\"><a href=\"#安装-ffmpeg\" class=\"headerlink\" title=\"安装 ffmpeg\"></a>安装 ffmpeg</h3><p>视频的转码要保证自己电脑安装了ffmpeg，首先是下载它。<br><a href=\"http://ffmpeg.zeranoe.com/builds/\" target=\"_blank\">软件安装下载地址：</a></p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/1.png\" alt=\"下载地址\"></p>\n<p>下载下来解压，可以把目录重命名，找个位置放着，比如像这样：</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/2.png\" alt=\"下载地址\"></p>\n<p>一般来说解压之后还要配置环境变量，不然你在cmd命令行，输入ffmpeg会出现如下情况：</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/4.png\" alt=\"下载地址\"></p>\n<p>环境变量的配置<br>复制ffmpeg安装包的bin目录</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/3.png\" alt=\"下载地址\"></p>\n<p>貌似绝大多数，如上图cmd中的问题，都是像下面这样解决；</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/5.png\" alt=\"下载地址\"></p>\n<h3 id=\"使用nodejs第三方模块ffmpeg\"><a href=\"#使用nodejs第三方模块ffmpeg\" class=\"headerlink\" title=\"使用nodejs第三方模块ffmpeg\"></a>使用nodejs第三方模块ffmpeg</h3><p>ffmpeg模块可以把一个视频，按照配置生成许多一帧一帧的图片和音频mp3文件；<br>之前写过一篇<a href=\"https://zhongs.github.io/2017/10/23/%E5%AE%9E%E7%8E%B0%E9%80%90%E5%B8%A7%E5%8A%A8%E7%94%BB%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/\" target=\"_blank\">《实现逐帧动画的几种方式》</a>的文章，这里我就可以把生成的图片转换成base64格式，然后在用image标签播放</p>\n<p>这里是我使用ffmpeg转码视频的部分代码：<br>app.js 这个是任务入口文件； 进到cmd执行 node app 即可将mp4目录下的文件转换成，我想要的帧动画图片和mp3音频文件，并且分别放在dist目录下；</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> util = <span class=\"built_in\">require</span>(<span class=\"string\">'util'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ff = <span class=\"built_in\">require</span>(<span class=\"string\">'./lib/ff'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> createBase64 = <span class=\"built_in\">require</span>(<span class=\"string\">'./lib/toBase64'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> del = <span class=\"built_in\">require</span>(<span class=\"string\">'./lib/delete'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> config = &#123;</span><br><span class=\"line\">    src_path: path.join(__dirname, <span class=\"string\">'./mp4/video.mp4'</span>),</span><br><span class=\"line\">    deleteDirAndFile: path.join(__dirname, <span class=\"string\">'./dist/'</span>),</span><br><span class=\"line\">    save_img_path: path.join(__dirname, <span class=\"string\">'./dist/img/'</span>),</span><br><span class=\"line\">    save_mp3_path: path.join(__dirname, <span class=\"string\">'./dist/mp3/'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//删除dist目录</span></span><br><span class=\"line\">del.deleteAllSync(config.deleteDirAndFile);</span><br><span class=\"line\"><span class=\"comment\">//生成音频文件</span></span><br><span class=\"line\">ff.createMp3(config.src_path, config.save_mp3_path);</span><br><span class=\"line\"><span class=\"comment\">//生成图片</span></span><br><span class=\"line\">ff.createImg(config.src_path, config.save_img_path, &#123;</span><br><span class=\"line\">    size: <span class=\"string\">'375x667'</span>, <span class=\"comment\">//生成的图片尺寸</span></span><br><span class=\"line\">    frame_rate:<span class=\"number\">10</span> <span class=\"comment\">//一秒内捕获的帧数</span></span><br><span class=\"line\">&#125;, () =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//图片转base64</span></span><br><span class=\"line\">    createBase64(&#123;</span><br><span class=\"line\">        imgPath: config.save_img_path,</span><br><span class=\"line\">        savePath: path.join(__dirname, <span class=\"string\">'./dist/'</span>),</span><br><span class=\"line\">        fps:<span class=\"number\">10</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>./lib/ff.js 这个文件负责创建帧动画图片和音频mp3文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ffmpeg = <span class=\"built_in\">require</span>(<span class=\"string\">'ffmpeg'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> del = <span class=\"built_in\">require</span>(<span class=\"string\">'./delete'</span>);</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  src_path 视频路径</span></span><br><span class=\"line\"><span class=\"comment\"> *  save_path 保存图片的路径</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createImg</span>(<span class=\"params\">src_path, save_path, config, cb</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    del.createDirSync(save_path);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> process = <span class=\"keyword\">new</span> ffmpeg(src_path);</span><br><span class=\"line\">        <span class=\"built_in\">Object</span>.assign(config, &#123;</span><br><span class=\"line\">            file_name: <span class=\"string\">'img'</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        process.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">video</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// Callback mode</span></span><br><span class=\"line\">            video.fnExtractFrameToJPG(save_path, config, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error, files</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!error)</span><br><span class=\"line\">                    <span class=\"built_in\">console</span>.log(<span class=\"string\">'视频转图片成功！'</span>)</span><br><span class=\"line\">                cb &amp;&amp; cb();</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Error: '</span> + err);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(e.code);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(e.msg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * src_path 视频路径</span></span><br><span class=\"line\"><span class=\"comment\"> * save_path_name 生成mp3的文件名路径</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMp3</span>(<span class=\"params\">src_path, save_path_name, cb</span>) </span>&#123;</span><br><span class=\"line\">    del.createDirSync(save_path_name);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> process = <span class=\"keyword\">new</span> ffmpeg(src_path);</span><br><span class=\"line\">        process.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">video</span>) </span>&#123;</span><br><span class=\"line\">            video.fnExtractSoundToMP3(save_path_name + <span class=\"string\">'music.mp3'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error, file</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!error)</span><br><span class=\"line\">                    <span class=\"built_in\">console</span>.log(<span class=\"string\">'提取视频中的音频成功！'</span>)</span><br><span class=\"line\">                cb &amp;&amp; cb()</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Error: '</span> + err);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(e.code);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(e.msg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    createImg,</span><br><span class=\"line\">    createMp3</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>./lib/delete.js 这个文件有2个方法，用来删除和创建，生成的dist目录</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deleteAllSync</span>(<span class=\"params\">path</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//如果文件存在，则返回 true，否则返回 false。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fs.existsSync(path)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//返回一个不包括 '.' 和 '..' 的文件名的数组</span></span><br><span class=\"line\">        fs.readdirSync(path).forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">file, index</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> curPath = path + <span class=\"string\">\"/\"</span> + file;</span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * fs.statSync(curPath)  返回一个 fs.Stats 实例</span></span><br><span class=\"line\"><span class=\"comment\">             * 是目录 递归调用</span></span><br><span class=\"line\"><span class=\"comment\">             * 不是目录 删除文件</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (fs.statSync(curPath).isDirectory()) &#123; <span class=\"comment\">// recurse  </span></span><br><span class=\"line\">                deleteAllSync(curPath);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// delete file  </span></span><br><span class=\"line\">                fs.unlinkSync(curPath);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        fs.rmdirSync(path);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//递归创建目录 同步方法</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createDirSync</span>(<span class=\"params\">dirname</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// console.log(dirname);</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fs.existsSync(dirname)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (createDirSync(path.dirname(dirname))) &#123;</span><br><span class=\"line\">            fs.mkdirSync(dirname);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    deleteAllSync,</span><br><span class=\"line\">    createDirSync</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"前台页面\"><a href=\"#前台页面\" class=\"headerlink\" title=\"前台页面\"></a>前台页面</h2><p>index.html 是前端页面逻辑</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> music = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"mp3\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> config = &#123;</span><br><span class=\"line\">    box: <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.ani-box'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Audio/Video DOM 事件 在ios上无效；</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * ios 要播放音频才能监听到DOM事件，不播放监听不到；</span></span><br><span class=\"line\"><span class=\"comment\"> * 安卓 不播放就可以，监听DOM 事件；</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">music.play();</span><br><span class=\"line\">music.pause();</span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">\"WeixinJSBridgeReady\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    WeixinJSBridge.invoke(<span class=\"string\">'getNetworkType'</span>, &#123;&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        music.play();</span><br><span class=\"line\">        music.pause();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//创建图片标签</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createImg</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">    config.box.appendChild(img);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> img;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//定时器来播放图片</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">run</span>(<span class=\"params\">imgArr, fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> img = createImg();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timer = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        img.src = imgArr[n];</span><br><span class=\"line\">        n++;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (n == imgArr.length) &#123;</span><br><span class=\"line\">            n = <span class=\"number\">0</span>;</span><br><span class=\"line\">            fn &amp;&amp; fn(timer);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span> / imgData.fps);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//动态加载js文件</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pLoadJs</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> script = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'script'</span>);　　　　</span><br><span class=\"line\">        script.type = <span class=\"string\">'text/javascript'</span>;　　　　</span><br><span class=\"line\">        script.async = <span class=\"string\">'async'</span>;　　　　</span><br><span class=\"line\">        script.src = url;　　　　</span><br><span class=\"line\">        <span class=\"built_in\">document</span>.body.appendChild(script);　　　　</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (script.readyState) &#123; <span class=\"comment\">//IE</span></span><br><span class=\"line\">            script.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;　　　　　　　　</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (script.readyState == <span class=\"string\">'complete'</span> || script.readyState == <span class=\"string\">'loaded'</span>) &#123;　　　　　　　　　　</span><br><span class=\"line\">                    script.onreadystatechange = <span class=\"literal\">null</span>;　　　　　　　　　　</span><br><span class=\"line\">                    resolve(<span class=\"string\">'js加载完成'</span>);　　</span><br><span class=\"line\">                &#125;　　　　　　</span><br><span class=\"line\">            &#125;　　　　</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">//非IE</span></span><br><span class=\"line\">            script.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                resolve(<span class=\"string\">'js加载完成'</span>);</span><br><span class=\"line\">            &#125;　　　　</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pLoadMp3</span>(<span class=\"params\">music</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">        music.addEventListener(<span class=\"string\">'canplay'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//数据已经可以播放(当前位置已经加载) 但没有数据能播放下一帧的内容</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (music.readyState &gt;= <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">                resolve(<span class=\"string\">'music加载完成'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//当音频和视频同时加载ok，在播放</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playViode</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//音频</span></span><br><span class=\"line\">    music.play();</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">\"WeixinJSBridgeReady\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        WeixinJSBridge.invoke(<span class=\"string\">'getNetworkType'</span>, &#123;&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">            music.play();</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//图片</span></span><br><span class=\"line\">    run(imgData.key, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">timer</span>) </span>&#123;</span><br><span class=\"line\">        clearInterval(timer);</span><br><span class=\"line\">        alert(<span class=\"string\">'播完了！'</span>)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.all([</span><br><span class=\"line\">    pLoadJs(<span class=\"string\">'./dist/base64.js'</span>),</span><br><span class=\"line\">    pLoadMp3(music)</span><br><span class=\"line\">]).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">posts</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'资源都加载好了！'</span>);</span><br><span class=\"line\">    alert(<span class=\"string\">'资源都加载好了！'</span>);</span><br><span class=\"line\">    playViode();</span><br><span class=\"line\">&#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"built_in\">JSON</span>.stringify(reason));</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>video.pm4视频有770KB，转码后base64.js有512KB，音频文件有157KB<br>最后静态资源都上传到了cdn上面</p>\n<ul>\n<li><p><a href=\"http://1251097942.cdn.myqcloud.com/1251097942/cd/zs/mp4-to-base64/index.html\" target=\"_blank\">页面效果预览</a></p>\n</li>\n<li><p><a href=\"https://github.com/zhongs/mp4-to-base64\" target=\"_blank\">项目源码地址</a></p>\n</li>\n</ul>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li>这种方式能解决安卓手机全屏播放问题</li>\n<li>转码文件资源很大，第一次进页面比较慢</li>\n<li>视频画面质量有所下降</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/bg.jpg\" width=\"80%\" height=\"50%\"><br>在手机微信客户端播放视频，有一个问题很头疼；那就是video标签，在安卓手机自动弹出一个view窗口全屏播放；于是乎想着把视频资源转码成base64格式的数据，来放到页面播放；<br>","more":"</p>\n<h2 id=\"在转码之前要做下面这些事情\"><a href=\"#在转码之前要做下面这些事情\" class=\"headerlink\" title=\"在转码之前要做下面这些事情\"></a>在转码之前要做下面这些事情</h2><h3 id=\"安装-ffmpeg\"><a href=\"#安装-ffmpeg\" class=\"headerlink\" title=\"安装 ffmpeg\"></a>安装 ffmpeg</h3><p>视频的转码要保证自己电脑安装了ffmpeg，首先是下载它。<br><a href=\"http://ffmpeg.zeranoe.com/builds/\" target=\"_blank\">软件安装下载地址：</a></p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/1.png\" alt=\"下载地址\"></p>\n<p>下载下来解压，可以把目录重命名，找个位置放着，比如像这样：</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/2.png\" alt=\"下载地址\"></p>\n<p>一般来说解压之后还要配置环境变量，不然你在cmd命令行，输入ffmpeg会出现如下情况：</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/4.png\" alt=\"下载地址\"></p>\n<p>环境变量的配置<br>复制ffmpeg安装包的bin目录</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/3.png\" alt=\"下载地址\"></p>\n<p>貌似绝大多数，如上图cmd中的问题，都是像下面这样解决；</p>\n<p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/ffmpeg/5.png\" alt=\"下载地址\"></p>\n<h3 id=\"使用nodejs第三方模块ffmpeg\"><a href=\"#使用nodejs第三方模块ffmpeg\" class=\"headerlink\" title=\"使用nodejs第三方模块ffmpeg\"></a>使用nodejs第三方模块ffmpeg</h3><p>ffmpeg模块可以把一个视频，按照配置生成许多一帧一帧的图片和音频mp3文件；<br>之前写过一篇<a href=\"https://zhongs.github.io/2017/10/23/%E5%AE%9E%E7%8E%B0%E9%80%90%E5%B8%A7%E5%8A%A8%E7%94%BB%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/\" target=\"_blank\">《实现逐帧动画的几种方式》</a>的文章，这里我就可以把生成的图片转换成base64格式，然后在用image标签播放</p>\n<p>这里是我使用ffmpeg转码视频的部分代码：<br>app.js 这个是任务入口文件； 进到cmd执行 node app 即可将mp4目录下的文件转换成，我想要的帧动画图片和mp3音频文件，并且分别放在dist目录下；</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> util = <span class=\"built_in\">require</span>(<span class=\"string\">'util'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ff = <span class=\"built_in\">require</span>(<span class=\"string\">'./lib/ff'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> createBase64 = <span class=\"built_in\">require</span>(<span class=\"string\">'./lib/toBase64'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> del = <span class=\"built_in\">require</span>(<span class=\"string\">'./lib/delete'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> config = &#123;</span><br><span class=\"line\">    src_path: path.join(__dirname, <span class=\"string\">'./mp4/video.mp4'</span>),</span><br><span class=\"line\">    deleteDirAndFile: path.join(__dirname, <span class=\"string\">'./dist/'</span>),</span><br><span class=\"line\">    save_img_path: path.join(__dirname, <span class=\"string\">'./dist/img/'</span>),</span><br><span class=\"line\">    save_mp3_path: path.join(__dirname, <span class=\"string\">'./dist/mp3/'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//删除dist目录</span></span><br><span class=\"line\">del.deleteAllSync(config.deleteDirAndFile);</span><br><span class=\"line\"><span class=\"comment\">//生成音频文件</span></span><br><span class=\"line\">ff.createMp3(config.src_path, config.save_mp3_path);</span><br><span class=\"line\"><span class=\"comment\">//生成图片</span></span><br><span class=\"line\">ff.createImg(config.src_path, config.save_img_path, &#123;</span><br><span class=\"line\">    size: <span class=\"string\">'375x667'</span>, <span class=\"comment\">//生成的图片尺寸</span></span><br><span class=\"line\">    frame_rate:<span class=\"number\">10</span> <span class=\"comment\">//一秒内捕获的帧数</span></span><br><span class=\"line\">&#125;, () =&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//图片转base64</span></span><br><span class=\"line\">    createBase64(&#123;</span><br><span class=\"line\">        imgPath: config.save_img_path,</span><br><span class=\"line\">        savePath: path.join(__dirname, <span class=\"string\">'./dist/'</span>),</span><br><span class=\"line\">        fps:<span class=\"number\">10</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>./lib/ff.js 这个文件负责创建帧动画图片和音频mp3文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ffmpeg = <span class=\"built_in\">require</span>(<span class=\"string\">'ffmpeg'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> del = <span class=\"built_in\">require</span>(<span class=\"string\">'./delete'</span>);</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  src_path 视频路径</span></span><br><span class=\"line\"><span class=\"comment\"> *  save_path 保存图片的路径</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createImg</span>(<span class=\"params\">src_path, save_path, config, cb</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    del.createDirSync(save_path);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> process = <span class=\"keyword\">new</span> ffmpeg(src_path);</span><br><span class=\"line\">        <span class=\"built_in\">Object</span>.assign(config, &#123;</span><br><span class=\"line\">            file_name: <span class=\"string\">'img'</span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        process.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">video</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// Callback mode</span></span><br><span class=\"line\">            video.fnExtractFrameToJPG(save_path, config, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error, files</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!error)</span><br><span class=\"line\">                    <span class=\"built_in\">console</span>.log(<span class=\"string\">'视频转图片成功！'</span>)</span><br><span class=\"line\">                cb &amp;&amp; cb();</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Error: '</span> + err);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(e.code);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(e.msg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * src_path 视频路径</span></span><br><span class=\"line\"><span class=\"comment\"> * save_path_name 生成mp3的文件名路径</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createMp3</span>(<span class=\"params\">src_path, save_path_name, cb</span>) </span>&#123;</span><br><span class=\"line\">    del.createDirSync(save_path_name);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> process = <span class=\"keyword\">new</span> ffmpeg(src_path);</span><br><span class=\"line\">        process.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">video</span>) </span>&#123;</span><br><span class=\"line\">            video.fnExtractSoundToMP3(save_path_name + <span class=\"string\">'music.mp3'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error, file</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!error)</span><br><span class=\"line\">                    <span class=\"built_in\">console</span>.log(<span class=\"string\">'提取视频中的音频成功！'</span>)</span><br><span class=\"line\">                cb &amp;&amp; cb()</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Error: '</span> + err);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(e.code);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(e.msg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    createImg,</span><br><span class=\"line\">    createMp3</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>./lib/delete.js 这个文件有2个方法，用来删除和创建，生成的dist目录</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">deleteAllSync</span>(<span class=\"params\">path</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//如果文件存在，则返回 true，否则返回 false。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fs.existsSync(path)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//返回一个不包括 '.' 和 '..' 的文件名的数组</span></span><br><span class=\"line\">        fs.readdirSync(path).forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">file, index</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> curPath = path + <span class=\"string\">\"/\"</span> + file;</span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * fs.statSync(curPath)  返回一个 fs.Stats 实例</span></span><br><span class=\"line\"><span class=\"comment\">             * 是目录 递归调用</span></span><br><span class=\"line\"><span class=\"comment\">             * 不是目录 删除文件</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (fs.statSync(curPath).isDirectory()) &#123; <span class=\"comment\">// recurse  </span></span><br><span class=\"line\">                deleteAllSync(curPath);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// delete file  </span></span><br><span class=\"line\">                fs.unlinkSync(curPath);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        fs.rmdirSync(path);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//递归创建目录 同步方法</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createDirSync</span>(<span class=\"params\">dirname</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// console.log(dirname);</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (fs.existsSync(dirname)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (createDirSync(path.dirname(dirname))) &#123;</span><br><span class=\"line\">            fs.mkdirSync(dirname);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    deleteAllSync,</span><br><span class=\"line\">    createDirSync</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"前台页面\"><a href=\"#前台页面\" class=\"headerlink\" title=\"前台页面\"></a>前台页面</h2><p>index.html 是前端页面逻辑</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> music = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"mp3\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> config = &#123;</span><br><span class=\"line\">    box: <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'.ani-box'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Audio/Video DOM 事件 在ios上无效；</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * ios 要播放音频才能监听到DOM事件，不播放监听不到；</span></span><br><span class=\"line\"><span class=\"comment\"> * 安卓 不播放就可以，监听DOM 事件；</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">music.play();</span><br><span class=\"line\">music.pause();</span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">\"WeixinJSBridgeReady\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    WeixinJSBridge.invoke(<span class=\"string\">'getNetworkType'</span>, &#123;&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        music.play();</span><br><span class=\"line\">        music.pause();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//创建图片标签</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createImg</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">    config.box.appendChild(img);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> img;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//定时器来播放图片</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">run</span>(<span class=\"params\">imgArr, fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> img = createImg();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timer = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        img.src = imgArr[n];</span><br><span class=\"line\">        n++;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (n == imgArr.length) &#123;</span><br><span class=\"line\">            n = <span class=\"number\">0</span>;</span><br><span class=\"line\">            fn &amp;&amp; fn(timer);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span> / imgData.fps);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//动态加载js文件</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pLoadJs</span>(<span class=\"params\">url</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> script = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'script'</span>);　　　　</span><br><span class=\"line\">        script.type = <span class=\"string\">'text/javascript'</span>;　　　　</span><br><span class=\"line\">        script.async = <span class=\"string\">'async'</span>;　　　　</span><br><span class=\"line\">        script.src = url;　　　　</span><br><span class=\"line\">        <span class=\"built_in\">document</span>.body.appendChild(script);　　　　</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (script.readyState) &#123; <span class=\"comment\">//IE</span></span><br><span class=\"line\">            script.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;　　　　　　　　</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (script.readyState == <span class=\"string\">'complete'</span> || script.readyState == <span class=\"string\">'loaded'</span>) &#123;　　　　　　　　　　</span><br><span class=\"line\">                    script.onreadystatechange = <span class=\"literal\">null</span>;　　　　　　　　　　</span><br><span class=\"line\">                    resolve(<span class=\"string\">'js加载完成'</span>);　　</span><br><span class=\"line\">                &#125;　　　　　　</span><br><span class=\"line\">            &#125;　　　　</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">//非IE</span></span><br><span class=\"line\">            script.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                resolve(<span class=\"string\">'js加载完成'</span>);</span><br><span class=\"line\">            &#125;　　　　</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">pLoadMp3</span>(<span class=\"params\">music</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">        music.addEventListener(<span class=\"string\">'canplay'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//数据已经可以播放(当前位置已经加载) 但没有数据能播放下一帧的内容</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (music.readyState &gt;= <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">                resolve(<span class=\"string\">'music加载完成'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//当音频和视频同时加载ok，在播放</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">playViode</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//音频</span></span><br><span class=\"line\">    music.play();</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">\"WeixinJSBridgeReady\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        WeixinJSBridge.invoke(<span class=\"string\">'getNetworkType'</span>, &#123;&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">            music.play();</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//图片</span></span><br><span class=\"line\">    run(imgData.key, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">timer</span>) </span>&#123;</span><br><span class=\"line\">        clearInterval(timer);</span><br><span class=\"line\">        alert(<span class=\"string\">'播完了！'</span>)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.all([</span><br><span class=\"line\">    pLoadJs(<span class=\"string\">'./dist/base64.js'</span>),</span><br><span class=\"line\">    pLoadMp3(music)</span><br><span class=\"line\">]).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">posts</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'资源都加载好了！'</span>);</span><br><span class=\"line\">    alert(<span class=\"string\">'资源都加载好了！'</span>);</span><br><span class=\"line\">    playViode();</span><br><span class=\"line\">&#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    alert(<span class=\"built_in\">JSON</span>.stringify(reason));</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>video.pm4视频有770KB，转码后base64.js有512KB，音频文件有157KB<br>最后静态资源都上传到了cdn上面</p>\n<ul>\n<li><p><a href=\"http://1251097942.cdn.myqcloud.com/1251097942/cd/zs/mp4-to-base64/index.html\" target=\"_blank\">页面效果预览</a></p>\n</li>\n<li><p><a href=\"https://github.com/zhongs/mp4-to-base64\" target=\"_blank\">项目源码地址</a></p>\n</li>\n</ul>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><ul>\n<li>这种方式能解决安卓手机全屏播放问题</li>\n<li>转码文件资源很大，第一次进页面比较慢</li>\n<li>视频画面质量有所下降</li>\n</ul>"},{"title":"从单行滚动开始","date":"2017-10-29T07:06:21.000Z","_content":"<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/metal-text.jpg\" width=\"80%\" height=\"50%\">\n这种效果在网页中很常见，实际开发中也经常碰到这样的需求，自己也尝试写了一个这样的效果，下面是我的一个实现方案；\n<!-- more -->\n![demo效果](http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/ezgif-4-1fa54824c2.gif)\n\n## 分析过程\n\n### 初始状态\n![初始状态](http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc1.png)\n* 假设只有一条滚动数据的时候。最开始，我将这条数据定位到最右边，并且设置它的transform:translate3d(100%,0,0); 这是每条数据的初始状态；\n\n### 运动状态\n![下一条数据运动时机](http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc2.png)\n* 通过改变translateX的值，让这条数据移动起来；可以观察到当translate3d(0px,0px,0px)的时候，刚好整条数据移动到屏幕上来，也正好是下一条数据的运动时机；\n\n### 结束状态\n![移除数据](http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc4.png)\n* 这条数据移动到屏幕外边，当translateX值等于屏幕宽度+自身宽度的时候，是移除数据的时机；\n\n### 实现过程\n* 最开始从接口拿到数据，放在一个ajaxArr数组里面\n* ajaxArr.shift() 一条数据放入到，另外一个moveArr数组\n* moveArr数组里面的数据，通过window.requestAnimationFrame来改变translate3d的值，使这条数据运动起来；\n* 当处于“运动状态”中的数据，满足下一条数据运动时机时，我在把ajaxArr.shift()一条数据放入到，moveArr中；\n* 当moveArr中的数据，处于“结束状态”时，把当前这条数据shift()掉；\n* 当moveArr的length长度为0时，没有运动的数据，需要停掉定时器\n\n````javascript\n;\n(function() {\n\n    //监控页面性能\n    var stats = new Stats();\n    stats.showPanel(0);\n    document.body.appendChild(stats.dom);\n\n\n    var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||\n        window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {\n            window.setTimeout(callback, 1000 / 60);\n        };\n\n    var cancelAnimationFrame = window.cancelAnimationFrame || window.mozCancelAnimationFrame || function(timer) {\n        window.clearTimeout(timer);\n    };\n\n    var winW = $(window).width();\n\n    //https://github.com/seajs/seajs/blob/master/dist/runtime-debug.js\n    function isType(type) {\n        return function(obj) {\n            return {}.toString.call(obj) == \"[object \" + type + \"]\"\n        }\n    }\n\n    var isObject = isType(\"Object\")\n    var isString = isType(\"String\")\n    var isArray = Array.isArray || isType(\"Array\")\n    var isFunction = isType(\"Function\")\n    var isUndefined = isType(\"Undefined\")\n\n    var scroll = {\n        initIsOne: false, //接口数据断开，重新链接；\n        moveTimer: null, //定时器\n        ajaxArr: [], //接口获取来的数据\n        moveArr: [], //要滚动的数据\n        run: function() {\n            if (this.moveTimer) {\n                return;\n            }\n            this.moveTimer = requestAnimationFrame(this.move.bind(this));\n        },\n        stop: function() {\n            if (this.moveTimer) {\n                cancelAnimationFrame(this.moveTimer);\n                this.moveTimer = null;\n            }\n        },\n\n        setData: function(obj) {\n            if (isObject(obj)) {\n                obj.id = Math.random().toString(36).substr(3);\n                this.ajaxArr.unshift(obj);\n            }\n\n            if (isArray(obj)) {\n                for (var i = 0; i < obj.length; i++) {\n                    obj[i].id = Math.random().toString(36).substr(3);\n                    this.ajaxArr.unshift(obj[i]);\n                }\n            }\n        },\n\n        send: function(obj) { //点击可以发送\n\n            this.setData(obj);\n\n            //如果定时器停了\n            if (this.moveArr.length == 0) {\n                this.initIsOne = false;\n                this.init();\n                this.moveTimer = requestAnimationFrame(this.move.bind(this));\n            }\n\n            //只要页面滚动的不是最后一个数据，就不能init\n            if (this.initIsOne) {\n                this.initIsOne = false;\n                //init方法不能同一时间，多次执行，否则ui试图会重叠；\n                //执行一次 就可以了，把链接又开起来了\n                this.init();\n            }\n        },\n        init: function() {\n            var obj = this.ajaxArr.shift();\n\n            if (obj) {\n\n                obj.isTrue = true; //避免多次执行\n\n                $('.app').append(`<div class=\"scroll-li ${obj.id}\">${obj.font}${obj.id}</div>`);\n\n                obj.left = $(`.${obj.id}`).css('transform').split('(')[1].split(')')[0].split(',')[4] - 0;\n\n                this.moveArr.push(obj);\n\n            }\n        },\n        //对moveArr数组里面的left字段 --\n        move: function() {\n            stats.begin();\n\n            this.moveTimer = requestAnimationFrame(this.move.bind(this));\n\n            if (this.moveArr.length == 0) {\n                cancelAnimationFrame(this.moveTimer);\n                //console.log('定时器停了');\n            }\n\n            for (var i = 0; i < this.moveArr.length; i++) {\n\n                var obj = this.moveArr[i];\n\n                obj.left--;\n\n                //下一个滚动时机\n                if (obj.left <= 0 && obj.isTrue) {\n                    obj.isTrue = false;\n                    if (this.ajaxArr.length == 0) {\n                        this.initIsOne = true;\n                    }\n                    this.init();\n                    // console.log('可以放下一个', this.moveArr);\n                }\n\n                //单条播放完\n                if (obj.left <= (-winW)) {\n                    $(`.${obj.id}`).remove();\n                    this.moveArr.shift(i, 1);\n                    // console.log('删了一个');\n                }\n\n                $(`.${obj.id}`).css({\n                    '-webkit-transform': 'translate3d(' + obj.left + 'px, 0, 0)'\n                });\n\n            }\n            \n            stats.end();\n        }\n    };\n\n    window.scroll = scroll;\n})();\n````\n\n## 使用\n### 初始化和发送\n````javascript\n    //多条数据\n    var arr = [{ font:'滚动数据' }];\n    scroll.send(arr);\n\n    //单条数据\n    var obj = {font:'单条滚动数据'}\n    scroll.send(obj);\n````\n### 总结\n* 没对实现过程进行封装，在使用时需要在init方法，修改插入dom结构\n* 部分地方用的zepto方法，在后面会改成用原生js吧\n* demo大体上按照自己的想法实现了，效果勉强还行\n* 还有优化的工作要做，例如：\n    - 总结需求，封装js插件\n    - 对模块化的支持\n    - 滚动是对dom直接添加与删除，能否复用dom结构；避开对dom频繁操作\n    \n[demo效果](https://zhongs.github.io/scroll/single_scroll/index.html)\n\n[源码地址](https://github.com/zhongs/scroll/tree/master/single_scroll)\n","source":"_posts/从单行滚动开始.md","raw":"---\ntitle: 从单行滚动开始\ndate: 2017-10-29 15:06:21\ntags: 滚动\n---\n<img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/metal-text.jpg\" width=\"80%\" height=\"50%\">\n这种效果在网页中很常见，实际开发中也经常碰到这样的需求，自己也尝试写了一个这样的效果，下面是我的一个实现方案；\n<!-- more -->\n![demo效果](http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/ezgif-4-1fa54824c2.gif)\n\n## 分析过程\n\n### 初始状态\n![初始状态](http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc1.png)\n* 假设只有一条滚动数据的时候。最开始，我将这条数据定位到最右边，并且设置它的transform:translate3d(100%,0,0); 这是每条数据的初始状态；\n\n### 运动状态\n![下一条数据运动时机](http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc2.png)\n* 通过改变translateX的值，让这条数据移动起来；可以观察到当translate3d(0px,0px,0px)的时候，刚好整条数据移动到屏幕上来，也正好是下一条数据的运动时机；\n\n### 结束状态\n![移除数据](http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc4.png)\n* 这条数据移动到屏幕外边，当translateX值等于屏幕宽度+自身宽度的时候，是移除数据的时机；\n\n### 实现过程\n* 最开始从接口拿到数据，放在一个ajaxArr数组里面\n* ajaxArr.shift() 一条数据放入到，另外一个moveArr数组\n* moveArr数组里面的数据，通过window.requestAnimationFrame来改变translate3d的值，使这条数据运动起来；\n* 当处于“运动状态”中的数据，满足下一条数据运动时机时，我在把ajaxArr.shift()一条数据放入到，moveArr中；\n* 当moveArr中的数据，处于“结束状态”时，把当前这条数据shift()掉；\n* 当moveArr的length长度为0时，没有运动的数据，需要停掉定时器\n\n````javascript\n;\n(function() {\n\n    //监控页面性能\n    var stats = new Stats();\n    stats.showPanel(0);\n    document.body.appendChild(stats.dom);\n\n\n    var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||\n        window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {\n            window.setTimeout(callback, 1000 / 60);\n        };\n\n    var cancelAnimationFrame = window.cancelAnimationFrame || window.mozCancelAnimationFrame || function(timer) {\n        window.clearTimeout(timer);\n    };\n\n    var winW = $(window).width();\n\n    //https://github.com/seajs/seajs/blob/master/dist/runtime-debug.js\n    function isType(type) {\n        return function(obj) {\n            return {}.toString.call(obj) == \"[object \" + type + \"]\"\n        }\n    }\n\n    var isObject = isType(\"Object\")\n    var isString = isType(\"String\")\n    var isArray = Array.isArray || isType(\"Array\")\n    var isFunction = isType(\"Function\")\n    var isUndefined = isType(\"Undefined\")\n\n    var scroll = {\n        initIsOne: false, //接口数据断开，重新链接；\n        moveTimer: null, //定时器\n        ajaxArr: [], //接口获取来的数据\n        moveArr: [], //要滚动的数据\n        run: function() {\n            if (this.moveTimer) {\n                return;\n            }\n            this.moveTimer = requestAnimationFrame(this.move.bind(this));\n        },\n        stop: function() {\n            if (this.moveTimer) {\n                cancelAnimationFrame(this.moveTimer);\n                this.moveTimer = null;\n            }\n        },\n\n        setData: function(obj) {\n            if (isObject(obj)) {\n                obj.id = Math.random().toString(36).substr(3);\n                this.ajaxArr.unshift(obj);\n            }\n\n            if (isArray(obj)) {\n                for (var i = 0; i < obj.length; i++) {\n                    obj[i].id = Math.random().toString(36).substr(3);\n                    this.ajaxArr.unshift(obj[i]);\n                }\n            }\n        },\n\n        send: function(obj) { //点击可以发送\n\n            this.setData(obj);\n\n            //如果定时器停了\n            if (this.moveArr.length == 0) {\n                this.initIsOne = false;\n                this.init();\n                this.moveTimer = requestAnimationFrame(this.move.bind(this));\n            }\n\n            //只要页面滚动的不是最后一个数据，就不能init\n            if (this.initIsOne) {\n                this.initIsOne = false;\n                //init方法不能同一时间，多次执行，否则ui试图会重叠；\n                //执行一次 就可以了，把链接又开起来了\n                this.init();\n            }\n        },\n        init: function() {\n            var obj = this.ajaxArr.shift();\n\n            if (obj) {\n\n                obj.isTrue = true; //避免多次执行\n\n                $('.app').append(`<div class=\"scroll-li ${obj.id}\">${obj.font}${obj.id}</div>`);\n\n                obj.left = $(`.${obj.id}`).css('transform').split('(')[1].split(')')[0].split(',')[4] - 0;\n\n                this.moveArr.push(obj);\n\n            }\n        },\n        //对moveArr数组里面的left字段 --\n        move: function() {\n            stats.begin();\n\n            this.moveTimer = requestAnimationFrame(this.move.bind(this));\n\n            if (this.moveArr.length == 0) {\n                cancelAnimationFrame(this.moveTimer);\n                //console.log('定时器停了');\n            }\n\n            for (var i = 0; i < this.moveArr.length; i++) {\n\n                var obj = this.moveArr[i];\n\n                obj.left--;\n\n                //下一个滚动时机\n                if (obj.left <= 0 && obj.isTrue) {\n                    obj.isTrue = false;\n                    if (this.ajaxArr.length == 0) {\n                        this.initIsOne = true;\n                    }\n                    this.init();\n                    // console.log('可以放下一个', this.moveArr);\n                }\n\n                //单条播放完\n                if (obj.left <= (-winW)) {\n                    $(`.${obj.id}`).remove();\n                    this.moveArr.shift(i, 1);\n                    // console.log('删了一个');\n                }\n\n                $(`.${obj.id}`).css({\n                    '-webkit-transform': 'translate3d(' + obj.left + 'px, 0, 0)'\n                });\n\n            }\n            \n            stats.end();\n        }\n    };\n\n    window.scroll = scroll;\n})();\n````\n\n## 使用\n### 初始化和发送\n````javascript\n    //多条数据\n    var arr = [{ font:'滚动数据' }];\n    scroll.send(arr);\n\n    //单条数据\n    var obj = {font:'单条滚动数据'}\n    scroll.send(obj);\n````\n### 总结\n* 没对实现过程进行封装，在使用时需要在init方法，修改插入dom结构\n* 部分地方用的zepto方法，在后面会改成用原生js吧\n* demo大体上按照自己的想法实现了，效果勉强还行\n* 还有优化的工作要做，例如：\n    - 总结需求，封装js插件\n    - 对模块化的支持\n    - 滚动是对dom直接添加与删除，能否复用dom结构；避开对dom频繁操作\n    \n[demo效果](https://zhongs.github.io/scroll/single_scroll/index.html)\n\n[源码地址](https://github.com/zhongs/scroll/tree/master/single_scroll)\n","slug":"从单行滚动开始","published":1,"updated":"2019-03-21T04:23:24.672Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckknbqwg8000d10udyu4gr7ah","content":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/metal-text.jpg\" width=\"80%\" height=\"50%\"><br>这种效果在网页中很常见，实际开发中也经常碰到这样的需求，自己也尝试写了一个这样的效果，下面是我的一个实现方案；<br><a id=\"more\"></a><br><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/ezgif-4-1fa54824c2.gif\" alt=\"demo效果\"></p>\n<h2 id=\"分析过程\"><a href=\"#分析过程\" class=\"headerlink\" title=\"分析过程\"></a>分析过程</h2><h3 id=\"初始状态\"><a href=\"#初始状态\" class=\"headerlink\" title=\"初始状态\"></a>初始状态</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc1.png\" alt=\"初始状态\"></p>\n<ul>\n<li>假设只有一条滚动数据的时候。最开始，我将这条数据定位到最右边，并且设置它的transform:translate3d(100%,0,0); 这是每条数据的初始状态；</li>\n</ul>\n<h3 id=\"运动状态\"><a href=\"#运动状态\" class=\"headerlink\" title=\"运动状态\"></a>运动状态</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc2.png\" alt=\"下一条数据运动时机\"></p>\n<ul>\n<li>通过改变translateX的值，让这条数据移动起来；可以观察到当translate3d(0px,0px,0px)的时候，刚好整条数据移动到屏幕上来，也正好是下一条数据的运动时机；</li>\n</ul>\n<h3 id=\"结束状态\"><a href=\"#结束状态\" class=\"headerlink\" title=\"结束状态\"></a>结束状态</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc4.png\" alt=\"移除数据\"></p>\n<ul>\n<li>这条数据移动到屏幕外边，当translateX值等于屏幕宽度+自身宽度的时候，是移除数据的时机；</li>\n</ul>\n<h3 id=\"实现过程\"><a href=\"#实现过程\" class=\"headerlink\" title=\"实现过程\"></a>实现过程</h3><ul>\n<li>最开始从接口拿到数据，放在一个ajaxArr数组里面</li>\n<li>ajaxArr.shift() 一条数据放入到，另外一个moveArr数组</li>\n<li>moveArr数组里面的数据，通过window.requestAnimationFrame来改变translate3d的值，使这条数据运动起来；</li>\n<li>当处于“运动状态”中的数据，满足下一条数据运动时机时，我在把ajaxArr.shift()一条数据放入到，moveArr中；</li>\n<li>当moveArr中的数据，处于“结束状态”时，把当前这条数据shift()掉；</li>\n<li>当moveArr的length长度为0时，没有运动的数据，需要停掉定时器</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;</span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//监控页面性能</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> stats = <span class=\"keyword\">new</span> Stats();</span><br><span class=\"line\">    stats.showPanel(<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(stats.dom);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> requestAnimationFrame = <span class=\"built_in\">window</span>.requestAnimationFrame || <span class=\"built_in\">window</span>.mozRequestAnimationFrame ||</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.webkitRequestAnimationFrame || <span class=\"built_in\">window</span>.msRequestAnimationFrame || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">window</span>.setTimeout(callback, <span class=\"number\">1000</span> / <span class=\"number\">60</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> cancelAnimationFrame = <span class=\"built_in\">window</span>.cancelAnimationFrame || <span class=\"built_in\">window</span>.mozCancelAnimationFrame || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">timer</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.clearTimeout(timer);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> winW = $(<span class=\"built_in\">window</span>).width();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//https://github.com/seajs/seajs/blob/master/dist/runtime-debug.js</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isType</span>(<span class=\"params\">type</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;&#125;.toString.call(obj) == <span class=\"string\">\"[object \"</span> + type + <span class=\"string\">\"]\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> isObject = isType(<span class=\"string\">\"Object\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isString = isType(<span class=\"string\">\"String\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isArray = <span class=\"built_in\">Array</span>.isArray || isType(<span class=\"string\">\"Array\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isFunction = isType(<span class=\"string\">\"Function\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isUndefined = isType(<span class=\"string\">\"Undefined\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> scroll = &#123;</span><br><span class=\"line\">        initIsOne: <span class=\"literal\">false</span>, <span class=\"comment\">//接口数据断开，重新链接；</span></span><br><span class=\"line\">        moveTimer: <span class=\"literal\">null</span>, <span class=\"comment\">//定时器</span></span><br><span class=\"line\">        ajaxArr: [], <span class=\"comment\">//接口获取来的数据</span></span><br><span class=\"line\">        moveArr: [], <span class=\"comment\">//要滚动的数据</span></span><br><span class=\"line\">        run: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.moveTimer) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.moveTimer = requestAnimationFrame(<span class=\"keyword\">this</span>.move.bind(<span class=\"keyword\">this</span>));</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        stop: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.moveTimer) &#123;</span><br><span class=\"line\">                cancelAnimationFrame(<span class=\"keyword\">this</span>.moveTimer);</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.moveTimer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        setData: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isObject(obj)) &#123;</span><br><span class=\"line\">                obj.id = <span class=\"built_in\">Math</span>.random().toString(<span class=\"number\">36</span>).substr(<span class=\"number\">3</span>);</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.ajaxArr.unshift(obj);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isArray(obj)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; obj.length; i++) &#123;</span><br><span class=\"line\">                    obj[i].id = <span class=\"built_in\">Math</span>.random().toString(<span class=\"number\">36</span>).substr(<span class=\"number\">3</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.ajaxArr.unshift(obj[i]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        send: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>) </span>&#123; <span class=\"comment\">//点击可以发送</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.setData(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//如果定时器停了</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.moveArr.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.initIsOne = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.moveTimer = requestAnimationFrame(<span class=\"keyword\">this</span>.move.bind(<span class=\"keyword\">this</span>));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//只要页面滚动的不是最后一个数据，就不能init</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.initIsOne) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.initIsOne = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"comment\">//init方法不能同一时间，多次执行，否则ui试图会重叠；</span></span><br><span class=\"line\">                <span class=\"comment\">//执行一次 就可以了，把链接又开起来了</span></span><br><span class=\"line\">                <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        init: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> obj = <span class=\"keyword\">this</span>.ajaxArr.shift();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (obj) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                obj.isTrue = <span class=\"literal\">true</span>; <span class=\"comment\">//避免多次执行</span></span><br><span class=\"line\"></span><br><span class=\"line\">                $(<span class=\"string\">'.app'</span>).append(<span class=\"string\">`&lt;div class=\"scroll-li <span class=\"subst\">$&#123;obj.id&#125;</span>\"&gt;<span class=\"subst\">$&#123;obj.font&#125;</span><span class=\"subst\">$&#123;obj.id&#125;</span>&lt;/div&gt;`</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                obj.left = $(<span class=\"string\">`.<span class=\"subst\">$&#123;obj.id&#125;</span>`</span>).css(<span class=\"string\">'transform'</span>).split(<span class=\"string\">'('</span>)[<span class=\"number\">1</span>].split(<span class=\"string\">')'</span>)[<span class=\"number\">0</span>].split(<span class=\"string\">','</span>)[<span class=\"number\">4</span>] - <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">this</span>.moveArr.push(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"comment\">//对moveArr数组里面的left字段 --</span></span><br><span class=\"line\">        move: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            stats.begin();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.moveTimer = requestAnimationFrame(<span class=\"keyword\">this</span>.move.bind(<span class=\"keyword\">this</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.moveArr.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                cancelAnimationFrame(<span class=\"keyword\">this</span>.moveTimer);</span><br><span class=\"line\">                <span class=\"comment\">//console.log('定时器停了');</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"keyword\">this</span>.moveArr.length; i++) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">var</span> obj = <span class=\"keyword\">this</span>.moveArr[i];</span><br><span class=\"line\"></span><br><span class=\"line\">                obj.left--;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//下一个滚动时机</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (obj.left &lt;= <span class=\"number\">0</span> &amp;&amp; obj.isTrue) &#123;</span><br><span class=\"line\">                    obj.isTrue = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.ajaxArr.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.initIsOne = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">                    <span class=\"comment\">// console.log('可以放下一个', this.moveArr);</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//单条播放完</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (obj.left &lt;= (-winW)) &#123;</span><br><span class=\"line\">                    $(<span class=\"string\">`.<span class=\"subst\">$&#123;obj.id&#125;</span>`</span>).remove();</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.moveArr.shift(i, <span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"comment\">// console.log('删了一个');</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                $(<span class=\"string\">`.<span class=\"subst\">$&#123;obj.id&#125;</span>`</span>).css(&#123;</span><br><span class=\"line\">                    <span class=\"string\">'-webkit-transform'</span>: <span class=\"string\">'translate3d('</span> + obj.left + <span class=\"string\">'px, 0, 0)'</span></span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            stats.end();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.scroll = scroll;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><h3 id=\"初始化和发送\"><a href=\"#初始化和发送\" class=\"headerlink\" title=\"初始化和发送\"></a>初始化和发送</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//多条数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [&#123; <span class=\"attr\">font</span>:<span class=\"string\">'滚动数据'</span> &#125;];</span><br><span class=\"line\">scroll.send(arr);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//单条数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;<span class=\"attr\">font</span>:<span class=\"string\">'单条滚动数据'</span>&#125;</span><br><span class=\"line\">scroll.send(obj);</span><br></pre></td></tr></table></figure>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><ul>\n<li>没对实现过程进行封装，在使用时需要在init方法，修改插入dom结构</li>\n<li>部分地方用的zepto方法，在后面会改成用原生js吧</li>\n<li>demo大体上按照自己的想法实现了，效果勉强还行</li>\n<li>还有优化的工作要做，例如：<ul>\n<li>总结需求，封装js插件</li>\n<li>对模块化的支持</li>\n<li>滚动是对dom直接添加与删除，能否复用dom结构；避开对dom频繁操作</li>\n</ul>\n</li>\n</ul>\n<p><a href=\"https://zhongs.github.io/scroll/single_scroll/index.html\" target=\"_blank\" rel=\"noopener\">demo效果</a></p>\n<p><a href=\"https://github.com/zhongs/scroll/tree/master/single_scroll\" target=\"_blank\" rel=\"noopener\">源码地址</a></p>\n","site":{"data":{}},"excerpt":"<p><img align=\"center\" src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/metal-text.jpg\" width=\"80%\" height=\"50%\"><br>这种效果在网页中很常见，实际开发中也经常碰到这样的需求，自己也尝试写了一个这样的效果，下面是我的一个实现方案；<br>","more":"<br><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/ezgif-4-1fa54824c2.gif\" alt=\"demo效果\"></p>\n<h2 id=\"分析过程\"><a href=\"#分析过程\" class=\"headerlink\" title=\"分析过程\"></a>分析过程</h2><h3 id=\"初始状态\"><a href=\"#初始状态\" class=\"headerlink\" title=\"初始状态\"></a>初始状态</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc1.png\" alt=\"初始状态\"></p>\n<ul>\n<li>假设只有一条滚动数据的时候。最开始，我将这条数据定位到最右边，并且设置它的transform:translate3d(100%,0,0); 这是每条数据的初始状态；</li>\n</ul>\n<h3 id=\"运动状态\"><a href=\"#运动状态\" class=\"headerlink\" title=\"运动状态\"></a>运动状态</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc2.png\" alt=\"下一条数据运动时机\"></p>\n<ul>\n<li>通过改变translateX的值，让这条数据移动起来；可以观察到当translate3d(0px,0px,0px)的时候，刚好整条数据移动到屏幕上来，也正好是下一条数据的运动时机；</li>\n</ul>\n<h3 id=\"结束状态\"><a href=\"#结束状态\" class=\"headerlink\" title=\"结束状态\"></a>结束状态</h3><p><img src=\"http://7xqrwh.com1.z0.glb.clouddn.com/image/scrollDemo/jc4.png\" alt=\"移除数据\"></p>\n<ul>\n<li>这条数据移动到屏幕外边，当translateX值等于屏幕宽度+自身宽度的时候，是移除数据的时机；</li>\n</ul>\n<h3 id=\"实现过程\"><a href=\"#实现过程\" class=\"headerlink\" title=\"实现过程\"></a>实现过程</h3><ul>\n<li>最开始从接口拿到数据，放在一个ajaxArr数组里面</li>\n<li>ajaxArr.shift() 一条数据放入到，另外一个moveArr数组</li>\n<li>moveArr数组里面的数据，通过window.requestAnimationFrame来改变translate3d的值，使这条数据运动起来；</li>\n<li>当处于“运动状态”中的数据，满足下一条数据运动时机时，我在把ajaxArr.shift()一条数据放入到，moveArr中；</li>\n<li>当moveArr中的数据，处于“结束状态”时，把当前这条数据shift()掉；</li>\n<li>当moveArr的length长度为0时，没有运动的数据，需要停掉定时器</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;</span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//监控页面性能</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> stats = <span class=\"keyword\">new</span> Stats();</span><br><span class=\"line\">    stats.showPanel(<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(stats.dom);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> requestAnimationFrame = <span class=\"built_in\">window</span>.requestAnimationFrame || <span class=\"built_in\">window</span>.mozRequestAnimationFrame ||</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.webkitRequestAnimationFrame || <span class=\"built_in\">window</span>.msRequestAnimationFrame || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">window</span>.setTimeout(callback, <span class=\"number\">1000</span> / <span class=\"number\">60</span>);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> cancelAnimationFrame = <span class=\"built_in\">window</span>.cancelAnimationFrame || <span class=\"built_in\">window</span>.mozCancelAnimationFrame || <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">timer</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.clearTimeout(timer);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> winW = $(<span class=\"built_in\">window</span>).width();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//https://github.com/seajs/seajs/blob/master/dist/runtime-debug.js</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isType</span>(<span class=\"params\">type</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;&#125;.toString.call(obj) == <span class=\"string\">\"[object \"</span> + type + <span class=\"string\">\"]\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> isObject = isType(<span class=\"string\">\"Object\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isString = isType(<span class=\"string\">\"String\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isArray = <span class=\"built_in\">Array</span>.isArray || isType(<span class=\"string\">\"Array\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isFunction = isType(<span class=\"string\">\"Function\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> isUndefined = isType(<span class=\"string\">\"Undefined\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> scroll = &#123;</span><br><span class=\"line\">        initIsOne: <span class=\"literal\">false</span>, <span class=\"comment\">//接口数据断开，重新链接；</span></span><br><span class=\"line\">        moveTimer: <span class=\"literal\">null</span>, <span class=\"comment\">//定时器</span></span><br><span class=\"line\">        ajaxArr: [], <span class=\"comment\">//接口获取来的数据</span></span><br><span class=\"line\">        moveArr: [], <span class=\"comment\">//要滚动的数据</span></span><br><span class=\"line\">        run: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.moveTimer) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.moveTimer = requestAnimationFrame(<span class=\"keyword\">this</span>.move.bind(<span class=\"keyword\">this</span>));</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        stop: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.moveTimer) &#123;</span><br><span class=\"line\">                cancelAnimationFrame(<span class=\"keyword\">this</span>.moveTimer);</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.moveTimer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        setData: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isObject(obj)) &#123;</span><br><span class=\"line\">                obj.id = <span class=\"built_in\">Math</span>.random().toString(<span class=\"number\">36</span>).substr(<span class=\"number\">3</span>);</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.ajaxArr.unshift(obj);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isArray(obj)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; obj.length; i++) &#123;</span><br><span class=\"line\">                    obj[i].id = <span class=\"built_in\">Math</span>.random().toString(<span class=\"number\">36</span>).substr(<span class=\"number\">3</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.ajaxArr.unshift(obj[i]);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        send: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>) </span>&#123; <span class=\"comment\">//点击可以发送</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.setData(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//如果定时器停了</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.moveArr.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.initIsOne = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.moveTimer = requestAnimationFrame(<span class=\"keyword\">this</span>.move.bind(<span class=\"keyword\">this</span>));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//只要页面滚动的不是最后一个数据，就不能init</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.initIsOne) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.initIsOne = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"comment\">//init方法不能同一时间，多次执行，否则ui试图会重叠；</span></span><br><span class=\"line\">                <span class=\"comment\">//执行一次 就可以了，把链接又开起来了</span></span><br><span class=\"line\">                <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        init: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> obj = <span class=\"keyword\">this</span>.ajaxArr.shift();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (obj) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                obj.isTrue = <span class=\"literal\">true</span>; <span class=\"comment\">//避免多次执行</span></span><br><span class=\"line\"></span><br><span class=\"line\">                $(<span class=\"string\">'.app'</span>).append(<span class=\"string\">`&lt;div class=\"scroll-li <span class=\"subst\">$&#123;obj.id&#125;</span>\"&gt;<span class=\"subst\">$&#123;obj.font&#125;</span><span class=\"subst\">$&#123;obj.id&#125;</span>&lt;/div&gt;`</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                obj.left = $(<span class=\"string\">`.<span class=\"subst\">$&#123;obj.id&#125;</span>`</span>).css(<span class=\"string\">'transform'</span>).split(<span class=\"string\">'('</span>)[<span class=\"number\">1</span>].split(<span class=\"string\">')'</span>)[<span class=\"number\">0</span>].split(<span class=\"string\">','</span>)[<span class=\"number\">4</span>] - <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">this</span>.moveArr.push(obj);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"comment\">//对moveArr数组里面的left字段 --</span></span><br><span class=\"line\">        move: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            stats.begin();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.moveTimer = requestAnimationFrame(<span class=\"keyword\">this</span>.move.bind(<span class=\"keyword\">this</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.moveArr.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                cancelAnimationFrame(<span class=\"keyword\">this</span>.moveTimer);</span><br><span class=\"line\">                <span class=\"comment\">//console.log('定时器停了');</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"keyword\">this</span>.moveArr.length; i++) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">var</span> obj = <span class=\"keyword\">this</span>.moveArr[i];</span><br><span class=\"line\"></span><br><span class=\"line\">                obj.left--;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//下一个滚动时机</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (obj.left &lt;= <span class=\"number\">0</span> &amp;&amp; obj.isTrue) &#123;</span><br><span class=\"line\">                    obj.isTrue = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.ajaxArr.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.initIsOne = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">                    <span class=\"comment\">// console.log('可以放下一个', this.moveArr);</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//单条播放完</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (obj.left &lt;= (-winW)) &#123;</span><br><span class=\"line\">                    $(<span class=\"string\">`.<span class=\"subst\">$&#123;obj.id&#125;</span>`</span>).remove();</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.moveArr.shift(i, <span class=\"number\">1</span>);</span><br><span class=\"line\">                    <span class=\"comment\">// console.log('删了一个');</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                $(<span class=\"string\">`.<span class=\"subst\">$&#123;obj.id&#125;</span>`</span>).css(&#123;</span><br><span class=\"line\">                    <span class=\"string\">'-webkit-transform'</span>: <span class=\"string\">'translate3d('</span> + obj.left + <span class=\"string\">'px, 0, 0)'</span></span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            stats.end();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">window</span>.scroll = scroll;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><h3 id=\"初始化和发送\"><a href=\"#初始化和发送\" class=\"headerlink\" title=\"初始化和发送\"></a>初始化和发送</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//多条数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [&#123; <span class=\"attr\">font</span>:<span class=\"string\">'滚动数据'</span> &#125;];</span><br><span class=\"line\">scroll.send(arr);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//单条数据</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;<span class=\"attr\">font</span>:<span class=\"string\">'单条滚动数据'</span>&#125;</span><br><span class=\"line\">scroll.send(obj);</span><br></pre></td></tr></table></figure>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><ul>\n<li>没对实现过程进行封装，在使用时需要在init方法，修改插入dom结构</li>\n<li>部分地方用的zepto方法，在后面会改成用原生js吧</li>\n<li>demo大体上按照自己的想法实现了，效果勉强还行</li>\n<li>还有优化的工作要做，例如：<ul>\n<li>总结需求，封装js插件</li>\n<li>对模块化的支持</li>\n<li>滚动是对dom直接添加与删除，能否复用dom结构；避开对dom频繁操作</li>\n</ul>\n</li>\n</ul>\n<p><a href=\"https://zhongs.github.io/scroll/single_scroll/index.html\" target=\"_blank\" rel=\"noopener\">demo效果</a></p>\n<p><a href=\"https://github.com/zhongs/scroll/tree/master/single_scroll\" target=\"_blank\" rel=\"noopener\">源码地址</a></p>"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"ckknbqwfn000110udqb37gg1m","tag_id":"ckknbqwfw000410udufxp29uu","_id":"ckknbqwg4000910ud7mx99wuz"},{"post_id":"ckknbqwft000310udnz9r01pl","tag_id":"ckknbqwg4000810ud5ydnpms4","_id":"ckknbqwg9000e10udfhzfa1r0"},{"post_id":"ckknbqwg8000d10udyu4gr7ah","tag_id":"ckknbqwg8000c10ud1bjr90wo","_id":"ckknbqwga000g10udsnxg5wqg"},{"post_id":"ckknbqwfx000510udd06g2nws","tag_id":"ckknbqwg8000c10ud1bjr90wo","_id":"ckknbqwgc000h10ud3qf1s1wt"},{"post_id":"ckknbqwg0000610udxrlth3vw","tag_id":"ckknbqwg4000810ud5ydnpms4","_id":"ckknbqwgd000j10udegs6u217"},{"post_id":"ckknbqwg3000710uddo2lna30","tag_id":"ckknbqwg4000810ud5ydnpms4","_id":"ckknbqwge000l10udatz7lpwz"},{"post_id":"ckknbqwg5000a10ud88di4aq2","tag_id":"ckknbqwgd000k10udlv70g6nt","_id":"ckknbqwgf000n10udrc1vgdqu"},{"post_id":"ckknbqwg7000b10udi7coadv7","tag_id":"ckknbqwgf000m10udla8k9hpt","_id":"ckknbqwgg000o10udksxp0pbj"}],"Tag":[{"name":"javascript","_id":"ckknbqwfw000410udufxp29uu"},{"name":"nodejs","_id":"ckknbqwg4000810ud5ydnpms4"},{"name":"滚动","_id":"ckknbqwg8000c10ud1bjr90wo"},{"name":"帧动画","_id":"ckknbqwgd000k10udlv70g6nt"},{"name":"全屏播放","_id":"ckknbqwgf000m10udla8k9hpt"}]}}